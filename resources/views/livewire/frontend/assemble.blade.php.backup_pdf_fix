<div>
    @livewire('frontend.includes.header')
    
    <!-- Livewire Component Content -->
    <div wire:ignore.self>
    <style>
        .productOpacity {
            opacity: 0.5;
            background-color: #FFF !important;
            border-radius: 6px;
        }
    </style>
    <style>
        :root {
            --sky-blu: #009ee1;
            --turquoise: #39cdc1;
            --blue-gradient: linear-gradient(135deg, #009ee1 0%, #39cdc1 100%);
            --blue-gradient-hover: linear-gradient(135deg, #0088cc 0%, #2fb8b0 100%);
            --light-blue: #e3f2fd;
            --dark-blue: #0056b3;
            --red: #d95053;
            --white: #ffffff;
            --light-gray: #f8f9fc;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0, 158, 225, 0.15);
            --shadow-hover: 0 8px 30px rgba(0, 158, 225, 0.25);
        }

        /* ===== STYLES FÜR DIE E-MAIL-SUCHE ===== */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .fade-out {
            animation: fadeOut 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .customer-found {
            border: 2px solid #28a745 !important;
            background-color: #f8fff9 !important;
        }
        
        .password-fields {
            transition: all 0.3s ease;
        }
        
        /* Cacher le formulaire principal par défaut - garder visible seulement la recherche d'email */
        .main-form-content {
            display: none;
        }
        
        /* S'assurer que les champs de mot de passe sont visibles par défaut */
        .password-fields {
            display: block !important;
        }
        
        /* Masquer seulement les blocs de consentement par défaut - ils s'afficheront avec le formulaire */
        #consent-section-3,
        #submit-section,
        #submit-section-2 {
            display: none !important;
        }
        
        /* ===== MODERN FORM STYLES ===== */
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 12px 16px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--white);
        }
        
        .form-control:focus {
            border-color: var(--sky-blu);
            box-shadow: 0 0 0 0.2rem rgba(0, 158, 225, 0.25);
            background: var(--white);
            outline: none;
        }
        
        .form-control:hover {
            border-color: var(--turquoise);
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
        }
        
        .form-check-input:checked {
            background-color: var(--sky-blu);
            border-color: var(--sky-blu);
        }
        
        .form-check-input:focus {
            box-shadow: 0 0 0 0.2rem rgba(0, 158, 225, 0.25);
        }
        
        /* ===== MODERN ALERT STYLES ===== */
        .alert {
            border-radius: var(--border-radius);
            padding: 20px;
            border: none;
            font-weight: 500;
            box-shadow: var(--shadow);
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border-left: 4px solid var(--sky-blu);
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        /* ===== MODERN MODAL STYLES ===== */
        .modern-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modern-modal.show {
            opacity: 1;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .modal-container {
            position: relative;
            z-index: 1;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .modern-modal.show .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }
        
        .modal-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .modal-title {
            flex: 1;
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 2rem 1.5rem;
        }
        
        .modal-body p {
            margin: 0;
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2c3e50;
            text-align: center;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem 1.5rem;
            text-align: center;
        }
        
        .btn-modal-close {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-modal-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
        }
        
        .btn-modal-close:active {
            transform: translateY(0);
        }
        
        /* Animation d'entrée */
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modern-modal.show .modal-content {
            animation: modalSlideIn 0.4s ease-out;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .modal-container {
                width: 95%;
                margin: 1rem;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-body {
                padding: 1.5rem 1rem;
            }
            
            .modal-footer {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-body p {
                font-size: 1rem;
            }
        }
        
        /* ===== STYLES SPÉCIFIQUES POUR LE MODAL BETTSCHUTZEINLAGEN ===== */
        .quantity-selection {
            margin-top: 1.5rem;
        }
        
        .selection-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .quantity-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .quantity-btn {
            width: 60px;
            height: 60px;
            border: 2px solid #4facfe;
            background: white;
            color: #4facfe;
            border-radius: 50%;
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-btn:hover {
            background: #4facfe;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }
        
        .quantity-btn:active {
            transform: scale(0.95);
        }
        
        .info-text {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin: 0;
            color: #2c3e50;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .info-text i {
            color: #4facfe;
            margin-right: 0.5rem;
        }

        body {
            padding: 15px;
            font-family: sans-serif;
            font-size: 15px;
            line-height: 25px;
        }

        .container-fluid {
            width: 100% !important;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
        }


        .d-flex {
            display: flex;
        }

        .j-s-between {
            justify-content: space-between;
        }

        .heading-1 {
            color: var(--sky-blu);
            font-family: sans-serif;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .sub-heading {
            margin: 0;
            font-family: sans-serif;
        }


        .top-header {
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: start;
        }

        .top-logo-sec {
            display: flex;
        }

        .logo-img {
            max-width: 200px;
            width: 100%;
            min-width: 50px;
        }


        .table-form table {
            width: 100%;
            border: 1px solid #000;
            /*		    padding: 10px;*/
        }

        .table-form table td {
            height: 50px;
            border: 1px solid var(--sky-blu);
            padding: 0px 10px;
        }

        .checkbox-wrap {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .checkbox {
            border: 2px solid var(--sky-blu);
            text-align: center;
            color: var(--sky-blu);
            height: 25px;
            width: 25px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .table-form label {
            font-weight: 600;
            margin-right: 5px;
        }

        .multiple-checkboxes {
            display: flex;
            /*		justify-content: space-evenly;*/
            max-width: 100%;
        }

        .application-div {
            display: flex;
            align-items: flex-start;
            height: 100%;
            border: 1px solid;
            padding: 10px;
        }

        .application-div p {
            margin: 0;
        }

        .table-list-form table,
        .reuseable-table table {
            width: 100%;
            margin-top: 30px;
            text-align: center;
            border: 1px solid #000;
        }

        .table-list-form th,
        .reuseable-table th {
            height: 40px;
            border-bottom: 1px solid #000;
            padding: 5px;
        }

        .table-list-form td,
        .reuseable-table td {
            height: 40px;
            padding: 5px;
        }

        .checkbox-td {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .table-below-content {
            padding: 10px;
        }

        .table-below-content p {
            line-height: 28px;
        }

        .date_sign_wrap {
            display: flex;
            width: 100%;
            justify-content: space-between;
            padding: 0 10px;
        }

        .date,
        .sign {
            text-align: center;
            min-width: 200px;
            border-top: 2px solid;
            padding: 10px;
            margin-top: 50px;
        }

        .date label,
        .sign label {
            padding: 9px 0px;
        }


        .bottom-table {
            margin-top: 50px;
            border: 2px solid var(--red);
            padding: 0px 15px 15px 15px;
        }

        .bottom-table small {
            color: var(--red);
        }


        .overlap-heading {
            text-align: center;
            margin-top: -10px;
        }

        .bottom-table h3 {
            max-width: 570px;
            background: #fff;
            margin: auto;
        }

        .bottom-table table {
            width: 100%;
        }

        .attached-date-sign-wrap {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            font-size: 14px;
        }

        span.text-field {
            min-width: 200px;
            border-bottom: 2px solid #000;
            display: inline-block;
            margin-left: 20px;
        }

        .bottom-contact-list {
            list-style-type: none;
            display: flex;
            justify-content: space-between;
            padding: 0;
        }

        .bottom-contact-list li {
            font-size: 12px;
        }

        /* ===== MODERN PROGRESS BAR STYLES ===== */
        .progressbar-steps {
            margin-bottom: 2rem;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        /* Style pour les étapes actives avec dégradé bleu-turquoise */
        .step.active .step-text {
            color: var(--sky-blu) !important;
            font-weight: 700;
        }

        .step.active .step-number {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
            box-shadow: var(--shadow);
            transform: scale(1.1);
        }

        .step.active .step-divider {
            background: var(--blue-gradient) !important;
            height: 3px;
        }

        /* Style pour les étapes non-actives en gris moderne */
        .step:not(.active) .step-text,
        .step1:not(.active) .step-text,
        .step2:not(.active) .step-text,
        .step3:not(.active) .step-text,
        .step4:not(.active) .step-text,
        .step5:not(.active) .step-text {
            color: var(--turquoise) !important;
            font-weight: 500;
        }

        .step:not(.active) .step-number,
        .step1:not(.active) .step-number,
        .step2:not(.active) .step-number,
        .step3:not(.active) .step-number,
        .step4:not(.active) .step-number,
        .step5:not(.active) .step-number {
            background: var(--light-blue) !important;
            color: var(--sky-blu) !important;
            transition: all 0.3s ease;
        }

        .step:not(.active) .step-divider,
        .step1:not(.active) .step-divider,
        .step2:not(.active) .step-divider,
        .step3:not(.active) .step-divider,
        .step4:not(.active) .step-divider,
        .step5:not(.active) .step-divider {
            background: var(--light-blue) !important;
            height: 2px;
        }

        /* ===== MODERN BUTTON BACK STYLES ===== */
        .btn-back {
            border-radius: 50%;
            width: 60px;
            height: 60px;
            min-width: 60px;
            background: var(--blue-gradient);
            border: none;
            color: var(--white);
            font-size: 18px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-hover);
            background: var(--blue-gradient-hover);
        }
        
        .btn-back:active {
            transform: translateY(0) scale(0.95);
        }

        /* ===== MODERN PRODUCT STYLES ===== */
        .product-overview .content .product {
            justify-content: flex-start;
            padding: 20px;
            padding-right: 80px;
            border-radius: var(--border-radius);
            background: var(--blue-gradient);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .product-overview .content .product::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            pointer-events: none;
        }

        .product-overview .content .product:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .product-overview .content .product img {
            margin-right: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .product-overview .content .product:hover img {
            transform: scale(1.05);
        }

        .product-overview .content .product .prod-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--white);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-overview .content .product .prod-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .product-overview .content .product .prod-btn i {
            color: var(--sky-blu);
            font-size: 20px;
            transition: color 0.3s ease;
        }

        .product-overview .content .product .prod-btn:hover i {
            color: var(--turquoise);
        }

        .product-overview .content .product .prod-info .prod-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--white);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 5px;
        }

        .product-overview .content .product .prod-info .prod-size {
            color: var(--white);
            opacity: 0.9;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* ===== MODERN CURABOX STYLES ===== */
        .cartItem {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            border: 2px solid var(--light-blue);
        }
        
        .cartItem:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: var(--sky-blu);
            border-width: 3px;
        }
        
        .cartItem .product {
            display: flex;
            align-items: center;
            padding: 0;
            background: none;
            box-shadow: none;
        }
        
        .cartItem .product img {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-right: 15px;
        }
        
        .cartItem .prod-info .prod-name {
            color: var(--sky-blu);
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .cartItem .prod-info .prod-size {
            color: var(--sky-blu);
            font-size: 14px;
            font-weight: 500;
        }
        
        .cartItem .prod-btn {
            background: var(--blue-gradient);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .cartItem .prod-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-hover);
        }
        
        .cartItem .prod-btn i {
            color: var(--white);
            font-size: 16px;
        }
        
        .cartItem .qty {
            background: var(--white);
            color: var(--sky-blu);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            margin-right: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* ===== MODERN QUANTITY BUTTONS ===== */
        .quantity-btn {
            width: 60px;
            height: 60px;
            border: 2px solid var(--sky-blu);
            background: var(--white);
            color: var(--sky-blu);
            border-radius: 50%;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .quantity-btn:hover {
            background: var(--blue-gradient);
            color: var(--white);
            transform: scale(1.1);
            box-shadow: var(--shadow-hover);
        }
        
        .quantity-btn:active {
            transform: scale(0.95);
        }
        
        .quantity-btn.selected {
            background: var(--blue-gradient);
            color: var(--white);
            transform: scale(1.05);
        }
        
        /* ===== MODERN PROGRESS BAR STYLES ===== */
        .progress {
            height: 12px;
            background: var(--light-blue);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            background: var(--blue-gradient);
            border-radius: 10px;
            transition: width 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.2) 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* ===== MODERN TITLE STYLES ===== */
        .pagetitle__heading {
            background: var(--blue-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .pagetitle__desc {
            color: var(--dark-blue);
            font-size: 1.2rem;
            font-weight: 500;
            opacity: 0.8;
        }
        
        /* ===== MODERN SECTION TITLES ===== */
        .section-title {
            color: var(--dark-blue);
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--blue-gradient);
            border-radius: 2px;
        }
        
        /* ===== MODERN HINT/PRICE BADGE STYLES ===== */
        .hint {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
            padding: 8px 16px !important;
            border-radius: 20px !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            box-shadow: var(--shadow) !important;
            display: inline-block !important;
            margin: 10px 0 !important;
            border: none !important;
        }
        
        .hint span {
            color: var(--white) !important;
            font-weight: 700 !important;
        }
        
        /* ===== FORCE PRICE BADGE STYLES ===== */
        .product-overview .header .hint {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
            padding: 8px 16px !important;
            border-radius: 20px !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            box-shadow: var(--shadow) !important;
            display: inline-block !important;
            margin: 10px 0 !important;
            border: none !important;
        }
        
        .product-overview .header .hint span {
            color: var(--white) !important;
            font-weight: 700 !important;
        }
        
        /* ===== OVERRIDE ANY BLACK BACKGROUNDS ON HINT ===== */
        .hint, .hint *, .hint span, .hint div {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
        }
        
        /* ===== SPECIFIC 42€ BADGE OVERRIDE ===== */
        div.hint, .product-overview div.hint, .header div.hint {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
            padding: 8px 16px !important;
            border-radius: 20px !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            box-shadow: var(--shadow) !important;
            display: inline-block !important;
            margin: 10px 0 !important;
            border: none !important;
        }
        
        div.hint span, .product-overview div.hint span, .header div.hint span {
            color: var(--white) !important;
            font-weight: 700 !important;
        }
        
        /* ===== OVERRIDE BLACK BACKGROUNDS ===== */
        .badge, .badge-black, .badge-dark {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
            border: none !important;
        }
        
        /* ===== OVERRIDE BLACK TEXT COLORS ===== */
        h1, h2, h3, h4, h5, h6, p, span, div {
            color: inherit !important;
        }
        
        /* ===== SPECIFIC OVERRIDES FOR BLACK ELEMENTS ===== */
        .product-overview .header .hint {
            background: var(--blue-gradient) !important;
            color: var(--white) !important;
        }
        
        /* ===== OVERRIDE ANY REMAINING BLACK STYLES ===== */
        * {
            color: inherit !important;
        }
        
        .text-black, .text-dark {
            color: var(--dark-blue) !important;
        }
        
        .bg-black, .bg-dark {
            background: var(--blue-gradient) !important;
        }
        
        /* ===== CURABOX RECEIVER BACKGROUND ===== */
        .receiver {
            background: var(--light-blue) !important;
            padding: 20px !important;
            border-radius: var(--border-radius) !important;
            min-height: 200px !important;
        }
        
        .product-overview .receiver {
            background: var(--light-blue) !important;
            padding: 20px !important;
            border-radius: 0 0 var(--border-radius) var(--border-radius) !important;
            border: 1px solid rgba(0, 158, 225, 0.2) !important;
            border-top: none !important;
        }
        
        /* ===== OVERRIDE ANY DARK BACKGROUNDS ===== */
        .product-overview {
            background: var(--white) !important;
        }
        
        .product-overview .content {
            background: var(--light-blue) !important;
        }
        
        /* ===== FORCE LIGHT BACKGROUNDS ===== */
        .receiver, .receiver * {
            background: inherit !important;
        }
        
        .receiver {
            background: var(--light-blue) !important;
        }

        .box__sixe {
    display: flex;
    align-items: center;
    justify-content: flex-start;
}

        /* ===== MODERN CARD STYLES ===== */
        .card {
            border: 2px solid var(--light-blue);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            background: var(--white);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: var(--sky-blu);
        }
        
        .card-header {
            background: var(--blue-gradient);
            color: var(--white);
            border: none;
            padding: 20px;
            font-weight: 600;
            font-size: 18px;
        }
        
        .card-body {
            padding: 25px;
            background: var(--white);
        }
        
        /* ===== MODERN SECTION STYLES ===== */
        .product-wrapper {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
            border: 2px solid var(--light-blue);
        }
        
        .product-overview .header {
            background: var(--blue-gradient);
            color: var(--white);
            padding: 25px;
            margin: 0;
            border-radius: 0;
        }
        
        .product-overview .header i {
            font-size: 24px;
            margin-right: 15px;
            opacity: 0.9;
            color: var(--white) !important;
        }
        
        .product-overview .header h5 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .product-overview .content {
            padding: 30px;
            background: var(--light-blue);
            border: 1px solid rgba(0, 158, 225, 0.2);
            border-top: none;
        }
        
        .card-header {
            background: var(--blue-gradient);
            color: var(--white);
            border-bottom: none;
            padding: 15px;
        }
        
        .card-header h5 {
            margin: 0;
            color: var(--white);
        }
        
        .btn_secondary {
            background: var(--blue-gradient);
            color: var(--white);
            border: none;
        }
        
        .btn_secondary:hover {
            background: var(--blue-gradient-hover);
        }
        
        .alert {
            border-radius: 8px;
            padding: 15px;
        }
        
        .form-control:focus {
            border-color: var(--sky-blu);
            box-shadow: 0 0 0 0.2rem rgba(0, 158, 225, 0.25);
        }

        /*@media only screen and (min-width:768px){
            .multiple-checkboxes{
                max-width: 33%;
            }
        }*/
    </style>

    <!-- ========================
       page title
    =========================== -->
    <section class="page-title page-title-layout1 bg-overlay">
        <div class="bg-img"><img src="{{asset('frontend/assets/images/page-titles/1.jpg')}}" alt="background"></div>
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-12 col-xl-5">
                    <h1 class="pagetitle__heading"></h1>
                    <p class="pagetitle__desc"></p>
                </div>
            </div>
        </div>
    </section>


    @php
    $carts = [];
    $carts = Session::get('cart');
    @endphp

    <div class="section-padding">
        <div class="container progressbar">
		
			<div class="container">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <h1 class="pagetitle__heading" id="current-step-title">{{ $steps[0]['title'] }}</h1>
                        <p class="pagetitle__desc" id="current-step-description">{{ $steps[0]['description'] }}</p>
                    </div>
                </div>
            </div>
			
            <div class="progressbar-steps">

                <button onclick="getSetpData()" class="btn btn-info btn-back"><i class="fa fa-arrow-left" aria-hidden="true"></i></button>

                <div class="step step1 active">
                    <span class="step-text">Box wählen</span>
                    <div class="step-number"><span>1</span></div>
                    <div class="step-divider"></div>
                </div>
                @if(Route::currentRouteName() != 'assemble')
                <div class="step step2 active">
                    <span class="step-text">Persönliche Daten</span>
                    <div class="step-number"><span>2</span></div>
                    <div class="step-divider"></div>
                </div>

                @else
                <div class="step step2">
                    <span class="step-text">Persönliche Daten</span>
                    <div class="step-number"><span>2</span></div>
                    <div class="step-divider"></div>
                </div>
                @endif
                <div class="step step3">
                    <span class="step-text">Lieferadresse</span>
                    <div class="step-number"><span>3</span></div>
                    <div class="step-divider"></div>
                </div>
                <div class="step step4">
                    <span class="step-text">Zusammenfassung + Unterschrift</span>
                    <div class="step-number"><span>4</span></div>
                    <div class="step-divider"></div>
                </div>
                <div class="step step5">
                    <span class="step-text">Bestätigung</span>
                    <div class="step-number"><span>5</span></div>
                </div>
            </div>



            @if(Route::currentRouteName() != 'assemble')
            <div id="step1" style="display: none" data-step1="0">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product-wrapper">
                            <div class="product-overview mt-2">
                                <div class="header">
                                    <i class="fas fa-box"></i>
                                    <h5>Unsere Produkte</h5>
                                </div>
                                <div class="content">
                                    @foreach(getAllProducts() as $product)
                                    <div class="product mb-3 uniqueClass" id="productId{{$product->id}}" data-id="{{$product->price}}" onClick="getProduct('{{$product->id}}')">
                                        <img src="{{asset('storage/'.$product->image)}}">
                                        <div class="prod-info">
                                            <div class="prod-name">{{$product->name}}</div>
                                            <div class="prod-size">{{$product->product_title}}</div>
                                        </div>
                                        <div class="prod-btn">
                                            <i class="fas fa-plus-circle"></i>
                                        </div>
                                        {{--$product->price--}}
                                    </div>
                                    @endforeach
                                </div>
                            </div>
                            <div class="product-overview mt-2">
                                <div class="header">
                                    <i class="fas fa-box"></i>
                                    <h5>Ihre BeleschBox</h5>
                                    <input type="hidden" class="cartPriceValue" value="0">
                                    <div class="hint">
                                        <span>42 &euro;</span>
                                    </div>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" role="progressbar" aria-label="Example 20px high" style="width: 0%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="receiver"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 text-center mt-3">

                        @if(isset($_GET['updt']))
                        <a href="{{url('update-cart-order')}}" class="btn btn__primary btn__rounded"> Weiter zu
                            Ihren
                            Kontaktdaten
                        </a>
                        @else
                        <button type="button" class="btn btn__primary btn__rounded bed_protector_modal"> Weiter zu
                            Ihren
                            Kontaktdaten
                        </button>
                        @endif
                       

                        <!-- Modal -->
                        <div class="modal " style="display: none" id="bed_protector_modal" tabindex="-1" aria-labelledby="add_bed_protector" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header d-block text-center">
                                        <h4 class="modal-title" id="add_bed_protector">Wiederverwendbare
                                            Bettschutzeinlagen</h4>
                                        <p>Bis zu 250 Mal waschbar.</p>

                                    </div>
                                    <div class="modal-body">
                                        <div class="cure-box-modal-content">
                                            <img src="{{asset('frontend/assets/images/backgrounds/produkt-wiederverwbettschutzeinl.png')}}" class="img-fluid">
                                            <div class="image-content">
                                                <h6>Zusätzlich zu Ihren 42€</h6>
                                                <h4>Extra Schutz für 0,00€</h4>
                                                <p>statt 26,16€ pro Stück</p>
                                            </div>
                                            <h6>Wie viele Bettschutzeinlagen möchten Sie kostenfrei erhalten?</h6>
                                            <div class="product-count-list">
                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart0011day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" onchange="pdBedProtection()" id="d3_graph_chart0011day" value="1">
                                                        <span>
                                                            <p>1</p>
                                                        </span>
                                                    </label>
                                                </div>

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart0017day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" onchange="pdBedProtection()" id="d3_graph_chart0017day" value="2">
                                                        <span>
                                                            <p>2</p>
                                                        </span>
                                                    </label>
                                                </div>

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart00130day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" onchange="pdBedProtection()" id="d3_graph_chart00130day" value="3">
                                                        <span>
                                                            <p>3</p>
                                                        </span>
                                                    </label>
                                                </div>

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart00190day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" id="d3_graph_chart00190day" onchange="pdBedProtection()" value="4">
                                                        <span>
                                                            <p>4</p>
                                                        </span>
                                                    </label>
                                                </div>

                                            </div>
                                            <p><i class="fa fa-exclamation-circle"> </i> Sie können bis zu 4
                                                Bettschutzeinlagen
                                                einmal pro Jahr beantragen.</p>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn_secondary btn__rounded" onclick="closeBedProtectorModal(); return false;">Schließen
                                        </button>
                                        <button type="button" class="btn btn__primary btn__rounded with-bed-protection">
                                            Weiter mit
                                            Bettschutzeinlagen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Modal ends-->
                    </div>
                </div>
            </div>
            <div id="step2" style="display: block" data-step2="0">
                <div class="row mt-2">
                    <div class="col-md-12">
                        <h2>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Persönliche
                                    Daten</font>
                            </font>
                        </h2>
                        
                        <!-- DEBUG INFO -->
                        <div style="background: #ff0000; color: white; padding: 20px; margin: 20px 0; border: 3px solid #000; font-size: 16px; font-weight: bold;">
                            <strong>🔴 DEBUG INFO VISIBLE 🔴</strong><br>
                            Email Found: {{ $emailFound ? 'YES' : 'NO' }}<br>
                            Customer Data: {{ $customerData ? 'YES' : 'NO' }}<br>
                            @if($customerData)
                                First Name: {{ $customerData->firstName ?? $customerData->first_name ?? 'NULL' }}<br>
                                Last Name: {{ $customerData->lastName ?? $customerData->last_name ?? 'NULL' }}<br>
                                Pflegegrad: {{ $customerData->pflegegrad ?? 'NULL' }}<br>
                                Pflegegrad Type: {{ gettype($customerData->pflegegrad ?? 'NULL') }}<br>
                                Insurance Type: {{ $customerData->insurance_type ?? 'NULL' }}<br>
                                Street: {{ $customerData->street ?? $customerData->streetno ?? 'NULL' }}<br>
                                City: {{ $customerData->city ?? 'NULL' }}<br>
                                <br>
                                <strong>Pflegegrad Tests:</strong><br>
                                1 match: {{ ($customerData->pflegegrad == '1') ? 'YES' : 'NO' }}<br>
                                2 match: {{ ($customerData->pflegegrad == '2') ? 'YES' : 'NO' }}<br>
                                3 match: {{ ($customerData->pflegegrad == '3') ? 'YES' : 'NO' }}<br>
                                4 match: {{ ($customerData->pflegegrad == '4') ? 'YES' : 'NO' }}<br>
                                5 match: {{ ($customerData->pflegegrad == '5') ? 'YES' : 'NO' }}<br>
                                <br>
                                <strong>Insurance Type Tests:</strong><br>
                                G match: {{ ($customerData->insurance_type == 'G') ? 'YES' : 'NO' }}<br>
                                P match: {{ ($customerData->insurance_type == 'P') ? 'YES' : 'NO' }}<br>
                            @else
                                <strong>No Customer Data Available</strong><br>
                            @endif
                            <br>
                            <button onclick="testSessionData()" class="btn btn-warning btn-sm">Test Session Data</button>
                            <button onclick="setTestData()" class="btn btn-success btn-sm">Set Test Data</button>
                            <button onclick="reloadPage()" class="btn btn-info btn-sm">Reload Page</button>
                        </div>
                        
                        <p>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Ihre Box wurde
                                    erstellt. </font>
                                <font style="vertical-align: inherit;">Geben Sie nun Ihre persönlichen
                                    Daten
                                    ein, damit wir Sie für die weitere Beantragung und Bearbeitung der
                                    Curabox kontaktieren können. </font>
                                <font style="vertical-align: inherit;">Nach dem Speichern Ihrer Kontaktdaten
                                    können Sie alle anderen Daten in Ruhe eingeben. </font>
                                <font style="vertical-align: inherit;">Sie haben noch keine
                                    Bestellung aufgegeben.</font>
                            </font>
                        </p>
                    </div>


                    <div id="basket-form">
                        <!-- E-Mail-Suchbereich - Gleiches Prinzip wie test-modal-final -->
                        <div class="col-md-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-search"></i> E-Mail-Adresse eingeben</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <label for="search_email" class="form-label">E-Mail-Adresse*</label>
                                            <input type="email" 
                                                   class="form-control" 
                                                   id="search_email" 
                                                   placeholder="Geben Sie Ihre E-Mail-Adresse ein"
                                                   value="">
                                        </div>
                                        <div class="col-md-4 d-flex align-items-end">
                                            <div class="d-flex flex-column align-items-start">
                                                <button type="button" 
                                                        class="btn btn__primary btn__rounded mb-2" 
                                                        onclick="testSearchCustomer()">
                                                    <i class="fas fa-sign-in-alt"></i> Anmelden
                                                </button>
                                                <a href="#" onclick="showNewAccountForm(); return false;" 
                                                   style="color: #007bff; text-decoration: underline; cursor: pointer; font-size: 14px;">
                                                    Neues Konto erstellen
                                                </a>
                                            </div>
                                            <button type="button" 
                                                    class="btn btn_secondary btn__rounded" 
                                                    onclick="clearCustomerData()"
                                                    id="clearBtn"
                                                    style="display: none;">
                                                <i class="fas fa-times"></i> Löschen
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="alertMessage"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12 why-asking">
                            <span>Warum fragen wir das? </span><a class="fa fa-question iAm-question"></a>
                            <div class="iAm-question-ans" style="top: -50px; display: none;">
                                <h5>Beantragung der Curabox</h5>
                                <p>Ihre Kontaktdaten benötigen wir zur weiteren Beantragung und für Rückfragen im
                                    Rahmen
                                    Ihrer kostenlosen Versorgung mit Pflegehilfsmitteln. Sie senden mit der Angabe
                                    Ihrer
                                    Daten in diesem Schritt noch keine Bestellung ab.</p>
                            </div>
                        </div>
                        <div class="col-md-12 " id="iAm">
                            <h5 class="mb-50 ">Ich bin*</h5>
                            
                            
                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" onclick="optperson()" name="insured" id="inlineRadio1" value="Versicherter" 
                                           @if($emailFound && $customerData && ($customerData->surname == "Versicherter" || $customerData->insured_type == "Versicherter")) checked @endif>
                                    <label class="form-check-label" for="inlineRadio1">Versicherter</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="insured" onclick="optperson()" id="inlineRadio2" value="Pflegeperson"
                                           @if($emailFound && $customerData && ($customerData->surname == "Pflegeperson" || $customerData->insured_type == "Angehöriger / Pflegeperson" || $customerData->insured_type == "Pflegeperson")) checked @endif>
                                    <label class="form-check-label" for="inlineRadio2">Angehöriger /
                                        Pflegeperson</label>
                                </div>
                                <span class="insured_error_msg" style="color: red;"></span>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="title_name" id="inlineRadio3" value="Herr" 
                                           @if($emailFound && $customerData && $customerData->title == "Herr") checked @endif>
                                    <label class="form-check-label" for="inlineRadio3">Herr</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="title_name" id="inlineRadio4" value="Frau"
                                           @if($emailFound && $customerData && $customerData->title == "Frau") checked @endif>
                                    <label class="form-check-label" for="inlineRadio4">Frau</label>
                                </div>
                                <span class="title_name_error_msg" style="color: red;"></span>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="first_name" class="form-label">Vorname des Versicherten</label>
                                    <input type="text" class="form-control" id="first_name" value="{{ $emailFound && $customerData ? ($customerData->firstName ?? $customerData->first_name ?? '') : '' }}">
                                    <span class="first_name_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <label for="last_name" class="form-label">Nachname des Versicherten</label>
                                    <input type="text" class="form-control" id="last_name" value="{{ $emailFound && $customerData ? ($customerData->lastName ?? $customerData->last_name ?? '') : '' }}">
                                    <span class="last_name_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-8 mt-2">
                                    <label for="streetno" class="form-label">Straße</label>
                                    <input type="text" class="form-control" id="streetno" value="{{ $emailFound && $customerData ? ($customerData->street ?? $customerData->streetno ?? '') : '' }}">
                                    <span class="streetno_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-4 mt-2">
                                    <label for="houseno" class="form-label">Hausnummer</label>
                                    <input type="text" class="form-control" id="houseno" value="{{ $emailFound && $customerData ? ($customerData->houseNo ?? $customerData->houseno ?? '') : '' }}">
                                    <span class="houseno_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-4 mt-2">
                                    <label for="zip" class="form-label">PLZ</label>
                                    <input type="text" class="form-control" id="zip" value="{{ $emailFound && $customerData ? ($customerData->zipcode ?? $customerData->zip ?? '') : '' }}">
                                    <span class="zip_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-8 mt-2">
                                    <label for="city" class="form-label">Ort</label>
                                    <input type="text" class="form-control" id="city" value="{{ $emailFound && $customerData ? $customerData->city : '' }}">
                                    <span class="city_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-4 mt-2">
                                    <label for="Gaburtadatum" class="form-label">Gaburtadatum</label>
                                    <input type="date" class="form-control" id="Gaburtadatum" max="{{ date('Y-m-d') }}" min="1900-01-01" style="cursor: pointer;" title="Cliquez pour ouvrir le calendrier" value="{{ $emailFound && $customerData ? $customerData->dob : '' }}">
                                    <span class="gaburtadatum_error_msg" style="color: red;"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <h5 class="mt-50 ">Kontakt Daten</h5>
                                </div>
                                <div class="col-md-6">
                                    <label for="telno" class="form-label">telefunnummer</label>
                                    <input type="text" class="form-control" id="telno" value="">
                                    <span class="telno_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-6">
                                    <label for="email2" class="form-label">E-Mail</label>
                                    <input type="text" class="form-control" id="email2" value="" onblur="checkEmailExistsInForm()">
                                    <span class="email2_error_msg" style="color: red;"></span>
                                </div>
                                  
                                <!-- Passwort-Felder - von JavaScript gesteuert -->
                                <div class="col-md-6 password-fields">
                                    <label for="password2" class="form-label">Passwort</label>
                                    <input type="password" class="form-control" id="password" value="">
                                    <span class="password_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-6 password-fields">
                                    <label for="password2" class="form-label">Passwort bestätigen</label>
                                    <input type="password" class="form-control" id="confirm_password" value="">
                                    <span class="password2_error_msg" style="color: red;"></span>
                                </div>
                                
                            </div>


                            <div class="row">
                                <div class="col-md-12">
                                    <h5 class="mt-50 ">Angaben Zur Krankenkasse</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-label-tooltip">
                                        <label for="health-insurance" class="form-label ">Krankenkasse</label>
                                        <div class="tooltip-img-wrap">
                                            <img src="{{asset('frontend/assets/images/banners/Krankenkasse_Nummer.png')}}" class="tooltip-img">
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" id="health-insurance" value="">
                                    <span class="hinsurance_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-label-tooltip">
                                        <label for="insurance-no" class="form-label form-label-tooltip">Versichertennummer </label>
                                        <div class="tooltip-img-wrap">
                                            <img src="{{asset('frontend/assets/images/banners/versicherungsnummer.png')}}" class="tooltip-img">
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" id="insurance-no" placeholder="Diese Nummer hat immer 10 Ziffern" value="" onblur="checkInsuranceNumberExists()">
                                    <span class="insuranceno_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-6 mt-2">
                                    <label for="insurance-no" class="form-label">Krankenkassen-Nummer </label>
                                    <input type="text" class="form-control" id="KrankenkasseNummer" placeholder="Diese Nummer hat immer 10 Ziffern" value="" onblur="checkKrankenkasseNumberExists()">
                                    <span class="krankenkasse_error_msg" style="color: red;"></span>
                                </div>
                            </div>

                        </div>


                        <div class="col-md-12 why-asking">
                            <span>Warum fragen wir das? </span><a class="fa fa-question insured-question"></a>
                            <div class="insured-question-ans">
                                <h5>Kostenübernahme mit Ihrer Pflegekasse</h5>
                                <p>Die Beantragung und Abwicklung der Kostenübernahme mit Ihrer Pflegekasse
                                    übernimmt
                                    das Team der curabox für Sie. Für gesetzliche Versicherte entstehen keinerlei
                                    Kosten. Privatpatienten gehen in Vorleistung und beantragen die Erstattung der
                                    Kosten der curabox bei Ihrer Pflegekasse selbst. Sie haben nach § 40 Abs. 3 Satz
                                    5
                                    SGB XI einen Anspruch auf volle Rückerstattung.</p>
                            </div>
                        </div>
                        <div class="col-md-12 " id="insured" style="display: block;">
                            <h5 class="mb-50 ">Der Versicherte ist</h5>
                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions5" id="inlineRadio1" value="option5"
                                           @if($emailFound && $customerData && $customerData->insurance_type == 'G') checked @endif>
                                    <label class="form-check-label" for="inlineRadio5">Gesetzlich versichert
                                        (Kostenübernahme durch die Pflegekasse)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions5" id="inlineRadio2" value="option6"
                                           @if($emailFound && $customerData && $customerData->insurance_type == 'P') checked @endif>
                                    <label class="form-check-label" for="inlineRadio6">Privat versichert</label>
                                </div>

                                <span class="inlineRadioOptions5_error_msg" style="color: red;"></span>
                            </div>
                        </div>

                        <!-- TEST BLOC CONSENTEMENT TRÈS VISIBLE -->
                        <div class="col-md-12" style="background: #ff0000; color: white; padding: 30px; margin: 30px 0; border: 5px solid #000; border-radius: 10px; font-size: 20px; font-weight: bold;">
                            <div style="text-align: center;">
                                <h3>🔴 BLOC CONSENTEMENT TEST 🔴</h3>
                                <p>Ce bloc doit être visible !</p>
                                <input type="checkbox" id="test-consent" style="transform: scale(2);">
                                <label for="test-consent" style="font-size: 18px; margin-left: 10px;">
                                    Hiermit stimme ich zu, dass pflege.de meine personenbezogenen Informationen speichert und verarbeitet.
                                </label>
                            </div>
                        </div>

                        <div class="col-md-12 mb-3" id="pflegegrad">
                            <h5 class="mb-50 ">Pflegegrad</h5>
                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="pflegegrad" onchange="pflegegrad()" id="pflegegrad1" value="1"
                                           @if($emailFound && $customerData && $customerData->pflegegrad == '1') checked @endif>
                                    <label class="form-check-label" for="pflegegrad1">1</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="pflegegrad" onchange="pflegegrad()" id="pflegegrad2" value="2"
                                           @if($emailFound && $customerData && $customerData->pflegegrad == '2') checked @endif>
                                    <label class="form-check-label" for="pflegegrad2">2</label>
                                </div>

                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="pflegegrad" onchange="pflegegrad()" id="pflegegrad3" value="3"
                                           @if($emailFound && $customerData && $customerData->pflegegrad == '3') checked @endif>
                                    <label class="form-check-label" for="pflegegrad3">3</label>
                                </div>

                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="pflegegrad" onchange="pflegegrad()" id="pflegegrad4" value="4"
                                           @if($emailFound && $customerData && $customerData->pflegegrad == '4') checked @endif>
                                    <label class="form-check-label" for="pflegegrad4">4</label>
                                    <!-- DEBUG: {{ $emailFound && $customerData && $customerData->pflegegrad == '4' ? 'SHOULD BE CHECKED' : 'NOT CHECKED' }} -->
                                </div>

                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="pflegegrad" onchange="pflegegrad()" id="pflegegrad5" value="5"
                                           @if($emailFound && $customerData && $customerData->pflegegrad == '5') checked @endif>
                                    <label class="form-check-label" for="pflegegrad5">5</label>
                                </div>

                            </div>
                        </div>

                        <!-- CHECKBOX WITH CONDITION -->

                        <!-- Bloc de consentement -->
                        <div class="col-md-12" style="background: #f8f9fa; padding: 20px; margin: 20px 0; border: 2px solid #007bff; border-radius: 8px;">
                            <div class="condition-check-wrap">
                                <input type="checkbox" id="condition-chcek" name="condition_chcek">
                                <label for="condition-chcek">
                                    <span class="condition_chcek_error_msg" style="color: red;"></span>
                                    Hiermit stimme ich zu, dass pflege.de (web care LBJ GmbH) meine personenbezogenen (ggf.
                                    auch gesundheitsbezogenen) Informationen, v.a. Kontaktinfos/Versichertenstatus, für
                                    die Bearbeitung des Antrages (zum Erhalt der Pflegehilfsmittel) sowie für eine
                                    Kontaktaufnahme in diesem Zusammenhang via E-Mail speichert und verarbeitet.<br>

                                    Hinweis: Die Zustimmung ist freiwillig und kann jederzeit mit Wirkung für die
                                    Zukunft per E-Mail an <a href="#">betroffenenrechte@pflege.de</a> widerrufen
                                    werden.
                                    Im Falle eines Widerrufs können wir Ihnen gegenüber die entsprechenden
                                    Serviceleistungen nicht mehr erbringen. Weitere Informationen zum Datenschutz
                                    finden
                                    Sie <a href="#">hier.</a></label>
                            </div>
                        </div>
                        
                        <!-- Bloc de consentement RGPD -->
                        <div class="col-md-12" style="background: #f8f9fa; padding: 20px; margin: 20px 0; border: 2px solid #007bff; border-radius: 8px;">
                            <div class="condition-check-wrap">
                                <input type="checkbox" id="condition-chcek" name="condition_chcek">
                                <label for="condition-chcek">
                                    <span class="condition_chcek_error_msg" style="color: red;"></span>
                                    Hiermit stimme ich zu, dass pflege.de (web care LBJ GmbH) meine personenbezogenen (ggf.
                                    auch gesundheitsbezogenen) Informationen, v.a. Kontaktinfos/Versichertenstatus, für
                                    die Bearbeitung des Antrages (zum Erhalt der Pflegehilfsmittel) sowie für eine
                                    Kontaktaufnahme in diesem Zusammenhang via E-Mail speichert und verarbeitet.<br>

                                    Hinweis: Die Zustimmung ist freiwillig und kann jederzeit mit Wirkung für die
                                    Zukunft per E-Mail an <a href="#">betroffenenrechte@pflege.de</a> widerrufen
                                    werden.
                                    Im Falle eines Widerrufs können wir Ihnen gegenüber die entsprechenden
                                    Serviceleistungen nicht mehr erbringen. Weitere Informationen zum Datenschutz
                                    finden
                                    Sie <a href="#">hier.</a></label>
                            </div>
                        </div>
                        
                        <div class="col-md-12 text-right" id="submit-section">
                            <p class="mt-30 mb-5">Sie senden noch keine Bestellung ab</p>
                            <button class="btn btn__primary btn__rounded second-button">Weiter im Antrag</button>
                        </div>
                    </div>
                </div>
                
                <!-- Bloc de consentement - directement dans step2 -->
                <div class="col-md-12" id="consent-section" style="display: block !important; background: #f8f9fa; padding: 20px; margin: 20px 0; border: 2px solid #007bff; border-radius: 8px;">
                            <div class="condition-check-wrap">
                                <input type="checkbox" id="condition-chcek" name="condition_chcek"><label for="condition-chcek">
                                    <span class="condition_chcek_error_msg" style="color: red;"></span>
                            <strong>CONSENTEMENT RGPD :</strong><br>
                                    Hiermit
                                    stimme ich zu, dass pflege.de (web care LBJ GmbH) meine personenbezogenen (ggf.
                                    auch
                                    gesundheitsbezogenen) Informationen, v.a. Kontaktinfos/Versichertenstatus, für
                                    die
                                    Bearbeitung des Antrages (zum Erhalt der Pflegehilfsmittel) sowie für eine
                                    Kontaktaufnahme in diesem Zusammenhang via E-Mail speichert und verarbeitet.<br>

                                    Hinweis: Die Zustimmung ist freiwillig und kann jederzeit mit Wirkung für die
                                    Zukunft per E-Mail an <a href="#">betroffenenrechte@pflege.de</a> widerrufen
                                    werden.
                                    Im Falle eines Widerrufs können wir Ihnen gegenüber die entsprechenden
                                    Serviceleistungen nicht mehr erbringen. Weitere Informationen zum Datenschutz
                                    finden
                                    Sie <a href="#">hier.</a></label>
                    </div>
                </div>
            </div>
            @else
            <div id="step1" style="display: block">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product-wrapper">
                            <div class="product-overview mt-2">
                                <div class="header">
                                    <i class="fas fa-box"></i>
                                    <h5>Unsere Produkte</h5>
                                </div>
                                <div class="content">
                                    @foreach(getAllProducts() as $product)
                                    <div class="product mb-3 uniqueClass" id="productId{{$product->id}}" data-id="{{$product->price}}" onclick="getProduct('{{$product->id}}')">
                                        <img src="{{asset('storage/'.$product->image)}}">
                                        <div class="prod-info">
                                            <div class="prod-name">{{$product->name}}</div>
                                            <div class="prod-size">{{$product->product_title}}</div>
                                        </div>
                                        <div class="prod-btn">
                                            <i class="fas fa-plus-circle"></i>
                                        </div>
                                        {{--$product->price--}}
                                    </div>
                                    @endforeach
                                </div>
                            </div>
                            @php
                            $total_amount = getCartPrice($carts);
                            $get_perctage = 100 * $total_amount / 42;
                            @endphp
                            <div class="product-overview mt-2">
                                <div class="header">
                                    <i class="fas fa-box"></i>
                                    <h5>Ihre curabox</h5>
                                    <input type="hidden" class="cartPriceValue" value="{{$total_amount}}">
                                    <div class="hint">
                                        <span>42 &euro;</span>
                                    </div>

                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" role="progressbar" aria-label="Example 20px high" style="width: {{$get_perctage}}%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="receiver">
                                    @if(Session::has('cart'))
                                    @php
                                    $carts = Session::get('cart');
                                    @endphp
                                    @foreach($carts as $cart)
                                    <?php //print_r($cart)
                                    ?>
                                    <div data-id="{{$cart['product']['id']}}" class="content border-1 cartItem recProduct{{$cart['product']['id']}}">
                                        <div class="product mb-3">
                                            <img src="{{URL::asset('storage/'.$cart['product']['image'])}}">
                                            <div class="prod-info">
                                                <div class="prod-name">{{$cart['product']['name']}}</div>
                                                <div class="prod-size">{{$cart['product']['product_title']}}</div>
                                            </div>
                                            <div class="prod-btn" onclick="less({{$cart['product']['id']}})"><span class="qty quantity{{$cart['product']['id']}}">{{$cart['quantity']}}</span>
                                                <input type="hidden" id="qty_p_{{$cart['product']['id']}}" value="1"><input type="hidden" class="cartPrice" id="price_p_{{$cart['product']['id']}}" value="{{$cart['product']['price']}}"><i class="fas fa-minus-circle"></i>
                                            </div>
                                        </div>
                                        @if($cart['product']['size_availability'] != '')
                                        <div class="glove-options">
                                            <div class="d-flex"><img src="{{URL::asset('frontend/assets/images/icon-handschuh.svg')}}"><label>Welche Handschuhgröße haben Sie?</label></div>
                                        </div>
                                        @endif

                                        @if($cart['product']['size_availability'] != '')
                                        @php
                                        $size_arr = explode (",", $cart['product']['size_availability']);
                                        @endphp
                                    <div class="box__sixe">
                                        @foreach($size_arr as $key=>$size)
                                        <div class="base-click-box size1" id="bx-1">
                                            <div class="productss" id="checkData-{{$cart['product']['id']}}">

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label class="prod-count bg-white" for="d3_graph_chart{{$cart['product']['id']}}{{$size}}">
                                                        <input onclick="fetchSize({{$cart['product']['id']}})" class="SIZE{{$key}}" id="d3_graph_chart{{$cart['product']['id']}}{{$size}}" name="size{{$cart['product']['id']}}" type="radio" value="{{$size}}">
                                                        <span>
                                                            <p>
                                                                <font class="page_speed_808076681">
                                                                    <font class="page_speed_808076681">{{$size}}</font>
                                                                </font>
                                                            </p>
                                                        </span>
                                                    </label>
                                                </div>


                                            </div>
                                        </div>
                                        @endforeach
                                        </div>
                                        @endif


                                    </div>
                                    @endforeach
                                    @endif


                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 text-center mt-3">

                    @if(isset($_GET['updt']))
                        <a href="{{url('update-cart-order')}}" class="btn btn__primary btn__rounded"> Weiter zu
                            Ihren
                            Kontaktdaten
                        </a>
                        @else
                        <button type="button" class="btn btn__primary btn__rounded bed_protector_modal"> Weiter zu
                            Ihren
                            Kontaktdaten
                        </button>
                        @endif
                       

                        <!-- Modal -->
                        <div class="modal " style="display: none" id="bed_protector_modal" tabindex="-1" aria-labelledby="add_bed_protector" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header d-block text-center">
                                        <h4 class="modal-title" id="add_bed_protector">Wiederverwendbare
                                            Bettschutzeinlagen</h4>
                                        <p>Bis zu 250 Mal waschbar.</p>

                                    </div>
                                    <div class="modal-body">
                                        <div class="cure-box-modal-content">
                                            <img src="{{asset('frontend/assets/images/backgrounds/produkt-wiederverwbettschutzeinl.png')}}" class="img-fluid">
                                            <div class="image-content">
                                                <h6>Zusätzlich zu Ihren 42€</h6>
                                                <h4>Extra Schutz für 0,00€</h4>
                                                <p>statt 26,16€ pro Stück</p>
                                            </div>
                                            <h6>Wie viele Bettschutzeinlagen möchten Sie kostenfrei erhalten?</h6>
                                            <div class="product-count-list">
                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart0011day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" onchange="pdBedProtection()" id="d3_graph_chart0011day" value="1">
                                                        <span>
                                                            <p>1</p>
                                                        </span>
                                                    </label>
                                                </div>

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart0017day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" onchange="pdBedProtection()" id="d3_graph_chart0017day" value="2">
                                                        <span>
                                                            <p>2</p>
                                                        </span>
                                                    </label>
                                                </div>

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart00130day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" onchange="pdBedProtection()" id="d3_graph_chart00130day" value="3">
                                                        <span>
                                                            <p>3</p>
                                                        </span>
                                                    </label>
                                                </div>

                                                <div class="lengend-action-buttons lengend-action-buttons-first">
                                                    <label for="d3_graph_chart00190day" class="prod-count">
                                                        <input type="radio" name="number_of_bed" id="d3_graph_chart00190day" onchange="pdBedProtection()" value="4">
                                                        <span>
                                                            <p>4</p>
                                                        </span>
                                                    </label>
                                                </div>

                                            </div>
                                            <p><i class="fa fa-exclamation-circle"> </i> Sie können bis zu 4
                                                Bettschutzeinlagen
                                                einmal pro Jahr beantragen.</p>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn_secondary btn__rounded" onclick="closeBedProtectorModal(); return false;">Schließen
                                        </button>
                                        <button type="button" class="btn btn__primary btn__rounded with-bed-protection">
                                            Weiter mit
                                            Bettschutzeinlagen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Modal ends-->
                    </div>
                </div>
            </div>
            <div id="step2" style="display: none" data-step21="0">
                <div class="row mt-2">
                    <div class="col-md-12">
                        <h2>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Persönliche
                                    Daten</font>
                            </font>
                        </h2>
                        <p>
                            <font style="vertical-align: inherit;">
                                <font style="vertical-align: inherit;">Ihre Box wurde
                                    erstellt. </font>
                                <font style="vertical-align: inherit;">Geben Sie nun Ihre persönlichen
                                    Daten
                                    ein, damit wir Sie für die weitere Beantragung und Bearbeitung der
                                    Curabox kontaktieren können. </font>
                                <font style="vertical-align: inherit;">Nach dem Speichern Ihrer Kontaktdaten
                                    können Sie alle anderen Daten in Ruhe eingeben. </font>
                                <font style="vertical-align: inherit;">Sie haben noch keine
                                    Bestellung aufgegeben.</font>
                            </font>
                        </p>
                    </div>


                    <div id="basket-form">
                        <!-- E-Mail-Suchbereich - Gleiches Prinzip wie test-modal-final -->
                        <div class="col-md-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-search"></i> E-Mail-Adresse eingeben</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <label for="search_email" class="form-label">E-Mail-Adresse*</label>
                                            <input type="email" 
                                                   class="form-control" 
                                                   id="search_email" 
                                                   placeholder="Geben Sie Ihre E-Mail-Adresse ein"
                                                   value="">
                                        </div>
                                        <div class="col-md-4 d-flex align-items-end">
                                            <div class="d-flex flex-column align-items-start">
                                                <button type="button" 
                                                        class="btn btn__primary btn__rounded mb-2" 
                                                        onclick="testSearchCustomer()">
                                                    <i class="fas fa-sign-in-alt"></i> Anmelden
                                                </button>
                                                <a href="#" onclick="showNewAccountForm(); return false;" 
                                                   style="color: #007bff; text-decoration: underline; cursor: pointer; font-size: 14px;">
                                                    Neues Konto erstellen
                                                </a>
                                            </div>
                                            <button type="button" 
                                                    class="btn btn_secondary btn__rounded" 
                                                    onclick="clearCustomerData()"
                                                    id="clearBtn"
                                                    style="display: none;">
                                                <i class="fas fa-times"></i> Löschen
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="alertMessage"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12 why-asking">
                            <span>Warum fragen wir das? </span><a class="fa fa-question iAm-question"></a>
                            <div class="iAm-question-ans" style="top: -50px; display: none;">
                                <h5>Beantragung der Curabox</h5>
                                <p>Ihre Kontaktdaten benötigen wir zur weiteren Beantragung und für Rückfragen im
                                    Rahmen
                                    Ihrer kostenlosen Versorgung mit Pflegehilfsmitteln. Sie senden mit der Angabe
                                    Ihrer
                                    Daten in diesem Schritt noch keine Bestellung ab.</p>
                            </div>
                        </div>
                        <div class="col-md-12 " id="iAm">
                            <h5 class="mb-50 ">Ich bin*</h5>
                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" onclick="optperson()" name="insured" id="inlineRadio1" value="Versicherter">
                                    <label class="form-check-label" for="inlineRadio1">Versicherter</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="insured" onclick="optperson()" id="inlineRadio2_2" value="Pflegeperson">
                                    <label class="form-check-label" for="inlineRadio2_2">Angehöriger /
                                        Pflegeperson</label>
                                </div>
                                <span class="insured_error_msg" style="color: red;"></span>
                            </div>

                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="title_name" id="inlineRadio3" value="Herr" 
                                           @if($emailFound && $customerData && $customerData->title == "Herr") checked @endif>
                                    <label class="form-check-label" for="inlineRadio3">Herr</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="title_name" id="inlineRadio4" value="Frau"
                                           @if($emailFound && $customerData && $customerData->title == "Frau") checked @endif>
                                    <label class="form-check-label" for="inlineRadio4">Frau</label>
                                </div>
                                <span class="title_name_error_msg" style="color: red;"></span>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label for="first_name" class="form-label">Vorname des Versicherten</label>
                                    <input type="text" class="form-control" id="first_name" value="">
                                    <span class="first_name_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <label for="last_name" class="form-label">Nachname des Versicherten</label>
                                    <input type="text" class="form-control" id="last_name" value="">
                                    <span class="last_name_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-8 mt-2">
                                    <label for="streetno" class="form-label">Straße</label>
                                    <input type="text" class="form-control" id="streetno" value="">
                                    <span class="streetno_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-4 mt-2">
                                    <label for="houseno" class="form-label">Hausnummer</label>
                                    <input type="text" class="form-control" id="houseno" value="">
                                    <span class="houseno_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-4 mt-2">
                                    <label for="zip" class="form-label">PLZ</label>
                                    <input type="text" class="form-control" id="zip" value="">
                                    <span class="zip_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-8 mt-2">
                                    <label for="city" class="form-label">Ort</label>
                                    <input type="text" class="form-control" id="city" value="">
                                    <span class="city_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-4 mt-2">
                                    <label for="Gaburtadatum" class="form-label">Gaburtadatum</label>
                                    <input type="date" class="form-control" id="Gaburtadatum" max="{{ date('Y-m-d') }}" min="1900-01-01" style="cursor: pointer;" title="Cliquez pour ouvrir le calendrier">
                                    <span class="gaburtadatum_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-4 mt-2">
                                    <label for="Pflegegrad" class="form-label">Pflegegrad</label>
                                    <div class="form-group">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="Pflegegrad" id="inlineRadio1" value="Pflegegrad1">
                                            <label class="form-check-label" for="inlineRadio5">Pflegegrad 1</label>
                                        </div>
                                        <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="Pflegegrad" id="Pflegegrad" value="Pflegegrad2">
                                            <label class="form-check-label" for="inlineRadio6">Pflegegrad 2</label>
                                        </div>
                                        <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="Pflegegrad" id="Pflegegrad" value="Pflegegrad3">
                                            <label class="form-check-label" for="inlineRadio6">Pflegegrad 3</label>
                                        </div>
                                        <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="Pflegegrad" id="Pflegegrad" value="Pflegegrad4">
                                            <label class="form-check-label" for="inlineRadio6">Pflegegrad 4</label>
                                        </div>
                                        <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="Pflegegrad" id="Pflegegrad" value="Pflegegrad5">
                                            <label class="form-check-label" for="inlineRadio6">Pflegegrad 5</label>
                                        </div>
                                        <span class="pflegegrad_error_msg" style="color: red;"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <h5 class="mt-50 ">Kontakt Daten</h5>
                                </div>
                                <div class="col-md-6">
                                    <label for="telno" class="form-label">telefunnummer</label>
                                    <input type="text" class="form-control" id="telno" value="">
                                    <span class="telno_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-6">
                                    <label for="email2" class="form-label">E-Mail</label>
                                    <input type="text" class="form-control" id="email2" value="" onblur="checkEmailExistsInForm()">
                                    <span class="email2_error_msg" style="color: red;"></span>
                                </div>

                                <!-- Passwort-Felder - von JavaScript gesteuert -->
                                <div class="col-md-6 password-fields">
                                    <label for="password2" class="form-label">Passwort</label>
                                    <input type="password" class="form-control" id="password" value="">
                                    <span class="password_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-6 password-fields">
                                    <label for="password2" class="form-label">Passwort bestätigen</label>
                                    <input type="password" class="form-control" id="confirm_password" value="">
                                    <span class="password2_error_msg" style="color: red;"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <h5 class="mt-50 ">Angaben Zur Krankenkasse</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-label-tooltip">
                                        <label for="health-insurance" class="form-label ">Krankenkasse</label>

                                    </div>
                                    <input type="text" class="form-control" id="health-insurance" value="">
                                    <span class="hinsurance_error_msg" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-label-tooltip">
                                        <label for="insurance-no" class="form-label form-label-tooltip">Versichertennummer </label>
                                        <div class="tooltip-img-wrap">
                                            <img src="{{asset('frontend/assets/images/banners/versicherungsnummer.png')}}" class="tooltip-img">
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" id="insurance-no" placeholder="Diese Nummer hat immer 10 Ziffern" value="" onblur="checkInsuranceNumberExists()">
                                    <span class="insuranceno_error_msg" style="color: red;"></span>
                                </div>

                                <div class="col-md-6 mt-2">
                                    <div class="form-label-tooltip">
                                        <label for="insurance-no" class="form-label ">Krankenkassen-Nummer</label>
                                        <div class="tooltip-img-wrap">
                                            <img src="{{asset('frontend/assets/images/banners/Krankenkasse_Nummer.png')}}" class="tooltip-img">
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" id="KrankenkasseNummer" placeholder="Diese Nummer hat immer 10 Ziffern" value="" onblur="checkKrankenkasseNumberExists()">
                                    <span class="krankenkasse_error_msg" style="color: red;"></span>
                                </div>
                            </div>

                            <!-- Bloc pour Angehöriger/Pflegeperson - Affiché seulement si sélectionné -->
                            <div class="col-md-12 optional d-none" id="angehoriger-contact">
                                <h5 class="mt-50 mb-3">Kontaktdaten Angehöriger/Pflegeperson</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="angehoriger_name" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="angehoriger_name" value="">
                                        <span class="angehoriger_name_error_msg" style="color: red;"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="angehoriger_telefon" class="form-label">Telefonnummer</label>
                                        <input type="text" class="form-control" id="angehoriger_telefon" value="">
                                        <span class="angehoriger_telefon_error_msg" style="color: red;"></span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="angehoriger_email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="angehoriger_email" value="">
                                        <span class="angehoriger_email_error_msg" style="color: red;"></span>
                                    </div>
                                </div>
                            </div>

                        </div>


                        <div class="col-md-12 why-asking">
                            <span>Warum fragen wir das? </span><a class="fa fa-question insured-question"></a>
                            <div class="insured-question-ans">
                                <h5>Kostenübernahme mit Ihrer Pflegekasse</h5>
                                <p>Die Beantragung und Abwicklung der Kostenübernahme mit Ihrer Pflegekasse
                                    übernimmt
                                    das Team der curabox für Sie. Für gesetzliche Versicherte entstehen keinerlei
                                    Kosten. Privatpatienten gehen in Vorleistung und beantragen die Erstattung der
                                    Kosten der curabox bei Ihrer Pflegekasse selbst. Sie haben nach § 40 Abs. 3 Satz
                                    5
                                    SGB XI einen Anspruch auf volle Rückerstattung.</p>
                            </div>
                        </div>
                        <div class="col-md-12 " id="insured-1">
                            <h5 class="mb-50 ">Der Versicherte ist</h5>
                            <div class="form-group">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions5_2" id="inlineRadio1_2" value="option5"
                                           @if($emailFound && $customerData && $customerData->insurance_type == 'G') checked @endif>
                                    <label class="form-check-label" for="inlineRadio5_2">Gesetzlich versichert
                                        (Kostenübernahme durch die Pflegekasse)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="inlineRadioOptions5_2" id="inlineRadio2_2" value="option6"
                                           @if($emailFound && $customerData && $customerData->insurance_type == 'P') checked @endif>
                                    <label class="form-check-label" for="inlineRadio6_2">Privat versichert</label>
                                </div>
                            </div>
                            <span class="inlineRadioOptions5_2_error_msg" style="color: red;"></span>
                            <div id="insurance-type-display" style="margin-top: 10px; padding: 10px; background-color: #f0f0f0; border-radius: 5px; display: none;">
                                <strong>Valeur sélectionnée :</strong> <span id="insurance-type-value"></span>
                            </div>
                        </div>

                        <!-- BLOC DE CONSENTEMENT DIRECTEMENT VISIBLE -->
                        <div class="col-md-12" style="background: #e3f2fd; padding: 25px; margin: 25px 0; border: 2px solid #2196f3; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div class="condition-check-wrap" style="display: flex; align-items: flex-start; gap: 15px;">
                                <input type="checkbox" id="condition-chcek" name="condition_chcek" style="margin-top: 5px; transform: scale(1.2);">
                                <label for="condition-chcek" style="font-size: 16px; line-height: 1.5; color: #333; cursor: pointer;">
                                    <span class="condition_chcek_error_msg" style="color: red; display: block; margin-bottom: 10px;"></span>
                                    <strong style="color: #1976d2;">Hiermit stimme ich zu, dass pflege.de (web care LBJ GmbH) meine personenbezogenen (ggf. auch gesundheitsbezogenen) Informationen, v.a. Kontaktinfos/Versichertenstatus, für die Bearbeitung des Antrages (zum Erhalt der Pflegehilfsmittel) sowie für eine Kontaktaufnahme in diesem Zusammenhang via E-Mail speichert und verarbeitet.</strong><br><br>
                                    <span style="font-size: 14px; color: #666;">
                                        <strong>Hinweis:</strong> Die Zustimmung ist freiwillig und kann jederzeit mit Wirkung für die Zukunft per E-Mail an <a href="mailto:betroffenenrechte@pflege.de" style="color: #1976d2;">betroffenenrechte@pflege.de</a> widerrufen werden. Im Falle eines Widerrufs können wir Ihnen gegenüber die entsprechenden Serviceleistungen nicht mehr erbringen. Weitere Informationen zum Datenschutz finden Sie <a href="#" style="color: #1976d2;">hier</a>.
                                    </span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Bouton pour passer à l'étape 3 -->
                        <div class="col-md-12 text-right" style="margin: 30px 0;">
                            <p style="margin-bottom: 15px; color: #666;">Sie senden noch keine Bestellung ab</p>
                            <button class="btn btn__primary btn__rounded second-button" style="padding: 12px 30px; font-size: 16px; font-weight: 600;">
                                Weiter im Antrag
                            </button>
                        </div>

                        <!-- CHECKBOX WITH CONDITION -->

                        <div class="col-md-12" id="consent-block-step2" style="display: none; background: #f8f9fa; padding: 20px; margin: 20px 0; border: 2px solid #007bff; border-radius: 8px;">
                            <div class="condition-check-wrap">
                                <input type="checkbox" id="condition-chcek" name="condition_chcek"><label for="condition-chcek">
                                    <span class="condition_chcek_error_msg" style="color: red;"></span>
                                    Hiermit
                                    stimme ich zu, dass pflege.de (web care LBJ GmbH) meine personenbezogenen (ggf.
                                    auch
                                    gesundheitsbezogenen) Informationen, v.a. Kontaktinfos/Versichertenstatus, für
                                    die
                                    Bearbeitung des Antrages (zum Erhalt der Pflegehilfsmittel) sowie für eine
                                    Kontaktaufnahme in diesem Zusammenhang via E-Mail speichert und verarbeitet.<br>

                                    Hinweis: Die Zustimmung ist freiwillig und kann jederzeit mit Wirkung für die
                                    Zukunft per E-Mail an <a href="#">betroffenenrechte@pflege.de</a> widerrufen
                                    werden.
                                    Im Falle eines Widerrufs können wir Ihnen gegenüber die entsprechenden
                                    Serviceleistungen nicht mehr erbringen. Weitere Informationen zum Datenschutz
                                    finden
                                    Sie <a href="#">hier.</a></label>
                            </div>
                        </div>
                        
                        <!-- Bloc de consentement - masqué par défaut, affiché seulement avec le formulaire -->
                        <div class="col-md-12" id="consent-form-block" style="display: none; background: #f8f9fa; padding: 20px; margin: 20px 0; border: 2px solid #007bff; border-radius: 8px;">
                            <div class="condition-check-wrap">
                                <input type="checkbox" id="condition-chcek" name="condition_chcek">
                                <label for="condition-chcek">
                                    <span class="condition_chcek_error_msg" style="color: red;"></span>
                                    Hiermit stimme ich zu, dass pflege.de (web care LBJ GmbH) meine personenbezogenen (ggf.
                                    auch gesundheitsbezogenen) Informationen, v.a. Kontaktinfos/Versichertenstatus, für
                                    die Bearbeitung des Antrages (zum Erhalt der Pflegehilfsmittel) sowie für eine
                                    Kontaktaufnahme in diesem Zusammenhang via E-Mail speichert und verarbeitet.<br>
                                    Hinweis: Die Zustimmung ist freiwillig und kann jederzeit mit Wirkung für die
                                    Zukunft per E-Mail an <a href="#">betroffenenrechte@pflege.de</a> widerrufen
                                    werden.
                                    Im Falle eines Widerrufs können wir Ihnen gegenüber die entsprechenden
                                    Serviceleistungen nicht mehr erbringen. Weitere Informationen zum Datenschutz
                                    finden
                                    Sie <a href="#">hier.</a></label>
                            </div>
                        </div>
                        
                        <div class="col-md-12 text-right" id="submit-section-2">
                            <p class="mt-30 mb-5">Sie senden noch keine Bestellung ab</p>
                            <button class="btn btn__primary btn__rounded second-button">Weiter im Antrag </button>
                        </div>
                    </div>
                </div>
            </div>
            @endif

            <div id="step3" style="display: none" data-step3="0">
                <div class="row">
                    <div class="col-md-12 mt-4">
                        <h2>Lieferadresse</h2>
                    </div>
                    <div id="delivery-form">
                        <div class="col-md-12">
                            <h5>Adressen Details</h5>
                        </div>

                        {{---
                        <div class="col-md-12">

                        <div class="row">
                                <div class="col-md-12">
                                    <label for="recipient-name" class="form-label">Empfängername</label>
                                    <input type="text" class="form-control" id="bill_Drecipient_name">
                                </div>
                                <div class="col-md-6">
                                    <label for="streetno" class="form-label">Straße</label>
                                    <input type="text" class="form-control" id="bill_Dstreetno">
                                </div>
                                <div class="col-md-6">
                                    <label for="houseno" class="form-label">Hausnummer</label>
                                    <input type="text" class="form-control" id="bill_Dhouseno">
                                </div>
                                <div class="col-md-6">
                                    <label for="zip" class="form-label">PLZ</label>
                                    <input type="text" class="form-control" id="bill_Dzip">
                                </div>
                                <div class="col-md-6">
                                    <label for="city" class="form-label">Ort</label>
                                    <input type="text" class="form-control" id="bill_Dcity">
                                </div>
                            </div>

                            
                        </div>
                        --}}


                        <div class="col-md-12" style="display:block" id="getDiffAddr">


                            <div class="row">
                                <div class="col-md-12">
                                    <label for="recipient-name" class="form-label">Empfängername</label>
                                    <input type="text" class="form-control" id="Drecipient_name" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label for="streetno" class="form-label">Straße</label>
                                    <input type="text" class="form-control" id="Dstreetno" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label for="houseno" class="form-label">Hausnummer</label>
                                    <input type="text" class="form-control" id="Dhouseno" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label for="zip" class="form-label">PLZ</label>
                                    <input type="text" class="form-control" id="Dzip" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label for="city" class="form-label">Ort</label>
                                    <input type="text" class="form-control" id="Dcity" readonly>
                                </div>
                            </div>
                        </div>


                        <div class="col-md-12 text-right mt-50">
                            <button type="button" class="btn btn-outline-primary mr-3" id="editDeliveryAddress">
                                <i class="fas fa-edit"></i> Modifier l'adresse
                            </button>
                            <button class="btn btn__primary btn__rounded deliveryAddress">einreichen</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step4" style="display: none" data-step4="0">
                <div class="row">
                    <div class="col-md-6">
                        <div class="signatureImg" id="signPad">
                            <canvas id="sketchpad"></canvas>
                        </div>
                        <p class="text-center">
                            <button onclick="sketchpad.undo();" class="btn btn-primary">Undo</button>
                            <button onclick="sketchpad.redo();" class="btn btn-primary">Redo</button>
                            <button onclick="DownloadCanvasAsImage()" class="btn btn-primary">Save</button>
                            <button onclick="deletesign()" class="btn btn-primary">Remove</button>
                            <button class="btn btn-primary" onclick="printPageArea('printableArea')" title="Download PDF file"><i class="fa fa-download"></i> PDF
                            </button>
                            <button class="btn btn-primary" onclick="printPageArea1('printPageArea1')" title="Download PDF1 file"><i class="fa fa-download"></i> PDF1
                            </button>
                        </p>
                    </div>
                    <div class="col-md-6">
                        <div class="signatureImg">
                            <img src="" id="signatureImg">
                        </div>
                        <div class="text-right mt10">
                            <button class="btn btn__primary btn__rounded signature_btn" onclick="signature()">einreichen</button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 d-none">
                        <div id="printableArea">
                            @if(Route::currentRouteName() == 'assemble')
                            <div class="container-fluid" style="width: 100%!important;">
                                <div class="row" style="display: flex; flex-wrap: wrap;">
                                    <div class="top-header" style="display: flex;width: 100%;justify-content: space-between;align-items: start;">
                                        <div class="top-heading-sec">
                                            <h1 class="heading-1" style="color:#009ee1;font-family: sans-serif;margin-bottom:10px;font-weight: 500;">
                                                Antrag auf Kostenübernahme</h1>
                                            <p class="sub-heading" style="margin: 0;font-family: sans-serif;">zur
                                                Versorgung mit Pflegehilfsmitteln gemäß § 78 Absatz 1 in Verbindung
                                                mit § 40 Absatz 2 SGB XI</p>
                                        </div>

                                        <div class="top-logo-sec" style="display: flex;">
                                            <img src="{{asset('frontend/assets/images/logo/belesch-logo-dark.png')}}" class="logo-img" style="max-width: 250px; width: 100%; min-width: 100px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="container-fluid" style="width: 100%!important;">
                                <div class="table-form">
                                    <h3>Versicherte / r:</h3>
                                    <table style="width: 100%;border: 1px solid #000;">
                                        <tbody>
                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; display: flex; max-width: 100%;" class="multiple-checkboxes">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox title_name_pd" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;
									height: 25px; width: 25px;margin-right: 10px; display: flex;align-items: center; justify-content: center;" id="title_name_fr_pd">
                                                        </div>
                                                        Frau
                                                    </div>

                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox title_name_pd" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;
									height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;" id="title_name_her_pd">
                                                        </div>
                                                        Herr
                                                    </div>

                                                </td>

                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <label style="font-weight: 600;margin-right: 5px;">Vorname:</label>
                                                    <span id="first_name_pd">Max</span>
                                                </td>

                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Nachname:</label>
                                                    <span id="last_name_pd">Mustermann</span>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; " colspan="2">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Straße,
                                                        Nr.:</label>
                                                    <span id="street_pd">Main street, street no-13B</span>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Telefon /
                                                        Mobil:</label>
                                                    <span id="mobile_pd">+97-9854632185</span>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <label style="font-weight: 600;margin-right: 5px; ">PLZ:</label>
                                                    <span id="zip_pd">1100251</span>
                                                </td>

                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; " colspan="2">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Ort:</label>
                                                    <span id="city_pd">Boston</span>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; " colspan="2">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Email:</label>
                                                    <span id="email_pd">info@bleschbox.com</span>
                                                </td>

                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Geburtsdatum:</label>
                                                    <span id="dob_pd">30-01-1993</span>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; " colspan="2">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Krankenkasse:</label>
                                                    <span id="health-insurance_pd">Krankenkassenname</span>
                                                </td>

                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <label style="font-weight: 600;margin-right: 5px; ">Versichertennr.:</label>
                                                    <span id="insurance_no_pd">Versicherungsnummer</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <h3>Antrag auf Kostenübernahme:</h3>
                                <div class="application-div" style="display: flex;align-items: flex-start;height: 100%;border: 1px solid; padding: 10px;">
                                    <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1; height: 25px; width: 25px;margin-right: 10px;
                                    display: flex;align-items: center; justify-content: center; ">X
                                    </div>
                                    <p style="margin: 0;">Zum Verbrauch bestimmte Pflegehilfsmittel - Produktgruppe
                                        (PG 54) - bis maximal des monatlichen Höchstbetrages nach § 40
                                        Abs. 2 SGB XI / bei Beihilfeberechtigung bis maximal der Hälfte des
                                        monatlichen Höchstbetrages nach § 40 Abs. 2 SGB XI</p>
                                </div>

                                <div class="table-list-form">
                                    <table style="width: 100%;margin-top: 30px;text-align: center;border: 1px solid #000;">
                                        <thead>
                                            <tr>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">
                                                    Wird grundsätzlich benötigt
                                                </th>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">Zum
                                                    Verbrauch bestimmte Pflegehilfsmittel
                                                </th>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">
                                                    Menge
                                                </th>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">
                                                    Positionsnummer
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach(getAllProducts() as $qualityPtoduct)
                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px;display: flex;justify-content: center;align-items: center; " class="checkbox-td">
                                                    <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;">
                                                        <span id="pd_{{$qualityPtoduct->id}}"></span>
                                                    </div>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">{{$qualityPtoduct->name}}
                                                    <span id="pd_size_{{$qualityPtoduct->id}}"></span>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; " id="qty_pd_{{$qualityPtoduct->id}}"></td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">{{$qualityPtoduct->positionNumber}}</td>
                                            </tr>
                                            @endforeach
                                        </tbody>
                                    </table>
                                </div>

                                <h3>Wiederverwendbare Bettschutzeinlagen</h3>
                                <div class="application-div" style="display: flex;align-items: flex-start;height: 100%;border: 1px solid; padding: 10px;">
                                    <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1; height: 25px; width: 25px;margin-right: 10px;
display: flex;align-items: center; justify-content: center; "></div>
                                    <p style="margin: 0;">Pflegehilfsmittel zur Körperpflege / Körperhygiene (PG 51)
                                        unter Abzug eines Eigenanteils von 10 v.H. soweit keine
                                        Befreiung von Zuzahlungen nach § 40 Abs. 3 Satz 5 SGB XI vorliegt.</p>
                                </div>

                                <div class="reuseable-table">
                                    <table style="width: 100%;margin-top: 30px;text-align: center;border: 1px solid #000;">
                                        <thead>
                                            <tr>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">
                                                    Benötigte Stückzahl (Max. 4 Stück/Jahr)
                                                </th>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">
                                                    Pflegehilfsmittel zur Körperpflege / Körperhygiene
                                                </th>
                                                <th style="height: 40px;border-bottom: 1px solid #000;padding: 5px;">
                                                    Positionsnummer
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px;display: flex;justify-content: center;align-items: center; " class=" checkbox-td">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1; height: 25px; width: 25px;margin-right: 10px; display: flex;align-items: center; justify-content: center; ">
                                                            <span id="bed1" class="bed_pd"></span>
                                                        </div>
                                                        1
                                                    </div>

                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1; height: 25px; width: 25px;margin-right: 10px; display: flex;align-items: center; justify-content: center; ">
                                                            <span id="bed2" class="bed_pd"></span>
                                                        </div>
                                                        2
                                                    </div>
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1; height: 25px; width: 25px;margin-right: 10px; display: flex;align-items: center; justify-content: center;">
                                                            <span id="bed3" class="bed_pd"></span>
                                                        </div>
                                                        3
                                                    </div>
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1; height: 25px; width: 25px;margin-right: 10px; display: flex;align-items: center; justify-content: center;">
                                                            <span id="bed4" class="bed_pd"></span>
                                                        </div>
                                                        4
                                                    </div>

                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    Wiederverwendbare Bettschutzeinlagen
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    51.40.01.4
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="table-below-content" style="padding: 10px;">
                                    <p style="line-height: 28px;">Hiermit bevollmächtige ich MedicCos mit der
                                        Antragstellung, Belieferung und Abwicklung hinsichtlich der Gewährung von
                                        Leistungen für
                                        die Versorgung mit Pflegehilfsmitteln bei meiner zuständigen Pflegekasse in
                                        meinem Namen. Die erforderliche Kommunikation erfolgt
                                        ausschließlich durch MedicCos, welche meine Daten zum Zwecke der
                                        Leistungserbringung nutzen darf. Ich bin über mein Recht informiert
                                        worden, der Weitergabe meiner Daten an Dritte zu widerrufen. Ich befreie
                                        meine Pflegekasse von ihrer Geheimhaltungspflicht gegenüber
                                        MedicCos solange die Leistungspflicht besteht. Bitte verzeichnen Sie
                                        MedicCos als meinen Leistungserbinger für Pflegehilfsmittel und
                                        Empfänger der Kostenübernahmebestätigung der Pflegekasse und streichen Sie
                                        bereits vorhandene Leistungserbringer. Gewünschte
                                        Produkte werden von mir ausnahmslos für die ambulante private Pflege im
                                        angegebenen Umfang bezogen.</p>
                                </div>
                                <div class="date_sign_wrap" style="display: flex;width: 100%;justify-content: space-between;padding: 0 10px;">
                                    <div class="date" style="text-align: center;min-width: 200px;border-top: 2px solid;padding: 10px;margin-top: 50px;">
                                        <label style="font-weight: 600;margin-right: 5px;padding: 9px 0px;">Datum</label>
                                    </div>
                                    <div class="sign" style="text-align: center;min-width: 200px;border-top: 2px solid;padding: 10px;margin-top: 50px;">
                                        <label style="font-weight: 600;margin-right: 5px;padding: 9px 0px;">Unterschrift
                                            Versicherte(r) oder Bevollmächtigte(r)</label>
                                    </div>
                                </div>

                                <div class="bottom-table" style="margin-top: 50px;border: 2px solid #d95053;padding: 0px 15px 15px 15px;">
                                    <div class="overlap-heading" style="text-align: center;margin-top: -10px;">
                                        <h3 style="max-width: 570px;background: #fff;margin: auto;">Genehmigung der
                                            Pflegekasse<small style="color: #d95053;">(wird von der Pflegekasse
                                                ausgefüllt)</small></h3>
                                    </div>
                                    <p>Bitte zurück an die Mailadresse: kasse@medic-cos.de oder per Fax: 0531 516
                                        057 13 </p>
                                    <table style="width: 100%;">
                                        <tbody>
                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid var(--sky-blu);text-align: center;color: var(--sky-blu);height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;"></div>
                                                        PG 54 bis 42,- € monatlich
                                                    </div>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid var(--sky-blu);text-align: center;color: var(--sky-blu);height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;"></div>
                                                        PG 51 ohne Zzgl./Beihilfeberechtigter
                                                    </div>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; " colspan="2">
                                                    IK 330302697
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;"></div>
                                                        PG 54 bis 20,- € monatlich
                                                    </div>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;"></div>
                                                        PG 51 mit Zzgl./Beihilfeberechtigter
                                                    </div>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;"></div>
                                                        PG 51 Ohne Zzgl.
                                                    </div>
                                                </td>
                                                <td style="height: 50px;border: 1px solid var(--sky-blu);padding: 0px 10px; ">
                                                    <div class="checkbox-wrap" style="display: flex;align-items: center;margin-right: 10px;">
                                                        <div class="checkbox" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px; width: 25px;margin-right: 10px;display: flex;align-items: center; justify-content: center;"></div>
                                                        PG 51 mit Zzgl.
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <div class="attached-date-sign-wrap" style="display: flex;justify-content: space-between;margin-top: 30px;font-size: 14px;">
                                        <div><label style="font-weight: 600;margin-right: 5px; ">Datum</label><span class="text-field" style="min-width: 200px;border-bottom: 2px solid #000;display: inline-block;margin-left: 20px;"></span>
                                        </div>
                                        <div><label style="font-weight: 600;margin-right: 5px; ">IK der Pegekasse /
                                                Stempel / Unterschrift</label><span class="text-field" style="min-width: 200px;border-bottom: 2px solid #000;display: inline-block;margin-left: 20px;"></span>
                                        </div>
                                    </div>
                                </div>
                                <ul class="bottom-contact-list" style="list-style-type: none;display: flex;justify-content: space-between;padding: 0;">
                                    <li style="font-size: 12px;">MedicCos Vertriebs UG (haftungbeschränkt)</li>
                                    <li style="font-size: 12px;">Lindenbergplatz 16 - 38126 Braunschweig | +49 (0)
                                        531 51605712 | info@belesch-box.de
                                    </li>
                                </ul>
                            </div>
                            @else
                            <table class="table" cellspacing="10" style="width: 100%;margin: 0 auto;padding: 10px;">
                                <tbody>
                                    <tr>
                                        <td>
                                            <h5 style="font-size:24px;color:var(--dark-blue);font-weight:100;margin:0;font-family: Georgia, 'Times New Roman', Times, serif;">
                                                Auswahl der gewünschten</h5>
                                            <h3 style="font-size:30px;color: var(--dark-blue);font-weight:400;margin:0;font-family: Georgia, 'Times New Roman', Times, serif;">
                                                BeleschBox</h3>
                                            <h6 style="font-size:24px;color: var(--sky-blu);margin-bottom:0;font-weight:200;margin-top:10px;font-family: Georgia, 'Times New Roman', Times, serif;">
                                                Lieferinformationen angeben</h6>
                                            <p style="font-family: Arial, Helvetica, sans-serif;font-size:18px;color:var(--dark-blue);margin-top:0px;">
                                                Versicherte/r (gemäß Antrag auf Kostenübernahme):</p>
                                        </td>
                                        <td style="text-align: right;">
                                            <img src="{{asset('frontend/assets/images/logo/belesch-logo-dark.png')}}" class="logo-img" style="max-width: 250px; width: 100%; min-width: 100px;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="display: flex;max-width: 100%;padding-top:10px;">
                                            <div style="display: flex;align-items: center;margin-right: 10px;font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">
                                                <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;" id="title_name_fr_pk"></div>
                                                Frau
                                            </div>

                                            <div style="display: flex;align-items: center;margin-right: 10px;font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">
                                                <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;" id="title_name_her_pk"></div>
                                                Herr
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="padding:20px 0;">
                                            <label style="font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">Vorname:</label>
                                            <input type="text" style="border-bottom:2px solid #6a6a6a;border-left:none;border-right:none;border-top:none" id="first_name_pk">
                                            <label style="font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">Nachname:</label>
                                            <input type="text" style="border-bottom:2px solid #6a6a6a;border-left:none;border-right:none;border-top:none" id="last_name_pk">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="display: flex;max-width: 100%;">
                                            <label style="font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">Pflegegrad:</label>
                                            <div style="display: flex;align-items: center;margin-right: 10px;">
                                                <div id="pflegegr1" class="pflegegr" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                1
                                            </div>
                                            <div style="display: flex;align-items: center;margin-right: 10px;">
                                                <div id="pflegegr2" class="pflegegr" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                2
                                            </div>
                                            <div style="display: flex;align-items: center;margin-right: 10px;">
                                                <div id="pflegegr3" class="pflegegr" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                3
                                            </div>
                                            <div style="display: flex;align-items: center;margin-right: 10px;">
                                                <div id="pflegegr4" class="pflegegr" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                4
                                            </div>
                                            <div style="display: flex;align-items: center;margin-right: 10px;">
                                                <div id="pflegegr5" class="pflegegr" style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                5
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            @foreach(getAllPackages() as $package)
                                            <div style="display: flex;width:50%;float: left;margin:30px 0 20px 0;">
                                                <div>
                                                    <img src="{{asset('frontend/assets/images/icons/box.png')}}" style="width:80px;border-right:2px solid #0d9bda;padding-right:10px;">
                                                    {{--<img src="{{asset('storage/'.$package->image)}}" style="width:80px;border-right:2px solid #0d9bda;padding-right:10px;">--}}
                                                </div>
                                                <div style="flex-grow: 1;padding:0 5px;">
                                                    <div>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;">@if(request()->id == $package->id)
                                                                ✓ @endif</div>
                                                            <span>{{$package->name}}</span>
                                                        </div>
                                                    </div>

                                                    <article style="width:30%;float:left;padding-left: 30px;">
                                                        @foreach($package->get_packageDetails as $packageProduct)
                                                        <span style="font-family: Arial, Helvetica, sans-serif;font-size: 14px;display: block;padding:2px 2px 0 0">{{$packageProduct->getProductDetails->product_title}}</span>
                                                        @endforeach
                                                    </article>
                                                    <article style="width:60%;float:left;">
                                                        @foreach($package->get_packageDetails as $packageProducts)
                                                        <span style="font-family: Arial, Helvetica, sans-serif;font-size: 14px;display: block;padding:2px 2px 0 0">{{$packageProducts->getProductDetails->name}}</span>
                                                        @endforeach
                                                    </article>

                                                </div>
                                            </div>
                                            @endforeach
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="padding:20px 0;">
                                            <table class="inner-tabel">
                                                <tr>
                                                    <td style="display: flex;max-width: 100%;">
                                                        <label style="font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">Handschuhgröße:</label>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;color:#6a6a6a;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                            S
                                                        </div>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;color:#6a6a6a;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                            M
                                                        </div>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;color:#6a6a6a;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                            L
                                                        </div>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;color:#6a6a6a;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                            XL
                                                        </div>
                                                        <label style="font-family: Arial, Helvetica, sans-serif;color:#6a6a6a;">(Bei
                                                            fehlende Angabe wird Größe M geliefert)</label>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <table class="inner-tabel" style="width:100%;">
                                                <tr>
                                                    <td style="display: flex;max-width: 100%;">
                                                        <label style="font-family: Arial, Helvetica, sans-serif;font-size:16px;color:#6a6a6a;">Wunschliefertermin:</label>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;color:#6a6a6a;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;">
                                                                ✓
                                                            </div>
                                                            1. bis 15. des Monats
                                                        </div>
                                                        <div style="display: flex;align-items: center;margin-right: 10px;color:#6a6a6a;">
                                                            <div style="border: 2px solid #009ee1;text-align: center;color: #009ee1;height: 25px;width: 25px;margin-right: 10px;display: flex;align-items: center;justify-content: center;"></div>
                                                            16. bis Ende des Monats
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="padding:20px 0 10em 0;">
                                            <p style="font-size: 14px;margin-bottom: 5px;font-family: Arial, Helvetica, sans-serif;color:#6a6a6a;">
                                                Die von mir getroffene Auswahl der BeleschBox kann ich jeden Monat neu
                                                festlegen</p>
                                            <p style="font-size: 14px;margin-bottom: 5px;font-family: Arial, Helvetica, sans-serif;color:#6a6a6a;">
                                                Änderungen werde ich der MedicCos Vertriebs UG rechtzeitig
                                                mitteilen.</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <p style="font-size: 12px;text-align:center;font-family: Arial, Helvetica, sans-serif;color:#6a6a6a;">
                                                MedicCos Vertriebs UG (haftungbeschränkt) Lindenbergplatz 16 - 38126
                                                Braunschweig | +49
                                                (0) 531 51605712 | info@belesch-box.de</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            @endif
                        </div>

                    </div>
                </div>
            </div>

            <div id="step5" style="display: none" data-step5="0">
                <div class="row">
                    <div class="col-md-12 mt-4">
                        <h2>Zusammenfassung Ihrer Anfrage</h2>
                        <p>Bitte überprüfen Sie alle Informationen, bevor Sie Ihre Anfrage einreichen.</p>
                    </div>
                    
                    <!-- Zusammenfassung der persönlichen Informationen -->
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-user"></i> Persönliche Informationen</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Vollständiger Name:</strong> <span id="summary_full_name"></span></p>
                                        <p><strong>E-Mail:</strong> <span id="summary_email"></span></p>
                                        <p><strong>Telefon:</strong> <span id="summary_phone"></span></p>
                                        <p><strong>Geburtsdatum:</strong> <span id="summary_birth_date"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Adresse:</strong> <span id="summary_address"></span></p>
                                        <p><strong>Postleitzahl:</strong> <span id="summary_zip"></span></p>
                                        <p><strong>Stadt:</strong> <span id="summary_city"></span></p>
                                        <p><strong>Pflegegrad:</strong> <span id="summary_pflegegrad"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Zusammenfassung der Versicherungsinformationen -->
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-shield-alt"></i> Versicherungsinformationen</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Versicherungstyp:</strong> <span id="summary_insurance_type"></span></p>
                                        <p><strong>Name der Versicherung:</strong> <span id="summary_insurance_name"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Versicherungsnummer:</strong> <span id="summary_insurance_number"></span></p>
                                        <p><strong>Krankenkasse Nummer:</strong> <span id="summary_krankenkasse_number"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Résumé de l'adresse de livraison -->
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-truck"></i> Lieferadresse</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Name des Empfängers:</strong> <span id="summary_delivery_name"></span></p>
                                        <p><strong>Straße:</strong> <span id="summary_delivery_street"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Hausnummer:</strong> <span id="summary_delivery_number"></span></p>
                                        <p><strong>Postleitzahl:</strong> <span id="summary_delivery_zip"></span></p>
                                        <p><strong>Stadt:</strong> <span id="summary_delivery_city"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Résumé du bleshbox et produits sélectionnés -->
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-box"></i> Ihre BeleschBox</h5>
                            </div>
                            <div class="card-body">
                                <div id="summary_products_list">
                                    <p class="text-muted">Keine Produkte ausgewählt</p>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <p><strong>Anzahl der Produkte:</strong> <span id="summary_products_count">0</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Gesamtwert:</strong> <span id="summary_total_value">0€</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Résumé de la signature -->
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-signature"></i> Unterschrift</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <p><strong>Ihre Unterschrift:</strong></p>
                                        <div class="signature-display">
                                            <img id="summary_signature" src="" alt="Signature" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 5px; background: white;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-12 text-right">
                        @if(isset($package_data) && $package_data['isPackage'])
                        <button class="btn btn__primary btn__rounded checkout_btn_pkg" onclick="checkout_btn_pkg()">einreichen</button>
                        @else
                        <button class="btn btn__primary btn__rounded checkout_btn" onclick="checkout_btn()">einreichen</button>
                        @endif
                    </div>
                </div>
            </div>
            
            <!-- Bloc de consentement - masqué par défaut -->
            <div id="consent-section-3" style="display: none !important;">
                <div class="condition-check-wrap mt-20">
                    <input type="checkbox" id="agreement" name="agreement">
                    <label for="condition-chcek">Hiermit stimme ich zu, dass pflege.de (web care LBJ GmbH) meine
                        personenbezogenen (ggf. auch gesundheitsbezogenen) Informationen, v.a.
                        Kontaktinfos/Versichertenstatus, für die Bearbeitung des Antrages (zum Erhalt der
                        Pflegehilfsmittel) sowie für eine Kontaktaufnahme in diesem Zusammenhang via E-Mail
                        speichert und verarbeitet.
                    </label>
                </div>
            </div>
            
            <div id="printPageArea1" style="display: none;">
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: white;">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
                        <div>
                            <h1 style="color: #333; font-size: 28px; font-weight: bold; margin: 0 0 10px 0; font-family: serif;">
                                Auswahl der gewünschten BeleschBox
                            </h1>
                            <div style="color: #009ee1; font-size: 16px; font-weight: bold; margin-bottom: 8px;">
                                Lieferinformationen angeben
                            </div>
                            <div style="font-size: 14px; margin-bottom: 20px;">
                                Versicherte/r (gemäß Antrag auf Kostenübernahme):
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-bottom: 10px;">
                                <div style="position: absolute; top: -8px; left: 8px; width: 60px; height: 60px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                <div style="position: absolute; top: 8px; right: -8px; width: 60px; height: 60px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                            </div>
                            <div style="color: #009ee1; font-size: 18px; font-weight: bold; font-family: serif;">BeleschBox</div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <div style="margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; margin-right: 30px;">
                                <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="title_name_fr_pd1"></div>
                                <span>Frau</span>
                            </div>
                            <div style="display: flex; align-items: center; margin-right: 30px;">
                                <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="title_name_her_pd1"></div>
                                <span>Herr</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; margin-bottom: 15px;">
                            <div style="margin-right: 40px;">
                                <span>Vorname:</span>
                                <div style="border-bottom: 1px solid #333; width: 200px; display: inline-block; margin-left: 10px;">
                                    <span id="first_name_pd1" style="padding: 0 5px;"></span>
                                </div>
                            </div>
                            <div>
                                <span>Nachname:</span>
                                <div style="border-bottom: 1px solid #333; width: 200px; display: inline-block; margin-left: 10px;">
                                    <span id="last_name_pd1" style="padding: 0 5px;"></span>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <span>Pflegegrad:</span>
                            <div style="display: inline-flex; margin-left: 20px;">
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="pflegegrad_1_pd1"></div>
                                    <span>1</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="pflegegrad_2_pd1"></div>
                                    <span>2</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="pflegegrad_3_pd1"></div>
                                    <span>3</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="pflegegrad_4_pd1"></div>
                                    <span>4</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="pflegegrad_5_pd1"></div>
                                    <span>5</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BeleschBox Selection -->
                    <div style="margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <!-- BeleschBox 1 -->
                            <div style="border: 1px solid #ddd; padding: 15px; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb1_pd1"></div>
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                        <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                        <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                    </div>
                                    <strong style="color: #009ee1;">BeleschBox 1</strong>
                                </div>
                                <div style="font-size: 12px; line-height: 1.4;">
                                    2x 100 Stück Einmalhandschuhe<br>
                                    500 ml Handdesinfektion<br>
                                    500 ml Flächendesinfektion<br>
                                    12 Stück FFP2 Masken
                                </div>
                            </div>

                            <!-- BeleschBox 2 -->
                            <div style="border: 1px solid #ddd; padding: 15px; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb2_pd1"></div>
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                        <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                        <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                    </div>
                                    <strong style="color: #009ee1;">BeleschBox 2</strong>
                                </div>
                                <div style="font-size: 12px; line-height: 1.4;">
                                    100 Stück Einmalhandschuhe<br>
                                    2x 500 ml Handdesinfektion<br>
                                    25 Stück Bettschutzeinlagen<br>
                                    8 Stück FFP2 Masken
                                </div>
                            </div>

                            <!-- BeleschBox 3 -->
                            <div style="border: 1px solid #ddd; padding: 15px; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb3_pd1"></div>
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                        <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                        <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                    </div>
                                    <strong style="color: #009ee1;">BeleschBox 3</strong>
                                </div>
                                <div style="font-size: 12px; line-height: 1.4;">
                                    1 Pack Desinfektionstücher<br>
                                    1x 500 ml Handdesinfektion<br>
                                    1x 500 ml Flächendesinfektion<br>
                                    10 Stück FFP2 Masken
                                </div>
                            </div>

                            <!-- BeleschBox 4 -->
                            <div style="border: 1px solid #ddd; padding: 15px; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb4_pd1"></div>
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                        <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                        <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                    </div>
                                    <strong style="color: #009ee1;">BeleschBox 4</strong>
                                </div>
                                <div style="font-size: 12px; line-height: 1.4;">
                                    2x 500 ml Flächendesinfektion<br>
                                    2x 500 ml Handdesinfektion<br>
                                    25 Stück Bettschutzeinlagen<br>
                                    FFP2 Masken
                                </div>
                            </div>

                            <!-- BeleschBox 5 -->
                            <div style="border: 1px solid #ddd; padding: 15px; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb5_pd1"></div>
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                        <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                        <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                    </div>
                                    <strong style="color: #009ee1;">BeleschBox 5</strong>
                                </div>
                                <div style="font-size: 12px; line-height: 1.4;">
                                    2x 100 Stück Einmalhandschuhe<br>
                                    500 ml Handdesinfektion<br>
                                    1 Pack Desinfektionstücher<br>
                                    4 Stück FFP2 Masken
                                </div>
                            </div>

                            <!-- BeleschBox 6 -->
                            <div style="border: 1px solid #ddd; padding: 15px; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb6_pd1"></div>
                                    <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                        <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                        <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                    </div>
                                    <strong style="color: #009ee1;">BeleschBox 6</strong>
                                </div>
                                <div style="font-size: 12px; line-height: 1.4;">
                                    100 Stück Einmalhandschuhe<br>
                                    500 ml Handdesinfektion<br>
                                    500 ml Flächendesinfektion<br>
                                    25 Stück Bettschutzeinlagen<br>
                                    6 Stück FFP2 Masken
                                </div>
                            </div>
                        </div>

                        <!-- BeleschBox Individuell -->
                        <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <div class="beleschbox-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 10px; display: flex; align-items: center; justify-content: center;" id="bb_individuell_pd1"></div>
                                <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #009ee1 0%, #4A90E2 100%); position: relative; margin-right: 10px;">
                                    <div style="position: absolute; top: -4px; left: 4px; width: 30px; height: 30px; background: linear-gradient(135deg, #66C2FF 0%, #009ee1 100%); transform: skewX(-30deg);"></div>
                                    <div style="position: absolute; top: 4px; right: -4px; width: 30px; height: 30px; background: linear-gradient(135deg, #004499 0%, #003366 100%); transform: skewY(-30deg);"></div>
                                </div>
                                <strong style="color: #009ee1;">BeleschBox Individuell</strong>
                            </div>
                            <div style="margin-top: 10px;">
                                <div style="border-bottom: 1px solid #333; width: 100%; height: 20px; margin-bottom: 10px;"></div>
                                <div style="border-bottom: 1px solid #333; width: 100%; height: 20px; margin-bottom: 10px;"></div>
                                <div style="border-bottom: 1px solid #333; width: 100%; height: 20px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Handschuhgröße -->
                    <div style="margin-bottom: 30px;">
                        <div style="margin-bottom: 10px;">
                            <span style="font-weight: bold;">Handschuhgröße:</span>
                            <div style="display: inline-flex; margin-left: 20px;">
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div class="glove-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="glove_s_pd1"></div>
                                    <span>S</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div class="glove-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="glove_m_pd1"></div>
                                    <span>M</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-right: 20px;">
                                    <div class="glove-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="glove_l_pd1"></div>
                                    <span>L</span>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div class="glove-checkbox" style="width: 20px; height: 20px; border: 2px solid #333; margin-right: 8px; display: flex; align-items: center; justify-content: center;" id="glove_xl_pd1"></div>
                                    <span>XL</span>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-left: 20px;">
                            (Bei fehlender Angabe wird Größe M geliefert)
                        </div>
                    </div>

                    <!-- Agreement Text -->
                    <div style="margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; background-color: #f9f9f9;">
                        <p style="margin: 0; font-size: 14px; line-height: 1.5;">
                            Die von mir getroffene Auswahl der BeleschBox kann ich jeden Monat neu festlegen.<br>
                            Änderungen werde ich der MedicCos Inko&Care GmbH rechtzeitig mitteilen.
                        </p>
                    </div>

                    <!-- Signature and Date -->
                    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px;">
                        <div style="display: flex; align-items: center;">
                            <span style="margin-right: 10px;">X</span>
                            <div style="border-bottom: 1px solid #333; width: 200px; height: 20px; margin-right: 10px;"></div>
                            <span>Unterschrift</span>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span style="margin-right: 10px;">Datum</span>
                            <div style="border-bottom: 1px solid #333; width: 150px; height: 20px;"></div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div style="text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 10px;">
                        MedicCos Inko&Care GmbH Lindenbergplatz 1 - 38126 Braunschweig | +49 (0) 531 51605712 | info@belesch-box.de
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End Livewire Component Content -->
    @livewire('frontend.includes.footer')


    <script src="{{asset('/frontend/assets/js/jquery-3.5.1.min.js')}}"></script>

    <!-- Email Search JavaScript -->
    <script>
        // Données réelles de la base de données (ID: 133)
        const customers = [
            {
                email: 'karim.hasni@medic-cos.de',
                firstName: 'karim',
                lastName: 'hasni',
                street: 'lindern',
                houseNo: '6a',
                zip: '38100',
                city: 'braunschweig',
                dob: '1978-02-28',
                telephone: '0531',
                insuranceName: 'Barmer',
                insuranceNumber: '2154h24',
                healthInsuranceNo: '123454'
            }
        ];

        let currentCustomer = null;
        let emailExists = false; // Variable pour indiquer si l'email existe déjà
        let insuranceNumberExists = false; // Variable pour indiquer si le numéro d'assurance existe déjà
        let krankenkasseNumberExists = false; // Variable pour indiquer si le numéro de Krankenkasse existe déjà
        let emailFoundBySearch = false; // Variable pour indiquer si l'email a été trouvé par recherche
        let insuranceNumberFoundBySearch = false; // Variable pour indiquer si le numéro d'assurance a été trouvé par recherche
        let krankenkasseNumberFoundBySearch = false; // Variable pour indiquer si le numéro de Krankenkasse a été trouvé par recherche

        // Fonction pour vérifier si l'email existe dans le formulaire
        function checkEmailExistsInForm() {
            const email = document.getElementById('email2').value;
            const errorSpan = document.querySelector('.email2_error_msg');
            
            if (!email) {
                emailExists = false;
                if (errorSpan) errorSpan.textContent = '';
                return;
            }
            
            // Appel à l'API pour vérifier l'email
            fetch('/check-email-exists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    email: email
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    emailExists = true;
                    if (errorSpan) {
                        errorSpan.textContent = '⚠️ Diese E-Mail-Adresse existiert bereits in unserer Datenbank.';
                        errorSpan.style.color = 'red';
                    }
                } else {
                    emailExists = false;
                    if (errorSpan) {
                        errorSpan.textContent = '';
                    }
                }
            })
            .catch(error => {
                console.error('Fehler bei der E-Mail-Überprüfung:', error);
                emailExists = false;
            });
        }

        // Fonction pour vérifier si le numéro d'assurance existe
        function checkInsuranceNumberExists() {
            const insuranceNumber = document.getElementById('insurance-no').value;
            const errorSpan = document.querySelector('.insuranceno_error_msg');
            
            if (!insuranceNumber) {
                insuranceNumberExists = false;
                if (errorSpan) errorSpan.textContent = '';
                return;
            }
            
            // Appel à l'API pour vérifier le numéro d'assurance
            fetch('/check-insurance-number-exists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    insurance_number: insuranceNumber
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    insuranceNumberExists = true;
                    if (errorSpan) {
                        errorSpan.textContent = '⚠️ Diese Versichertennummer existiert bereits in unserer Datenbank.';
                        errorSpan.style.color = 'red';
                    }
                } else {
                    insuranceNumberExists = false;
                    if (errorSpan) {
                        errorSpan.textContent = '';
                    }
                }
            })
            .catch(error => {
                console.error('Fehler bei der Versicherungsnummer-Überprüfung:', error);
                insuranceNumberExists = false;
            });
        }

        // Fonction pour vérifier si le numéro de Krankenkasse existe
        function checkKrankenkasseNumberExists() {
            const krankenkasseNumber = document.getElementById('KrankenkasseNummer').value;
            const errorSpan = document.querySelector('.krankenkasse_error_msg');
            
            if (!krankenkasseNumber) {
                krankenkasseNumberExists = false;
                if (errorSpan) errorSpan.textContent = '';
                return;
            }
            
            // Appel à l'API pour vérifier le numéro de Krankenkasse
            fetch('/check-krankenkasse-number-exists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    krankenkasse_number: krankenkasseNumber
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    krankenkasseNumberExists = true;
                    if (errorSpan) {
                        errorSpan.textContent = '⚠️ Diese Krankenkassen-Nummer existiert bereits in unserer Datenbank.';
                        errorSpan.style.color = 'red';
                    }
                } else {
                    krankenkasseNumberExists = false;
                    if (errorSpan) {
                        errorSpan.textContent = '';
                    }
                }
            })
            .catch(error => {
                console.error('Fehler bei der Krankenkassen-Nummer-Überprüfung:', error);
                krankenkasseNumberExists = false;
            });
        }

        function searchCustomerByEmail() {
            const email = document.getElementById('search_email').value;
            const alertMessage = document.getElementById('alertMessage');
            const clearBtn = document.getElementById('clearBtn');
            const debugInfo = document.getElementById('debugInfo');
            
            debugInfo.textContent = 'Suche läuft...';
            debugInfo.style.color = '#ffc107';
            
            // Simulate loading
            setTimeout(() => {
                if (!email) {
                    showAlert('Bitte geben Sie eine Email-Adresse ein.', 'warning');
                    debugInfo.textContent = 'Fehler - E-Mail fehlt';
                    debugInfo.style.color = '#dc3545';
                    return;
                }
                
                // Check if email matches our real data
                const customer = customers.find(c => c.email === email);
                
                if (customer) {
                    currentCustomer = customer;
                    
                    // Fill form fields
                    fillField('first_name', customer.firstName);
                    fillField('last_name', customer.lastName);
                    fillField('streetno', customer.street);
                    fillField('houseno', customer.houseNo);
                    fillField('zip', customer.zip);
                    fillField('city', customer.city);
                    fillField('dob', customer.dob);
                    fillField('telno', customer.telephone);
                    fillField('email2', customer.email);
                    fillField('health_insurance', customer.insuranceName);
                    fillField('insurance_no', customer.insuranceNumber);
                    fillField('krankenkasse_nummer', customer.healthInsuranceNo);
                    
                    // Hide password fields
                    hidePasswordFields();
                    
                    // Show success message
                    showAlert('✅ Kunde gefunden! Données réelles de la base : Karim Hasni', 'success');
                    
                    // Show clear button
                    clearBtn.style.display = 'inline-block';
                    
                    // Update debug info
                    debugInfo.textContent = '✅ Client trouvé dans la base de données (ID: 133)';
                    debugInfo.style.color = '#28a745';
                    
                } else {
                    currentCustomer = null;
                    
                    // Clear form fields
                    clearForm();
                    
                    // Show password fields
                    showPasswordFields();
                    
                    // Show warning message
                    showAlert('⚠️ Kein Kunde gefunden! Email nicht in der Datenbank.', 'warning');
                    
                    // Hide clear button
                    clearBtn.style.display = 'none';
                    
                    // Update debug info
                    debugInfo.textContent = '❌ Client non trouvé';
                    debugInfo.style.color = '#dc3545';
                }
            }, 800);
        }
        
        function fillField(fieldId, value) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.style.transition = 'all 0.3s ease';
                field.style.transform = 'scale(1.05)';
                field.style.borderColor = '#28a745';
                
                setTimeout(() => {
                    field.value = value;
                    field.style.transform = 'scale(1)';
                    field.style.borderColor = '';
                }, 200);
            }
        }
        
        function hidePasswordFields() {
            const passwordSection = document.querySelector('.row:has(#password)');
            if (passwordSection) {
                passwordSection.style.display = 'none';
            }
        }
        
        function showPasswordFields() {
            const passwordSection = document.querySelector('.row:has(#password)');
            if (passwordSection) {
                passwordSection.style.display = 'flex';
            }
        }
        
        function clearCustomerData() {
            currentCustomer = null;
            clearForm();
            document.getElementById('search_email').value = '';
            showPasswordFields();
            document.getElementById('clearBtn').style.display = 'none';
            document.getElementById('alertMessage').innerHTML = '';
            document.getElementById('debugInfo').textContent = 'Données effacées';
            document.getElementById('debugInfo').style.color = '#6c757d';
        }
        
        function clearForm() {
            const fields = [
                'first_name', 'last_name', 'streetno', 'houseno', 'zip', 'city', 
                'dob', 'telno', 'email2', 'health_insurance', 'insurance_no', 'krankenkasse_nummer'
            ];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.value = '';
                }
            });
        }
        
        function showAlert(message, type) {
            showModernModal(message, type);
        }
        
        function showModernModal(message, type) {
            // Créer le modal s'il n'existe pas
            let modal = document.getElementById('modernAlertModal');
            if (!modal) {
                modal = createModernModal();
            }
            
            // Définir les couleurs selon le type
            let iconClass, bgColor, iconColor, title;
            switch(type) {
                case 'success':
                    iconClass = 'fas fa-check-circle';
                    bgColor = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                    iconColor = '#11998e';
                    title = 'Erfolg';
                    break;
                case 'warning':
                    iconClass = 'fas fa-exclamation-triangle';
                    bgColor = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                    iconColor = '#f5576c';
                    title = 'Warnung';
                    break;
                case 'danger':
                    iconClass = 'fas fa-times-circle';
                    bgColor = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)';
                    iconColor = '#ee5a52';
                    title = 'Fehler';
                    break;
                case 'info':
                default:
                    iconClass = 'fas fa-info-circle';
                    bgColor = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                    iconColor = '#4facfe';
                    title = 'Information';
                    break;
            }
            
            // Mettre à jour le contenu du modal
            modal.querySelector('.modal-header').style.background = bgColor;
            modal.querySelector('.modal-icon i').className = iconClass;
            modal.querySelector('.modal-icon i').style.color = iconColor;
            modal.querySelector('.modal-title').textContent = title;
            modal.querySelector('.modal-body p').textContent = message;
            
            // Afficher le modal
            modal.style.display = 'flex';
            modal.classList.add('show');
            
            // Auto-fermer après 5 secondes pour les messages de succès
            if (type === 'success') {
                setTimeout(() => {
                    closeModernModal();
                }, 5000);
            }
        }
        
        function createModernModal() {
            const modal = document.createElement('div');
            modal.id = 'modernAlertModal';
            modal.className = 'modern-modal';
            modal.innerHTML = `
                <div class="modal-backdrop"></div>
                <div class="modal-container">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <h4 class="modal-title">Information</h4>
                            <button class="modal-close" onclick="closeModernModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>Message</p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-modal-close" onclick="closeModernModal()">
                                <i class="fas fa-check"></i> Verstanden
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }
        
        function closeModernModal() {
            const modal = document.getElementById('modernAlertModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }
        
        // Gestion des événements pour le modal
        document.addEventListener('DOMContentLoaded', function() {
            // Fermer le modal en cliquant sur le backdrop
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('modernAlertModal');
                if (modal && modal.classList.contains('show')) {
                    if (e.target.classList.contains('modal-backdrop')) {
                        closeModernModal();
                    }
                }
            });
            
            // Fermer le modal avec la touche Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModernModal();
                }
            });
        });
        
        // Fonction pour cacher le formulaire principal au chargement
        function hideMainFormOnLoad() {
            console.log('hideMainFormOnLoad called');
            
            // Cacher seulement les sections spécifiques du formulaire principal
            // Ne pas toucher au bloc de recherche d'email
            const elementsToHide = [
                document.querySelectorAll('.col-md-12.why-asking')[0], // Première occurrence seulement
                document.getElementById('iAm'),
                document.getElementById('insured-1'), // Bloc "Der Versicherte ist"
                document.getElementById('submit-section'), // Bouton "Weiter im Antrag"
                document.getElementById('submit-section-2'), // Deuxième bouton "Weiter im Antrag"
                document.getElementById('consent-section-3'), // Troisième bloc de consentement
                document.getElementById('consent-block-step2'), // Bloc de consentement step2
                document.getElementById('consent-form-block') // Bloc de consentement formulaire
            ];
            
            elementsToHide.forEach(element => {
                if (element) {
                    console.log('Hiding element:', element);
                    element.style.display = 'none';
                }
            });
        }
        

        // Auto-search when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DEBUG CHARGEMENT PAGE ===');
            console.log('Page chargée, recherche du bloc de consentement...');
            
            // Vérifier si le bloc de consentement existe
            const consentBlock = document.querySelector('.condition-check-wrap');
            if (consentBlock) {
                console.log('✅ Bloc de consentement trouvé:', consentBlock);
                console.log('Style display:', consentBlock.style.display);
                console.log('Parent display:', consentBlock.parentElement.style.display);
            } else {
                console.log('❌ Bloc de consentement NON trouvé');
            }
            
            // Vérifier toutes les divs avec condition-check-wrap
            const allConsentBlocks = document.querySelectorAll('.condition-check-wrap');
            console.log('Nombre de blocs condition-check-wrap trouvés:', allConsentBlocks.length);
            allConsentBlocks.forEach((block, index) => {
                console.log(`Bloc ${index}:`, block);
                console.log(`  - Visible:`, block.offsetParent !== null);
                console.log(`  - Display:`, window.getComputedStyle(block).display);
            });
            
            console.log('=== FIN DEBUG CHARGEMENT PAGE ===');
            // Ajouter le champ mot de passe dynamiquement
            addPasswordField();
            
            // Cacher le formulaire principal au chargement
            hideMainFormOnLoad();
            
            setTimeout(() => {
                if (document.getElementById('search_email').value) {
                    searchCustomerByEmail();
                } else {
                    // Vérifier l'état initial des boutons radio "Ich bin" et afficher la section si nécessaire
                    optperson();
                }
            }, 1000);
        });
        
        // Fonction pour ajouter le champ mot de passe
        function addPasswordField() {
            const emailContainer = document.querySelector('#search_email').closest('.col-md-8');
            if (emailContainer && !document.getElementById('search_password')) {
                // Modifier la largeur du champ email
                emailContainer.className = 'col-md-6';
                
                // Créer le champ mot de passe
                const passwordContainer = document.createElement('div');
                passwordContainer.className = 'col-md-6';
                passwordContainer.innerHTML = `
                    <label for="search_password" class="form-label">Mot de passe*</label>
                    <input type="password" 
                           class="form-control" 
                           id="search_password" 
                           placeholder="Geben Sie Ihr Passwort ein"
                           value="">
                `;
                
                // Insérer le champ mot de passe après le champ email
                emailContainer.parentNode.insertBefore(passwordContainer, emailContainer.nextSibling);
                
                console.log('Champ mot de passe ajouté dynamiquement');
            }
        }
    </script>

    <script>
        // Fonction pour afficher le formulaire de nouveau compte
        function showNewAccountForm() {
            console.log('=== DEBUG AFFICHAGE FORMULAIRE ===');
            console.log('Affichage du formulaire de nouveau compte');
            
            // Vérifier le bloc de consentement avant affichage
            const consentBlock = document.querySelector('.condition-check-wrap');
            if (consentBlock) {
                console.log('✅ Bloc de consentement trouvé avant affichage:', consentBlock);
                console.log('Style display avant:', consentBlock.style.display);
                console.log('Parent display avant:', consentBlock.parentElement.style.display);
            } else {
                console.log('❌ Bloc de consentement NON trouvé avant affichage');
            }
            
            // Afficher les sections du formulaire principal
            const sectionsToShow = document.querySelectorAll('.col-md-12.why-asking, #iAm, #insured-1, #submit-section, #submit-section-2');
            sectionsToShow.forEach(section => {
                if (section) {
                    section.style.display = 'block';
                }
            });
            
            // Afficher le bloc de consentement avec le formulaire
            const consentFormBlock = document.getElementById('consent-form-block');
            if (consentFormBlock) {
                console.log('✅ Affichage du bloc de consentement');
                consentFormBlock.style.display = 'block';
            } else {
                console.log('❌ Bloc de consentement non trouvé');
            }
            
            // Test simple - ajouter un bloc visible
            const testBlock = document.createElement('div');
            testBlock.innerHTML = '<div style="background: #ff0000; color: white; padding: 20px; margin: 20px 0; border: 3px solid #000; font-size: 18px; font-weight: bold; text-align: center;">🔴 BLOC DE TEST - FORMULAIRE AFFICHÉ 🔴</div>';
            const insuredSection = document.getElementById('insured-1');
            if (insuredSection && insuredSection.parentNode) {
                insuredSection.parentNode.insertBefore(testBlock, insuredSection.nextSibling);
            }
            
            
            // Masquer les champs de mot de passe du formulaire principal (pour nouveau compte)
            const passwordFields = document.querySelectorAll('.password-fields');
            passwordFields.forEach(field => {
                field.style.display = 'none';
            });
            
            // Scroll vers le formulaire
            const formElement = document.querySelector('.col-md-12.why-asking');
            if (formElement) {
                formElement.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Vérifier le bloc de consentement après affichage
            setTimeout(() => {
                const consentBlock = document.querySelector('.condition-check-wrap');
                if (consentBlock) {
                    console.log('✅ Bloc de consentement trouvé après affichage:', consentBlock);
                    console.log('Style display après:', consentBlock.style.display);
                    console.log('Parent display après:', consentBlock.parentElement.style.display);
                    console.log('Visible:', consentBlock.offsetParent !== null);
                } else {
                    console.log('❌ Bloc de consentement NON trouvé après affichage');
                }
                console.log('=== FIN DEBUG AFFICHAGE FORMULAIRE ===');
            }, 100);
        }

        // Fonction pour afficher le modal d'erreur de login
        function showLoginErrorModal() {
            const modalHtml = `
                <div class="modal fade" id="loginErrorModal" tabindex="-1" role="dialog" aria-labelledby="loginErrorModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title" id="loginErrorModalLabel">
                                    <i class="fas fa-exclamation-triangle"></i> Erreur de Connexion
                                </h5>
                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-danger">
                                    <h6><i class="fas fa-user-times"></i> Email ou mot de passe incorrect</h6>
                                    <p>Veuillez vérifier vos identifiants et réessayer.</p>
                                    <ul>
                                        <li>Vérifiez que votre adresse email est correcte</li>
                                        <li>Vérifiez que votre mot de passe est correct</li>
                                        <li>Assurez-vous que votre compte existe</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                    <i class="fas fa-times"></i> Fermer
                                </button>
                                <button type="button" class="btn btn-primary" onclick="clearLoginForm()">
                                    <i class="fas fa-edit"></i> Réessayer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Supprimer l'ancien modal s'il existe
            const existingModal = document.getElementById('loginErrorModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Ajouter le nouveau modal au body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Afficher le modal
            $('#loginErrorModal').modal('show');
        }
        
        // Fonction pour afficher le modal d'erreur technique
        function showTechnicalErrorModal() {
            const modalHtml = `
                <div class="modal fade" id="technicalErrorModal" tabindex="-1" role="dialog" aria-labelledby="technicalErrorModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-dark">
                                <h5 class="modal-title" id="technicalErrorModalLabel">
                                    <i class="fas fa-tools"></i> Erreur Technique
                                </h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-warning">
                                    <h6><i class="fas fa-exclamation-circle"></i> Problème de connexion</h6>
                                    <p>Une erreur technique s'est produite. Veuillez réessayer dans quelques instants.</p>
                                    <p class="mb-0">Si le problème persiste, contactez le support technique.</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                    <i class="fas fa-times"></i> Fermer
                                </button>
                                <button type="button" class="btn btn-primary" onclick="retryConnection()">
                                    <i class="fas fa-redo"></i> Réessayer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Supprimer l'ancien modal s'il existe
            const existingModal = document.getElementById('technicalErrorModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Ajouter le nouveau modal au body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Afficher le modal
            $('#technicalErrorModal').modal('show');
        }
        
        // Fonction pour vider le formulaire de login
        function clearLoginForm() {
            document.getElementById('search_email').value = '';
            const passwordField = document.getElementById('search_password');
            if (passwordField) {
                passwordField.value = '';
            }
            $('#loginErrorModal').modal('hide');
        }
        
        // Fonction pour réessayer la connexion
        function retryConnection() {
            $('#technicalErrorModal').modal('hide');
            // Optionnel : relancer automatiquement la recherche
            // testSearchCustomer();
        }
        

        // Fonction de recherche simplifiée et fonctionnelle
        function testSearchCustomer() {
            console.log('Fonction testSearchCustomer appelée !');
            
            const email = document.getElementById('search_email').value;
            const password = document.getElementById('search_password') ? document.getElementById('search_password').value : '';
            console.log('Email saisi:', email);
            console.log('Mot de passe saisi:', password);
            
            if (!email) {
                alert('Veuillez saisir une adresse email.');
                return;
            }
            
            if (!password) {
                alert('Veuillez saisir un mot de passe.');
                return;
            }
            
            // Appel API pour vérifier l'email et le mot de passe
            const requestData = { 
                email: email,
                password: password
            };
            console.log('Données envoyées à l\'API:', requestData);
            
            fetch('/check-email-exists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify(requestData)
            })
            .then(response => {
                console.log('Statut de la réponse:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Réponse API complète:', data);
                console.log('Client existe:', data.exists);
                console.log('Données client:', data.customer);
                
                if (data.exists && data.customer) {
                    console.log('Client trouvé:', data.customer);
                    
                    // Remplir les champs avec logs de débogage
                    const fieldsToFill = [
                        { id: 'first_name', value: data.customer.firstName, name: 'Prénom' },
                        { id: 'last_name', value: data.customer.lastName, name: 'Nom' },
                        { id: 'streetno', value: data.customer.street, name: 'Rue' },
                        { id: 'houseno', value: data.customer.houseNo, name: 'Numéro' },
                        { id: 'zip', value: data.customer.zipcode, name: 'Code postal' },
                        { id: 'city', value: data.customer.city, name: 'Ville' },
                        { id: 'Gaburtadatum', value: data.customer.dob, name: 'Date de naissance' },
                        { id: 'telno', value: data.customer.telephone, name: 'Téléphone' },
                        { id: 'email2', value: data.customer.email, name: 'Email' },
                        { id: 'health-insurance', value: data.customer.insuranceName, name: 'Assurance' },
                        { id: 'insurance-no', value: data.customer.insuranceNumber, name: 'Numéro assurance' },
                        { id: 'KrankenkasseNummer', value: data.customer.healthInsuranceNo, name: 'Numéro Krankenkasse' }
                    ];
                    
                    fieldsToFill.forEach(field => {
                        const element = document.getElementById(field.id);
                        if (element) {
                            element.value = field.value || '';
                            console.log(`✅ ${field.name} rempli: ${field.value}`);
                        } else {
                            console.log(`❌ Champ ${field.name} (${field.id}) non trouvé`);
                        }
                    });
                    
                    // Remplir les radio buttons
                    console.log('Remplissage des radio buttons...');
                    
                    // Radio button "Versicherter" / "Angehöriger / Pflegeperson"
                    if (data.customer.insured_type) {
                        console.log('Type assuré:', data.customer.insured_type);
                        if (data.customer.insured_type === 'Versicherter') {
                            const versicherterRadio = document.querySelector('input[name="insured"][value="Versicherter"]');
                            if (versicherterRadio) {
                                versicherterRadio.checked = true;
                                console.log('✅ Radio Versicherter sélectionné');
                            } else {
                                console.log('❌ Radio Versicherter non trouvé');
                            }
                        } else if (data.customer.insured_type === 'Angehöriger / Pflegeperson' || data.customer.insured_type === 'Pflegeperson') {
                            const pflegepersonRadio = document.querySelector('input[name="insured"][value="Pflegeperson"]');
                            if (pflegepersonRadio) {
                                pflegepersonRadio.checked = true;
                                console.log('✅ Radio Pflegeperson sélectionné');
                            } else {
                                console.log('❌ Radio Pflegeperson non trouvé');
                            }
                        }
                    }
                    
                    // Radio button "Herr" / "Frau"
                    if (data.customer.surname) {
                        console.log('Titre:', data.customer.surname);
                        if (data.customer.surname === 'Herr') {
                            const herrRadio = document.querySelector('input[name="title_name"][value="Herr"]');
                            if (herrRadio) {
                                herrRadio.checked = true;
                                console.log('✅ Radio Herr sélectionné');
                            } else {
                                console.log('❌ Radio Herr non trouvé');
                            }
                        } else if (data.customer.surname === 'Frau') {
                            const frauRadio = document.querySelector('input[name="title_name"][value="Frau"]');
                            if (frauRadio) {
                                frauRadio.checked = true;
                                console.log('✅ Radio Frau sélectionné');
                            } else {
                                console.log('❌ Radio Frau non trouvé');
                            }
                        }
                    }
                    
                    // Radio button Pflegegrad
                    console.log('=== DÉBUT DEBUG PFLEGEGRAD ===');
                    console.log('Données client complètes:', data.customer);
                    console.log('Pflegegrad dans les données:', data.customer.pflegegrad);
                    console.log('Type de pflegegrad:', typeof data.customer.pflegegrad);
                    console.log('=== DEBUG INSURANCE TYPE ===');
                    console.log('Insurance_type dans les données:', data.customer.insurance_type);
                    console.log('Type de insurance_type:', typeof data.customer.insurance_type);
                    
                    if (data.customer.pflegegrad) {
                        console.log('Pflegegrad reçu de la base de données:', data.customer.pflegegrad);
                        
                        // Extraire le numéro du pflegegrad (ex: "Pflegegrad3" -> "3" ou "3" -> "3")
                        let pflegegradValue = data.customer.pflegegrad.toString();
                        if (pflegegradValue.startsWith('Pflegegrad')) {
                            pflegegradValue = pflegegradValue.replace('Pflegegrad', '');
                        }
                        
                        console.log('Valeur Pflegegrad extraite:', pflegegradValue);
                        
                        // Essayer plusieurs approches pour sélectionner le Pflegegrad
                        function trySelectPflegegrad() {
                            console.log('Tentative de sélection du Pflegegrad...');
                            
                            // Méthode 1: Sélection avec le bon nom et la bonne valeur
                            const pflegegradRadio = document.querySelector(`input[name="Pflegegrad"][value="Pflegegrad${pflegegradValue}"]`);
                        if (pflegegradRadio) {
                            pflegegradRadio.checked = true;
                                console.log(`✅ Radio Pflegegrad ${pflegegradValue} sélectionné (méthode 1)`);
                                pflegegradRadio.dispatchEvent(new Event('change'));
                                return true;
                            }
                            
                            // Méthode 2: Par ID (essayer les différents IDs possibles)
                            const pflegegradById = document.getElementById(`pflegegrad${pflegegradValue}`) || 
                                                  document.getElementById(`Pflegegrad`) ||
                                                  document.getElementById(`inlineRadio${pflegegradValue}`);
                            if (pflegegradById) {
                                pflegegradById.checked = true;
                                console.log(`✅ Radio Pflegegrad ${pflegegradValue} sélectionné (méthode 2)`);
                                pflegegradById.dispatchEvent(new Event('change'));
                                return true;
                            }
                            
                            // Méthode 3: Lister tous les boutons et chercher avec le bon nom
                            const allRadios = document.querySelectorAll('input[type="radio"]');
                            console.log('Tous les boutons radio trouvés:', allRadios.length);
                            allRadios.forEach((radio, index) => {
                                console.log(`Radio ${index}: name="${radio.name}", value="${radio.value}", id="${radio.id}"`);
                                if (radio.name === 'Pflegegrad' && radio.value === `Pflegegrad${pflegegradValue}`) {
                                    radio.checked = true;
                                    console.log(`✅ Radio Pflegegrad ${pflegegradValue} sélectionné (méthode 3)`);
                                    radio.dispatchEvent(new Event('change'));
                                    return true;
                                }
                            });
                            
                            console.log(`❌ Radio Pflegegrad ${pflegegradValue} non trouvé avec toutes les méthodes`);
                            return false;
                        }
                        
                        // Essayer immédiatement
                        if (!trySelectPflegegrad()) {
                            // Si ça ne marche pas, essayer avec des délais
                            setTimeout(() => trySelectPflegegrad(), 100);
                            setTimeout(() => trySelectPflegegrad(), 500);
                            setTimeout(() => trySelectPflegegrad(), 1000);
                        }
                    } else {
                        console.log('Aucun Pflegegrad trouvé dans les données client');
                    }
                    console.log('=== FIN DEBUG PFLEGEGRAD ===');
                    
                    // Sélectionner le type d'assurance (insurance_type)
                    if (data.customer.insurance_type) {
                        console.log('=== DÉBUT DEBUG INSURANCE TYPE SELECTION ===');
                        console.log('Insurance_type reçu:', data.customer.insurance_type);
                        
                        const insuranceType = data.customer.insurance_type;
                        let selectedValue = null;
                        
                        if (insuranceType === 'G') {
                            selectedValue = 'option5'; // Gesetzlich versichert
                        } else if (insuranceType === 'P') {
                            selectedValue = 'option6'; // Privat versichert
                        }
                        
                        if (selectedValue) {
                            console.log('Tentative de sélection insurance_type:', selectedValue);
                            
                            // Essayer de sélectionner dans les deux sections
                            const radio1 = document.querySelector(`input[name="inlineRadioOptions5"][value="${selectedValue}"]`);
                            const radio2 = document.querySelector(`input[name="inlineRadioOptions5_2"][value="${selectedValue}"]`);
                            
                            if (radio1) {
                                radio1.checked = true;
                                console.log('✅ Radio insurance_type sélectionné (section 1)');
                                radio1.dispatchEvent(new Event('change'));
                            }
                            
                            if (radio2) {
                                radio2.checked = true;
                                console.log('✅ Radio insurance_type sélectionné (section 2)');
                                radio2.dispatchEvent(new Event('change'));
                            }
                            
                            if (!radio1 && !radio2) {
                                console.log('❌ Aucun radio insurance_type trouvé');
                            }
                        } else {
                            console.log('❌ Valeur insurance_type non reconnue:', insuranceType);
                        }
                        console.log('=== FIN DEBUG INSURANCE TYPE SELECTION ===');
                    } else {
                        console.log('Aucun insurance_type trouvé dans les données client');
                    }
                    
                    // Afficher les sections du formulaire (mais pas la section de résumé)
                    const sectionsToShow = document.querySelectorAll('.col-md-12.why-asking, #iAm, #insured, #insured-1, #submit-section, #submit-section-2');
                    sectionsToShow.forEach(section => {
                        section.style.setProperty('display', 'block', 'important');
                    });
                    
                    // S'assurer que la section de résumé (step5) reste masquée
                    const summarySection = document.getElementById('step5');
                    if (summarySection) {
                        summarySection.style.display = 'none';
                    }
                    
                    // Les blocs de consentement sont maintenant gérés par les étapes
                    
                    // Réafficher les boutons "Weiter im Antrag"
                    const allButtons = document.querySelectorAll('button');
                    allButtons.forEach(button => {
                        if (button.textContent.includes('Weiter im Antrag')) {
                            button.style.display = 'block';
                            if (button.parentElement && button.parentElement.classList.contains('text-right')) {
                                button.parentElement.style.display = 'block';
                            }
                        }
                    });
                    
                    // Masquer les champs de mot de passe du formulaire principal lors du remplissage auto
                    const passwordFields = document.querySelectorAll('.password-fields');
                    passwordFields.forEach(field => {
                        field.style.setProperty('display', 'none', 'important');
                    });
                    
                } else {
                    console.log('Client non trouvé - Connexion échouée');
                    
                    // Afficher un modal d'erreur pour login/mot de passe incorrect
                    showLoginErrorModal();
                }
                
                // Ajouter un événement pour afficher la valeur sélectionnée en temps réel
                $('input[name="inlineRadioOptions5"], input[name="inlineRadioOptions5_2"]').on('change', function() {
                    const selectedValue = $(this).val();
                    if (selectedValue) {
                        const displayText = selectedValue === 'option5' ? 'Gesetzlich versichert (Kostenübernahme durch die Pflegekasse)' : 'Privat versichert';
                        $('#insurance-type-value').text(displayText);
                        $('#insurance-type-display').show();
                        console.log('Radio button changed to:', selectedValue, 'Display text:', displayText);
                    } else {
                        $('#insurance-type-display').hide();
                    }
                });
            })
            .catch(error => {
                console.error('Erreur API:', error);
                console.log('Erreur lors de la recherche: ' + error.message);
                
                // Afficher un modal d'erreur pour erreur technique
                showTechnicalErrorModal();
            });
        }
    </script>

    <script>
		// Display Title and descruption for the current Step (data is in steps.json file)
		document.addEventListener('DOMContentLoaded', function() {
			const infos = @json($steps);
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        const target = mutation.target;
                        if (target.style.display === 'block') {
                            currentStep = parseInt(target.id.replace('step', ''));
				            document.getElementById('current-step-title').innerText = infos[currentStep-1]['title'];
				            document.getElementById('current-step-description').innerText = infos[currentStep-1]['description'];
                        }
                    }
                });
            });
            document.querySelectorAll('[id^="step"]').forEach(function(stepDiv) {
                if (/^step\d+$/.test(stepDiv.id)) {
                    observer.observe(stepDiv, { attributes: true });
                }
            });
            
            // L'état initial est géré par le script séparé ci-dessus
        });
	
        $("#same_address").change(function() {
            if (this.checked) {
                $("#getDiffAddr").css("display", "none");
            } else {
                $("#getDiffAddr").css("display", "block");
            }
        });

        function getSetpData() {

            if ($(".step5").hasClass("active") == true) {
                $("#step4").css("display", "block");
                $(".step5").removeClass("active");
                $(".step4").addClass("active");
                $("#step5").css("display", "none");
                
                // Masquer le bloc de consentement secondaire quand on revient en arrière
                const consentSection3 = document.getElementById('consent-section-3');
                if (consentSection3) {
                    consentSection3.style.display = 'none';
                    console.log('Bloc de consentement secondaire masqué - retour à l\'étape 4');
                }
            } else if ($(".step4").hasClass("active") == true) {
                $("#step3").css("display", "block");
                $(".step4").removeClass("active");
                $(".step3").addClass("active");
                $("#step4").css("display", "none");
            } else if ($(".step3").hasClass("active") == true) {
                $("#step2").css("display", "block");
                $(".step3").removeClass("active");
                $(".step2").addClass("active");
                $("#step3").css("display", "none");
            } else if ($(".step2").hasClass("active") == true) {
                $("#step1").css("display", "block");
                $(".step2").removeClass("active");
                $(".step1").addClass("active");
                $("#step2").css("display", "none");

            }
            
            // Forcer les couleurs après changement d'étape
            setTimeout(function() {
                forceStepColors();
            }, 100);

            //  if($(".step1").hasClass("active") == true)
            //  {
            //   alert('this page 1');
            //  } 
        }
    </script>

    <script>
        $(".second-button").click(function() {
            // Variable pour vérifier si tous les champs sont valides
            var isValid = true;
            var errorMessages = [];
            

            // Fonction pour ajouter/enlever la classe error
            function addErrorClass(selector) {
                $(selector).addClass('error');
            }
            
            function removeErrorClass(selector) {
                $(selector).removeClass('error');
            }

            // Validation des champs requis
            if ($('input[type=radio][name=insured]:checked').length == 0) {
                $('.insured_error_msg').text("Bitte wählen Sie aus, ob Sie versichert oder Pflegeperson sind");
                addErrorClass('input[type=radio][name=insured]');
                isValid = false;
                errorMessages.push("Bitte wählen Sie aus, ob Sie versichert oder Pflegeperson sind");
            } else {
                $('.insured_error_msg').text("");
                removeErrorClass('input[type=radio][name=insured]');
            }

            if ($('input[type=radio][name=title_name]:checked').length == 0) {
                $('.title_name_error_msg').text("Bitte wählen Sie Ihre Anrede (Herr/Frau)");
                addErrorClass('input[type=radio][name=title_name]');
                isValid = false;
                errorMessages.push("Bitte wählen Sie Ihre Anrede (Herr/Frau)");
            } else {
                $('.title_name_error_msg').text("");
                removeErrorClass('input[type=radio][name=title_name]');
            }

            if ($("#first_name").val() == '') {
                $('.first_name_error_msg').text("Bitte geben Sie den Vornamen ein");
                addErrorClass('#first_name');
                isValid = false;
                errorMessages.push("Bitte geben Sie den Vornamen ein");
            } else {
                $('.first_name_error_msg').text("");
                removeErrorClass('#first_name');
            }

            if ($("#last_name").val() == '') {
                $('.last_name_error_msg').text("Bitte geben Sie den Nachnamen ein");
                addErrorClass('#last_name');
                isValid = false;
                errorMessages.push("Bitte geben Sie den Nachnamen ein");
            } else {
                $('.last_name_error_msg').text("");
                removeErrorClass('#last_name');
            }

            if ($("#streetno").val() == '') {
                $('.streetno_error_msg').text("Bitte geben Sie die Straße ein");
                addErrorClass('#streetno');
                isValid = false;
                errorMessages.push("Bitte geben Sie die Straße ein");
            } else {
                $('.streetno_error_msg').text("");
                removeErrorClass('#streetno');
            }

            if ($("#houseno").val() == '') {
                $('.houseno_error_msg').text("Bitte geben Sie die Hausnummer ein");
                addErrorClass('#houseno');
                isValid = false;
                errorMessages.push("Bitte geben Sie die Hausnummer ein");
            } else {
                $('.houseno_error_msg').text("");
                removeErrorClass('#houseno');
            }

            if ($("#zip").val() == '') {
                $('.zip_error_msg').text("Bitte geben Sie die PLZ ein");
                addErrorClass('#zip');
                isValid = false;
                errorMessages.push("Bitte geben Sie die PLZ ein");
            } else {
                $('.zip_error_msg').text("");
                removeErrorClass('#zip');
            }

            if ($("#city").val() == '') {
                $('.city_error_msg').text("Bitte geben Sie den Ort ein");
                addErrorClass('#city');
                isValid = false;
                errorMessages.push("Bitte geben Sie den Ort ein");
            } else {
                $('.city_error_msg').text("");
                removeErrorClass('#city');
            }

            if ($("#Gaburtadatum").val() == '') {
                $('.gaburtadatum_error_msg').text("Bitte geben Sie das Geburtsdatum ein");
                addErrorClass('#Gaburtadatum');
                isValid = false;
                errorMessages.push("Bitte geben Sie das Geburtsdatum ein");
            } else {
                $('.gaburtadatum_error_msg').text("");
                removeErrorClass('#Gaburtadatum');
            }

            if ($("#telno").val() == '') {
                $('.telno_error_msg').text("Bitte geben Sie die Telefonnummer ein");
                addErrorClass('#telno');
                isValid = false;
                errorMessages.push("Bitte geben Sie die Telefonnummer ein");
            } else {
                $('.telno_error_msg').text("");
                removeErrorClass('#telno');
            }

            if ($("#email2").val() == '') {
                $('.email2_error_msg').text("Bitte geben Sie die E-Mail-Adresse ein");
                addErrorClass('#email2');
                isValid = false;
                errorMessages.push("Bitte geben Sie die E-Mail-Adresse ein");
            } else {
                $('.email2_error_msg').text("");
                removeErrorClass('#email2');
            }

            // Validation des mots de passe seulement si les champs sont visibles
            var passwordFieldsVisible = $('.password-fields').is(':visible');
            if (passwordFieldsVisible) {
                if ($("#password").val() == '') {
                    $('.password_error_msg').text("Bitte geben Sie das Passwort ein");
                    addErrorClass('#password');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie das Passwort ein");
                } else {
                    $('.password_error_msg').text("");
                    removeErrorClass('#password');
                }

                if ($("#confirm_password").val() == '') {
                    $('.password2_error_msg').text("Bitte bestätigen Sie das Passwort");
                    addErrorClass('#confirm_password');
                    isValid = false;
                    errorMessages.push("Bitte bestätigen Sie das Passwort");
                } else if ($("#password").val() != $("#confirm_password").val()) {
                    $('.password2_error_msg').text("Passwort-Bestätigung stimmt nicht überein.");
                    addErrorClass('#confirm_password');
                    isValid = false;
                    errorMessages.push("Passwort-Bestätigung stimmt nicht überein");
                } else {
                    $('.password2_error_msg').text("");
                    removeErrorClass('#confirm_password');
                }
            } else {
                // Si les champs de mot de passe sont masqués, on les efface
                $('.password_error_msg').text("");
                $('.password2_error_msg').text("");
                removeErrorClass('#password');
                removeErrorClass('#confirm_password');
            }

            // Validation des champs Angehöriger/Pflegeperson (seulement si le bloc est visible)
            var angehorigerBlockVisible = $('#angehoriger-contact').is(':visible');
            if (angehorigerBlockVisible) {
                if ($("#angehoriger_name").val() == '') {
                    $('.angehoriger_name_error_msg').text("Bitte geben Sie den Namen des Angehörigen ein");
                    addErrorClass('#angehoriger_name');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie den Namen des Angehörigen ein");
                } else {
                    $('.angehoriger_name_error_msg').text("");
                    removeErrorClass('#angehoriger_name');
                }

                if ($("#angehoriger_telefon").val() == '') {
                    $('.angehoriger_telefon_error_msg').text("Bitte geben Sie die Telefonnummer des Angehörigen ein");
                    addErrorClass('#angehoriger_telefon');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie die Telefonnummer des Angehörigen ein");
                } else {
                    $('.angehoriger_telefon_error_msg').text("");
                    removeErrorClass('#angehoriger_telefon');
                }

                if ($("#angehoriger_email").val() == '') {
                    $('.angehoriger_email_error_msg').text("Bitte geben Sie die E-Mail-Adresse des Angehörigen ein");
                    addErrorClass('#angehoriger_email');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie die E-Mail-Adresse des Angehörigen ein");
                } else {
                    $('.angehoriger_email_error_msg').text("");
                    removeErrorClass('#angehoriger_email');
                }
            } else {
                // Si le bloc Angehöriger n'est pas visible, effacer les erreurs
                $('.angehoriger_name_error_msg').text("");
                $('.angehoriger_telefon_error_msg').text("");
                $('.angehoriger_email_error_msg').text("");
                removeErrorClass('#angehoriger_name');
                removeErrorClass('#angehoriger_telefon');
                removeErrorClass('#angehoriger_email');
            }

            if ($("#health-insurance").val() == '') {
                $('.hinsurance_error_msg').text("Bitte geben Sie den Krankenkassen-Namen ein");
                addErrorClass('#health-insurance');
                isValid = false;
                errorMessages.push("Bitte geben Sie den Krankenkassen-Namen ein");
            } else {
                $('.hinsurance_error_msg').text("");
                removeErrorClass('#health-insurance');
            }

            if ($("#insurance-no").val() == '') {
                $('.insuranceno_error_msg').text("Bitte geben Sie die Versicherungsnummer ein");
                addErrorClass('#insurance-no');
                isValid = false;
                errorMessages.push("Bitte geben Sie die Versicherungsnummer ein");
            } else {
                $('.insuranceno_error_msg').text("");
                removeErrorClass('#insurance-no');
            }

            if ($("#KrankenkasseNummer").val() == '') {
                $('.krankenkasse_error_msg').text("Bitte geben Sie die Krankenkassen-Nummer ein");
                addErrorClass('#KrankenkasseNummer');
                isValid = false;
                errorMessages.push("Bitte geben Sie die Krankenkassen-Nummer ein");
            } else {
                $('.krankenkasse_error_msg').text("");
                removeErrorClass('#KrankenkasseNummer');
            }

            // Validation des champs Angehöriger/Pflegeperson (seulement si le bloc est visible)
            var angehorigerBlockVisible = !$('#angehoriger-contact').hasClass('d-none');
            if (angehorigerBlockVisible) {
                if ($("#angehoriger_name").val() == '') {
                    $('.angehoriger_name_error_msg').text("Bitte geben Sie den Namen des Angehörigen ein");
                    addErrorClass('#angehoriger_name');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie den Namen des Angehörigen ein");
                } else {
                    $('.angehoriger_name_error_msg').text("");
                    removeErrorClass('#angehoriger_name');
                }

                if ($("#angehoriger_telefon").val() == '') {
                    $('.angehoriger_telefon_error_msg').text("Bitte geben Sie die Telefonnummer des Angehörigen ein");
                    addErrorClass('#angehoriger_telefon');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie die Telefonnummer des Angehörigen ein");
                } else {
                    $('.angehoriger_telefon_error_msg').text("");
                    removeErrorClass('#angehoriger_telefon');
                }

                if ($("#angehoriger_email").val() == '') {
                    $('.angehoriger_email_error_msg').text("Bitte geben Sie die E-Mail des Angehörigen ein");
                    addErrorClass('#angehoriger_email');
                    isValid = false;
                    errorMessages.push("Bitte geben Sie die E-Mail des Angehörigen ein");
                } else {
                    $('.angehoriger_email_error_msg').text("");
                    removeErrorClass('#angehoriger_email');
                }
            } else {
                // Si le bloc Angehöriger n'est pas visible, effacer les erreurs
                $('.angehoriger_name_error_msg').text("");
                $('.angehoriger_telefon_error_msg').text("");
                $('.angehoriger_email_error_msg').text("");
                removeErrorClass('#angehoriger_name');
                removeErrorClass('#angehoriger_telefon');
                removeErrorClass('#angehoriger_email');
            }

            // Vérifier les deux sections de type d'assurance
            const insuranceType1 = $('input[type=radio][name=inlineRadioOptions5]:checked').length;
            const insuranceType2 = $('input[type=radio][name=inlineRadioOptions5_2]:checked').length;
            
            if (insuranceType1 == 0 && insuranceType2 == 0) {
                $('.inlineRadioOptions5_error_msg, .inlineRadioOptions5_2_error_msg').text("Bitte wählen Sie den Versicherungstyp");
                addErrorClass('input[type=radio][name=inlineRadioOptions5], input[type=radio][name=inlineRadioOptions5_2]');
                isValid = false;
                errorMessages.push("Bitte wählen Sie den Versicherungstyp");
            } else {
                $('.inlineRadioOptions5_error_msg, .inlineRadioOptions5_2_error_msg').text("");
                removeErrorClass('input[type=radio][name=inlineRadioOptions5], input[type=radio][name=inlineRadioOptions5_2]');
            }

            if ($('input[type=checkbox][name=condition_chcek]:checked').length == 0) {
                $('.condition_chcek_error_msg').text("Please accept the terms and conditions");
                addErrorClass('input[type=checkbox][name=condition_chcek]');
                isValid = false;
                errorMessages.push("Please accept the terms and conditions");
            } else {
                $('.condition_chcek_error_msg').text("");
                removeErrorClass('input[type=checkbox][name=condition_chcek]');
            }

            // Validation du Pflegegrad
            if ($('input[type=radio][name=Pflegegrad]:checked').length == 0) {
                $('.pflegegrad_error_msg').text("Bitte wählen Sie einen Pflegegrad");
                addErrorClass('input[type=radio][name=Pflegegrad]');
                isValid = false;
                errorMessages.push("Bitte wählen Sie einen Pflegegrad");
            } else {
                $('.pflegegrad_error_msg').text("");
                removeErrorClass('input[type=radio][name=Pflegegrad]');
            }

            // Vérifier si l'email existe déjà (seulement si pas trouvé par recherche)
            if (emailExists && !emailFoundBySearch) {
                showValidationErrorModal(['Diese E-Mail-Adresse existiert bereits in unserer Datenbank. Bitte verwenden Sie eine andere E-Mail-Adresse oder suchen Sie den bestehenden Kunden.']);
                return false;
            }

            // Vérifier si le numéro d'assurance existe déjà (seulement si pas trouvé par recherche)
            if (insuranceNumberExists && !insuranceNumberFoundBySearch) {
                showValidationErrorModal(['Diese Versichertennummer existiert bereits in unserer Datenbank. Bitte verwenden Sie eine andere Versichertennummer.']);
                return false;
            }

            // Vérifier si le numéro de Krankenkasse existe déjà (seulement si pas trouvé par recherche)
            if (krankenkasseNumberExists && !krankenkasseNumberFoundBySearch) {
                showValidationErrorModal(['Diese Krankenkassen-Nummer existiert bereits in unserer Datenbank. Bitte verwenden Sie eine andere Krankenkassen-Nummer.']);
                return false;
            }

            // Si la validation échoue, afficher le modal d'erreur et empêcher le passage à l'étape 3
            
            if (!isValid) {
                // Afficher le modal moderne avec les erreurs
                showValidationErrorModal(errorMessages);
                
                // Empêcher le passage à l'étape 3
                return false;
            } else {
                console.log('Validation passed - proceeding to next step');
            }

            // var test_h = $("#houseno").val();
            // alert(test_h);

            var u_name = $("#first_name").val() + ' ' + $("#last_name").val();
            $('#Drecipient_name').val(u_name);

            var u_streetno = $("#streetno").val();
            $('#Dstreetno').val(u_streetno);

            var u_houseno = $("#houseno").val();
            $('#Dhouseno').val(u_houseno);

            var u_zip = $("#zip").val();
            $('#Dzip').val(u_zip);

            var u_city = $("#city").val();
            $('#Dcity').val(u_city);

            // Transition vers l'étape 3 après validation réussie
            $("#step2").css("display", "none");
            $("#step3").css("display", "block");
            $(".step2").removeClass("active");
            $(".step3").addClass("active");
            
            // Forcer les couleurs après changement d'étape
            setTimeout(function() {
                forceStepColors();
            }, 100);

        });
    </script>

    <script>
        function printPageArea(areaID) {
            var personalInformation = [];
            var userDetails = {};
            userDetails['surname'] = $('input[name="title_name"]:checked').val();
            var insuredTypeValue = $('input[name="insured"]:checked').val();
            // Transformer "Pflegeperson" en "Angehöriger / Pflegeperson"
            if (insuredTypeValue === 'Pflegeperson') {
                insuredTypeValue = 'Angehöriger / Pflegeperson';
            }
            userDetails['insured_type'] = insuredTypeValue;
            const pflegegradValue = $('input[name="Pflegegrad"]:checked').val();
            userDetails['pflegegrad'] = pflegegradValue ? pflegegradValue.replace('Pflegegrad', '') : null;
            
            // Ajouter le type d'assurance (Der Versicherte ist) - PRINT VERSION
            let selectedInsuranceType = $('input[name="inlineRadioOptions5"]:checked').val();
            if (!selectedInsuranceType) {
                selectedInsuranceType = $('input[name="inlineRadioOptions5_2"]:checked').val();
            }
            
            if (selectedInsuranceType === 'option5') {
                userDetails['insurance_type'] = 'G';
            } else if (selectedInsuranceType === 'option6') {
                userDetails['insurance_type'] = 'P';
            }
            
            userDetails['first_name'] = $('#first_name').val();
            userDetails['last_name'] = $('#last_name').val();
            userDetails['streetno'] = $('#streetno').val();
            userDetails['houseno'] = $('#houseno').val();
            userDetails['zip'] = $('#zip').val();
            userDetails['city'] = $('#city').val();
            userDetails['dob'] = $('#Gaburtadatum').val();
            userDetails['telno'] = $('#telno').val();
            userDetails['email'] = $('#email2').val();
            userDetails['password'] = $('#password').val();
            userDetails['angehoriger_name'] = $('#angehoriger_name').val();
            userDetails['angehoriger_telefon'] = $('#angehoriger_telefon').val();
            userDetails['angehoriger_email'] = $('#angehoriger_email').val();
            userDetails['health_insurance'] = $('#health-insurance').val();
            userDetails['insurance_no'] = $('#insurance-no').val();
            userDetails['KrankenkasseNummer'] = $('#KrankenkasseNummer').val();
            personalInformation.push(userDetails);

            ///$('$Dhouseno').val(userDetails['houseno']);




            var customerDeliveryAddress = [];
            var deliveryAddress = {};
            deliveryAddress['recipient_name'] = $('#Drecipient_name').val();
            deliveryAddress['street'] = $('#Dstreetno').val();
            deliveryAddress['houseno'] = $('#Dhouseno').val();
            deliveryAddress['zip'] = $('#Dzip').val();
            deliveryAddress['city'] = $('#Dcity').val();
            customerDeliveryAddress.push(deliveryAddress);
            $.ajax({
                type: "GET",
                url: "{{route('customer.customerInfo')}}",
                data: "userDetails=" + JSON.stringify(personalInformation) + '&_token={{ csrf_token() }}' + '&deliveryAddress=' + JSON.stringify(customerDeliveryAddress),
                success: function(data) {
                    successtoastMessage('Your details has been successfully saved.');
                }
            });

            var printContent = document.getElementById(areaID).innerHTML;
            var originalContent = document.body.innerHTML;
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            new Sketchpad({
                element: "#sketchpad",
                width: $("#signPad").outerWidth(),
                height: $("#signPad").outerHeight()
            });
        }

        function updatePDF1Data(userDetails) {
            console.log('updatePDF1Data called with:', userDetails);
            
            // Mettre à jour le genre
            if (userDetails.surname === 'Frau') {
                $('#title_name_fr_pd1').html('✓');
                $('#title_name_her_pd1').html('');
            } else if (userDetails.surname === 'Herr') {
                $('#title_name_her_pd1').html('✓');
                $('#title_name_fr_pd1').html('');
            }
            
            // Mettre à jour les informations personnelles
            $('#first_name_pd1').text(userDetails.first_name || '');
            $('#last_name_pd1').text(userDetails.last_name || '');
            
            // Mettre à jour la taille des gants
            $('.glove-checkbox').html(''); // Effacer toutes les sélections
            if (userDetails.glove_size) {
                $('#glove_' + userDetails.glove_size.toLowerCase() + '_pd1').html('✓');
            }
            
            // Mettre à jour les BeleschBox sélectionnées
            $('.beleschbox-checkbox').html(''); // Effacer toutes les sélections
            
            // Récupérer la BeleschBox sélectionnée depuis l'URL ou les paramètres
            var selectedBox = null;
            
            // Méthode 1: Vérifier l'URL pour un paramètre de box
            var urlParams = new URLSearchParams(window.location.search);
            var boxFromUrl = urlParams.get('box') || urlParams.get('id');
            console.log('Box from URL:', boxFromUrl);
            
            // Méthode 2: Vérifier les éléments avec des checkmarks dans l'interface
            var checkedBoxes = [];
            $('.pd').each(function() {
                var content = $(this).html();
                if (content.includes('✓') || content.includes('&#10003;')) {
                    var boxNumber = $(this).attr('id');
                    if (boxNumber) {
                        var match = boxNumber.match(/pd(\d+)/);
                        if (match) {
                            checkedBoxes.push(match[1]);
                        }
                    }
                }
            });
            
            console.log('Checked boxes from interface:', checkedBoxes);
            
            // Méthode 3: Vérifier les produits dans le panier pour déterminer la box
            var selectedProducts = [];
            $('.recProduct').each(function() {
                var productId = $(this).data('id');
                if (productId) {
                    selectedProducts.push(productId);
                }
            });
            
            console.log('Selected products:', selectedProducts);
            
            // Déterminer quelle BeleschBox cocher
            if (boxFromUrl) {
                selectedBox = boxFromUrl;
                console.log('Using box from URL:', selectedBox);
            } else if (checkedBoxes.length > 0) {
                selectedBox = checkedBoxes[0]; // Prendre la première box cochée
                console.log('Using first checked box:', selectedBox);
            } else if (selectedProducts.length > 0) {
                // Si des produits sont sélectionnés, essayer de déterminer la box
                selectedBox = 'unknown';
                console.log('Products found but no specific box identified');
            }
            
            // Cocher SEULEMENT la BeleschBox appropriée
            if (selectedBox && !isNaN(selectedBox)) {
                // Cocher SEULEMENT la BeleschBox spécifique
                $('#bb' + selectedBox + '_pd1').html('✓');
                console.log('Checked ONLY BeleschBox ' + selectedBox);
            } else if (selectedBox === 'individuell') {
                // Cocher SEULEMENT BeleschBox Individuell
                $('#bb_individuell_pd1').html('✓');
                console.log('Checked ONLY BeleschBox Individuell');
            } else {
                // Si aucune box spécifique n'est trouvée, ne rien cocher
                console.log('No specific box found, leaving all checkboxes empty');
            }
            
            // Vérifier le résultat final
            setTimeout(function() {
                console.log('Final check - BeleschBox 1:', $('#bb1_pd1').html());
                console.log('Final check - BeleschBox 2:', $('#bb2_pd1').html());
                console.log('Final check - BeleschBox 3:', $('#bb3_pd1').html());
                console.log('Final check - BeleschBox Individuell:', $('#bb_individuell_pd1').html());
            }, 100);
        }

        function printPageArea1(areaID) {
            console.log('printPageArea1 called with areaID:', areaID);
            
            // Récupérer les données du formulaire
            var userDetails = {};
            
            // Récupérer le genre
            var genderValue = $('input[name="title_name"]:checked').val();
            userDetails['surname'] = genderValue;
            
            // Récupérer les informations personnelles
            userDetails['first_name'] = $('#first_name').val();
            userDetails['last_name'] = $('#last_name').val();
            
            // Récupérer la taille des gants
            var gloveSize = $('input[name="glove_size"]:checked').val();
            userDetails['glove_size'] = gloveSize || 'M';
            
            // Récupérer la BeleschBox sélectionnée
            var selectedPackage = $('input[name="package"]:checked').val();
            userDetails['selected_package'] = selectedPackage;
            
            console.log('User details:', userDetails);

            // Mettre à jour les données dans le template PDF1
            updatePDF1Data(userDetails);

            // Générer le PDF
            var printContents = document.getElementById(areaID).innerHTML;
            console.log('Print contents length:', printContents.length);
            
            if (printContents.length === 0) {
                alert('Template PDF1 vide! Vérifiez que printableArea1 contient du contenu.');
                return;
            }
            
            var originalContents = document.body.innerHTML;
            
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"></script>
    <script src="{{asset('frontend/assets/js/plugins.js')}}"></script>
    <script src="{{asset('frontend/assets/js/main.js')}}"></script>
    <script src="{{asset('frontend/assets/js/sketchpad.js')}}"></script>
    <script src="{{asset('frontend/assets/js/assemble-box.js')}}"></script>
    
    <!-- Modal moderne pour les erreurs de validation -->
    <div class="modal fade" id="validationErrorModal" tabindex="-1" aria-labelledby="validationErrorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <div class="d-flex align-items-center">
                        <div class="error-icon me-3">
                            <i class="fas fa-exclamation-triangle text-danger"></i>
                        </div>
                        <h5 class="modal-title text-danger" id="validationErrorModalLabel">
                            Fehlende Felder
                        </h5>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3 text-muted">Bitte füllen Sie alle Pflichtfelder aus, bevor Sie fortfahren:</p>
                    <div id="errorList" class="error-list">
                        <!-- Fehler werden hier dynamisch hinzugefügt -->
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" id="closeModalBtn" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal(); return false;">
                        <i class="fas fa-times me-2"></i>Schließen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal d'erreur pour les Bettschutzeinlagen -->
    <div class="modal fade" id="bedProtectionErrorModal" tabindex="-1" aria-labelledby="bedProtectionErrorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content error-modal-content">
                <div class="modal-header error-modal-header">
                    <div class="d-flex align-items-center">
                        <div class="error-icon-large me-3">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <h4 class="modal-title text-white" id="bedProtectionErrorModalLabel">
                            ⚠️ Auswahl erforderlich
                        </h4>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" onclick="closeBedProtectionErrorModal(); return false;"></button>
                </div>
                <div class="modal-body error-modal-body">
                    <div class="error-message-box">
                        <h5 class="text-danger mb-3">
                            <i class="fas fa-times-circle me-2"></i>
                            Fehlende Auswahl
                        </h5>
                        <p class="mb-3">Sie haben vergessen, eine Anzahl für die Bettschutzeinlagen auszuwählen!</p>
                        <div class="error-instruction">
                            <i class="fas fa-hand-point-right text-warning me-2"></i>
                            <strong>Bitte wählen Sie eine Anzahl (1, 2, 3 oder 4) aus, bevor Sie fortfahren.</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-footer error-modal-footer">
                    <button type="button" class="btn btn-danger btn-lg" data-bs-dismiss="modal" onclick="closeBedProtectionErrorModal(); return false;">
                        <i class="fas fa-check me-2"></i>Verstanden
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Styles pour le modal -->
    <style>
        .error-icon {
            width: 50px;
            height: 50px;
            background: var(--blue-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        .error-icon i {
            font-size: 24px;
            color: var(--white);
        }
        
        .error-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .error-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: var(--light-blue);
            border-left: 4px solid var(--sky-blu);
            border-radius: 4px;
            animation: slideInLeft 0.3s ease-out;
        }
        
        .error-item i {
            color: var(--sky-blu);
            margin-right: 10px;
            font-size: 14px;
        }
        
        .error-item span {
            color: var(--dark-blue);
            font-size: 14px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .modal-content {
            border: none;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .modal-header {
            background: var(--blue-gradient);
            color: var(--white);
            border-radius: 15px 15px 0 0;
        }
        
        /* ===== MODERN BUTTON STYLES ===== */
        .btn-primary, .btn__primary {
            background: var(--blue-gradient);
            border: none;
            border-radius: var(--border-radius);
            padding: 15px 30px;
            font-weight: 600;
            font-size: 16px;
            color: var(--white);
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before, .btn__primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before, .btn__primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover, .btn__primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
            background: var(--blue-gradient-hover);
        }
        
        .btn-primary:active, .btn__primary:active {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--light-blue);
            color: var(--dark-blue);
            border: 2px solid var(--sky-blu);
            border-radius: var(--border-radius);
            padding: 15px 30px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: var(--sky-blu);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* Effet visuel pour les boutons de sélection des Bettschutzeinlagen */
        .prod-count.error-highlight {
            border: 3px solid var(--sky-blu) !important;
            background: var(--light-blue) !important;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Styles pour le modal d'erreur Bettschutzeinlagen */
        .error-modal-content {
            border: 3px solid var(--sky-blu);
            border-radius: 15px;
            box-shadow: var(--shadow-hover);
            animation: errorPulse 2s infinite;
        }
        
        .error-modal-header {
            background: var(--blue-gradient);
            color: var(--white);
            border-radius: 12px 12px 0 0;
            padding: 20px;
        }
        
        .error-icon-large {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--white);
            animation: errorIconPulse 1.5s infinite;
        }
        
        .error-modal-body {
            background: var(--light-blue);
            padding: 25px;
        }
        
        .error-message-box {
            background: var(--white);
            border: 2px solid var(--sky-blu);
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .error-instruction {
            background: var(--light-blue);
            border: 1px solid var(--sky-blu);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .error-modal-footer {
            background: var(--light-blue);
            border-radius: 0 0 12px 12px;
            padding: 20px;
            justify-content: center;
        }
        
        @keyframes errorPulse {
            0%, 100% { 
                box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 15px 40px rgba(220, 53, 69, 0.5);
                transform: scale(1.02);
            }
        }
        
        @keyframes errorIconPulse {
            0%, 100% { 
                transform: scale(1);
                background: rgba(255, 255, 255, 0.2);
            }
            50% { 
                transform: scale(1.1);
                background: rgba(255, 255, 255, 0.3);
            }
        }
        
        /* Styles pour les champs en erreur */
        .form-control.error {
            border: 2px solid #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
        }
        
        .form-check-input.error {
            border: 2px solid #dc3545 !important;
        }
        
        .form-check.error {
            border: 2px solid #dc3545 !important;
            border-radius: 4px;
            padding: 8px;
            background-color: rgba(220, 53, 69, 0.05);
        }
        
        /* Style cohérent pour le champ de date HTML5 */
        input[type="date"] {
            position: relative;
            background: white !important;
            border: 1px solid #ced4da !important;
            border-radius: 0.375rem !important;
            padding: 0.375rem 0.75rem !important;
            font-size: 1rem !important;
            font-weight: 400 !important;
            color: #212529 !important;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out !important;
        }
        
        input[type="date"]:focus {
            border-color: #86b7fe !important;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
            background: white !important;
            outline: 0 !important;
        }
        
        input[type="date"]:hover {
            border-color: #86b7fe !important;
        }
        
        /* Style de l'icône calendrier */
        input[type="date"]::-webkit-calendar-picker-indicator {
            background: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236c757d'%3e%3cpath fill-rule='evenodd' d='M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z' clip-rule='evenodd'/%3e%3c/svg%3e") no-repeat center !important;
            background-size: 16px 16px !important;
            cursor: pointer !important;
            width: 16px !important;
            height: 16px !important;
            margin-left: 8px !important;
            opacity: 0.6 !important;
            transition: opacity 0.2s ease !important;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator:hover {
            opacity: 0.8 !important;
        }
        
        /* Style des champs de date */
        input[type="date"]::-webkit-datetime-edit {
            padding: 0 !important;
            color: #212529 !important;
            font-weight: 400 !important;
        }
        
        input[type="date"]::-webkit-datetime-edit-fields-wrapper {
            padding: 0 !important;
        }
        
        input[type="date"]::-webkit-datetime-edit-text {
            color: #6c757d !important;
            padding: 0 1px !important;
            font-weight: 400 !important;
        }
        
        input[type="date"]::-webkit-datetime-edit-month-field {
            color: #212529 !important;
            font-weight: 400 !important;
            background: transparent !important;
            border-radius: 0 !important;
            padding: 0 !important;
        }
        
        input[type="date"]::-webkit-datetime-edit-day-field {
            color: #212529 !important;
            font-weight: 400 !important;
            background: transparent !important;
            border-radius: 0 !important;
            padding: 0 !important;
        }
        
        input[type="date"]::-webkit-datetime-edit-year-field {
            color: #212529 !important;
            font-weight: 400 !important;
            background: transparent !important;
            border-radius: 0 !important;
            padding: 0 !important;
        }
        
        /* Style pour Firefox */
        input[type="date"]::-moz-placeholder {
            color: #6c757d !important;
            opacity: 1 !important;
        }
        
        /* Style pour les navigateurs qui supportent le calendrier */
        @supports (-webkit-appearance: none) {
            input[type="date"] {
                background: var(--light-blue) !important;
            }
        }
        
        /* Style pour les champs readonly */
        input[readonly] {
            background: var(--light-blue) !important;
            color: var(--dark-blue) !important;
            cursor: not-allowed !important;
        }
        
        input[readonly]:focus {
            background: var(--light-blue) !important;
            border-color: var(--sky-blu) !important;
            box-shadow: none !important;
        }
        
        /* Style pour les cartes de résumé */
        .card {
            border: 1px solid var(--sky-blu);
            border-radius: 0.35rem;
            box-shadow: var(--shadow);
        }
        
        .card-header {
            background: var(--blue-gradient);
            color: var(--white);
            border-bottom: none;
            padding: 0.75rem 1.25rem;
        }
        
        .card-header h5 {
            margin: 0;
            color: var(--white);
            font-weight: 600;
        }
        
        .card-body {
            padding: 1.25rem;
        }
        
        .card-body p {
            margin-bottom: 0.5rem;
            color: var(--dark-blue);
        }
        
        .card-body strong {
            color: var(--dark-blue);
        }
        
        /* Style pour les éléments de produits dans le résumé */
        .product-summary-item {
            background: var(--light-blue);
            border: 1px solid var(--sky-blu) !important;
        }
        
        .product-summary-item:hover {
            background: var(--blue-gradient);
            color: var(--white);
        }
        
        .badge-primary {
            background: var(--blue-gradient);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }
        
        .text-success {
            color: var(--sky-blu) !important;
            font-weight: bold;
        }
        
        .text-info {
            color: var(--turquoise) !important;
        }
        
        .badge-success {
            background: var(--blue-gradient);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }
        
        .bg-light {
            background: var(--light-blue) !important;
        }
        
        /* Styles pour les messages d'erreur */
        .pflegegrad_error_msg,
        .first_name_error_msg,
        .last_name_error_msg,
        .streetno_error_msg,
        .houseno_error_msg,
        .zip_error_msg,
        .city_error_msg,
        .gaburtadatum_error_msg,
        .telno_error_msg,
        .email2_error_msg,
        .password_error_msg,
        .password2_error_msg,
        .angehoriger_name_error_msg,
        .angehoriger_telefon_error_msg,
        .angehoriger_email_error_msg,
        .hinsurance_error_msg,
        .insuranceno_error_msg,
        .krankenkasse_error_msg,
        .inlineRadioOptions5_error_msg,
        .condition_chcek_error_msg,
        .insured_error_msg,
        .title_name_error_msg {
            font-size: 12px;
            color: #dc3545;
            margin-top: 5px;
            display: block;
            clear: both;
        }
    </style>

    <!-- Test direct des fonctions de recherche d'email -->
    <script>
        // Fonction pour effacer les erreurs des champs
        function clearFieldErrors(fieldIds) {
            fieldIds.forEach(fieldId => {
                // Effacer la classe error
                const field = document.getElementById(fieldId);
                if (field) {
                    field.classList.remove('error');
                }
                
                // Mapper les IDs vers les bonnes classes d'erreur
                const errorClassMap = {
                    'first_name': 'first_name_error_msg',
                    'last_name': 'last_name_error_msg',
                    'streetno': 'streetno_error_msg',
                    'houseno': 'houseno_error_msg',
                    'zip': 'zip_error_msg',
                    'city': 'city_error_msg',
                    'Gaburtadatum': 'gaburtadatum_error_msg',
                    'telno': 'telno_error_msg',
                    'email2': 'email2_error_msg',
                    'password': 'password_error_msg',
                    'confirm_password': 'password2_error_msg',
                    'angehoriger_name': 'angehoriger_name_error_msg',
                    'angehoriger_telefon': 'angehoriger_telefon_error_msg',
                    'angehoriger_email': 'angehoriger_email_error_msg',
                    'health-insurance': 'hinsurance_error_msg',
                    'insurance-no': 'insuranceno_error_msg',
                    'KrankenkasseNummer': 'krankenkasse_error_msg',
                    'insured': 'insured_error_msg',
                    'title_name': 'title_name_error_msg',
                    'inlineRadioOptions5': 'inlineRadioOptions5_error_msg',
                    'condition_chcek': 'condition_chcek_error_msg',
                    'Pflegegrad': 'pflegegrad_error_msg'
                };
                
                const errorClassName = errorClassMap[fieldId] || fieldId + '_error_msg';
                const errorMsg = document.querySelector('.' + errorClassName);
                if (errorMsg) {
                    errorMsg.textContent = '';
                }
            });
        }
        
        // Fonction pour effacer toutes les erreurs
        function clearAllFieldErrors() {
            console.log('clearAllFieldErrors appelée');
            
            // Effacer toutes les classes error
            const errorElements = document.querySelectorAll('.error');
            console.log('Éléments avec classe error trouvés:', errorElements.length);
            errorElements.forEach(element => {
                element.classList.remove('error');
                console.log('Classe error supprimée de:', element.id || element.className);
            });
            
            // Effacer tous les messages d'erreur
            const errorMessages = document.querySelectorAll('[class*="_error_msg"]');
            console.log('Messages d\'erreur trouvés:', errorMessages.length);
            errorMessages.forEach(element => {
                element.textContent = '';
                console.log('Message d\'erreur effacé:', element.className);
            });
            
            // Effacement spécifique pour les champs de formulaire
            const formFields = ['first_name', 'last_name', 'streetno', 'houseno', 'zip', 'city', 'Gaburtadatum', 'telno', 'email2', 'angehoriger_name', 'angehoriger_telefon', 'angehoriger_email', 'health-insurance', 'insurance-no', 'KrankenkasseNummer'];
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.classList.remove('error');
                    console.log('Champ nettoyé:', fieldId);
                }
            });
        }

        // Fonction pour fermer le modal
        function closeValidationModal() {
            console.log('closeValidationModal appelée !');
            const modalElement = document.getElementById('validationErrorModal');
            console.log('Modal element:', modalElement);
            
            // Méthode 1: Bootstrap
            if (typeof bootstrap !== 'undefined') {
                const modal = bootstrap.Modal.getInstance(modalElement);
                console.log('Bootstrap modal instance:', modal);
                if (modal) {
                    modal.hide();
                    console.log('Modal fermé avec Bootstrap');
                    return;
                }
            }
            
            // Méthode 2: Fallback direct
            modalElement.style.display = 'none';
            modalElement.classList.remove('show');
            
            // Supprimer le backdrop
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
            
            // Restaurer le body
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            
            console.log('Modal fermé manuellement');
        }

        // Fonction pour afficher le modal d'erreur de validation
        function showValidationErrorModal(errorMessages) {
            const errorList = document.getElementById('errorList');
            errorList.innerHTML = '';
            
            // Ajouter chaque erreur
            errorMessages.forEach((error, index) => {
                setTimeout(() => {
                    const errorItem = document.createElement('div');
                    errorItem.className = 'error-item';
                    errorItem.innerHTML = `
                        <i class="fas fa-times-circle"></i>
                        <span>${error}</span>
                    `;
                    errorList.appendChild(errorItem);
                }, index * 100);
            });
            
            // Afficher le modal manuellement
            const modalElement = document.getElementById('validationErrorModal');
            if (modalElement) {
                console.log('Showing validation modal...');
                
                // Créer le backdrop
                const backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop fade show';
                backdrop.id = 'modalBackdrop';
                document.body.appendChild(backdrop);
                
                // Afficher le modal
                modalElement.style.display = 'block';
                modalElement.classList.add('show');
                modalElement.classList.add('fade');
                document.body.classList.add('modal-open');
                document.body.style.overflow = 'hidden';
                
                // Ajouter le gestionnaire d'événement après l'affichage du modal
                setTimeout(() => {
                    const closeBtn = document.getElementById('closeModalBtn');
                    if (closeBtn) {
                        closeBtn.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Schließen-Button geklickt (onclick)!');
                            closeModal();
                        };
                    }
                    
                    // Gestionnaire pour fermer en cliquant sur le backdrop
                    const backdrop = document.getElementById('modalBackdrop');
                    if (backdrop) {
                        backdrop.onclick = function() {
                            console.log('Backdrop geklickt!');
                            closeModal();
                        };
                    }
                    
                    // Gestionnaire pour fermer en cliquant en dehors du modal
                    modalElement.onclick = function(e) {
                        if (e.target === modalElement) {
                            console.log('Modal backdrop geklickt!');
                            closeModal();
                        }
                    };
                }, 100);
            }
        }
        

        // Fonction pour la recherche d'email avec votre vraie base de données
        function testSearchCustomer() {
            console.log('Search function called');
            alert('Fonction testSearchCustomer appelée !');
            
            const email = document.getElementById('search_email').value;
            console.log('Email:', email);
            
            if (!email) {
                alert('Bitte geben Sie eine Email-Adresse ein.');
                return;
            }
            
            // Afficher l'état de chargement
            const searchButton = document.querySelector('button[onclick="testSearchCustomer()"]');
            const originalText = searchButton.innerHTML;
            searchButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Suche...';
            searchButton.disabled = true;
            
            // Appel à votre API Laravel
            fetch('/check-email-exists', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    email: email
                })
            })
            .then(response => {
                console.log('API Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('API Response data:', data);
                console.log('Customer exists:', data.exists);
                console.log('Customer data:', data.customer);
                
                if (data.exists && data.customer) {
                    console.log('Customer found:', data.customer);
                    
                    // Afficher le formulaire principal
                    const sectionsToShow = [
                        '.col-md-12.why-asking',
                        '#iAm',
                        '.row:has(#first_name)',
                        '.row:has(#last_name)',
                        '.row:has(#streetno)',
                        '.row:has(#houseno)',
                        '.row:has(#zip)',
                        '.row:has(#city)',
                        '.row:has(#Gaburtadatum)',
                        '.row:has(#telno)',
                        '.row:has(#email2)',
                        '.row:has(#health-insurance)',
                        '.row:has(#insurance-no)',
                        '.row:has(#KrankenkasseNummer)',
                        '.row:has(#angehoriger_name)',
                        '.row:has(#angehoriger_telefon)',
                        '.row:has(#angehoriger_email)',
                        '.row:has(#pflegegrad)',
                        '.row:has(#submitBtn)'
                    ];
                    
                    sectionsToShow.forEach(selector => {
                        const elements = document.querySelectorAll(selector);
                        elements.forEach(element => {
                            element.style.display = 'block';
                        });
                    });
                    
                    // Afficher un message d'information
                    showAlert('✅ E-Mail gefunden! Die Kundendaten wurden automatisch geladen.', 'success');
                    emailExists = false; // Pour la recherche, on autorise le passage à l'étape suivante
                    emailFoundBySearch = true; // Marquer que l'email a été trouvé par recherche
                    insuranceNumberFoundBySearch = true; // Marquer que le numéro d'assurance a été trouvé par recherche
                    krankenkasseNumberFoundBySearch = true; // Marquer que le numéro de Krankenkasse a été trouvé par recherche
                    
                    // Remplir les champs avec logs de débogage
                    console.log('Customer data received:', data.customer);
                    
                    const firstNameField = document.getElementById('first_name');
                    const lastNameField = document.getElementById('last_name');
                    const streetField = document.getElementById('streetno');
                    const houseField = document.getElementById('houseno');
                    const zipField = document.getElementById('zip');
                    const cityField = document.getElementById('city');
                    
                    console.log('Fields found:', {
                        firstName: firstNameField,
                        lastName: lastNameField,
                        street: streetField,
                        house: houseField,
                        zip: zipField,
                        city: cityField
                    });
                    
                    if (firstNameField) firstNameField.value = data.customer.firstName || '';
                    if (lastNameField) lastNameField.value = data.customer.lastName || '';
                    if (streetField) streetField.value = data.customer.street || '';
                    if (houseField) houseField.value = data.customer.houseNo || '';
                    if (zipField) zipField.value = data.customer.zipcode || '';
                    if (cityField) cityField.value = data.customer.city || '';
                    // Convertir la date au format yyyy-mm-dd pour HTML5
                    if (data.customer.dob) {
                        const date = new Date(data.customer.dob);
                        const formattedDate = date.getFullYear() + '-' + 
                                            (date.getMonth() + 1).toString().padStart(2, '0') + '-' + 
                                            date.getDate().toString().padStart(2, '0');
                        document.getElementById('Gaburtadatum').value = formattedDate;
                    }
                    document.getElementById('telno').value = data.customer.telephone;
                    document.getElementById('email2').value = email;
                    document.getElementById('health-insurance').value = data.customer.insuranceName;
                    document.getElementById('insurance-no').value = data.customer.insuranceNumber;
                    document.getElementById('KrankenkasseNummer').value = data.customer.healthInsuranceNo;
                    
                    // Remplir les champs Angehöriger/Pflegeperson si disponibles
                    if (data.customer.angehorigerName) {
                        document.getElementById('angehoriger_name').value = data.customer.angehorigerName;
                    }
                    if (data.customer.angehorigerTelefon) {
                        document.getElementById('angehoriger_telefon').value = data.customer.angehorigerTelefon;
                    }
                    if (data.customer.angehorigerEmail) {
                        document.getElementById('angehoriger_email').value = data.customer.angehorigerEmail;
                    }
                    
                    // Pré-sélectionner Herr ou Frau selon les données du client (surname)
                    if (data.customer.surname) {
                        if (data.customer.surname === 'Herr') {
                            document.querySelector('input[name="title_name"][value="Herr"]').checked = true;
                        } else if (data.customer.surname === 'Frau') {
                            document.querySelector('input[name="title_name"][value="Frau"]').checked = true;
                        }
                        console.log('Titre pré-sélectionné:', data.customer.surname);
                    }
                    
                    // Pré-sélectionner Versicherter ou Pflegeperson selon les données du client (insured_type)
                    if (data.customer.insured_type) {
                        if (data.customer.insured_type === 'Versicherter') {
                            document.querySelector('input[name="insured"][value="Versicherter"]').checked = true;
                        } else if (data.customer.insured_type === 'Angehöriger / Pflegeperson' || data.customer.insured_type === 'Pflegeperson') {
                            document.querySelector('input[name="insured"][value="Pflegeperson"]').checked = true;
                        }
                        console.log('Statut pré-sélectionné:', data.customer.insured_type);
                        
                        // Appeler optperson() pour gérer l'affichage de la section "Kontaktdaten Angehöriger/Pflegeperson"
                        optperson();
                    }
                    
                    // Pré-sélectionner le Pflegegrad selon les données du client
                    console.log('=== DÉBUT DEBUG PFLEGEGRAD (FONCTION 2) ===');
                    console.log('Données client complètes:', data.customer);
                    console.log('Pflegegrad dans les données:', data.customer.pflegegrad);
                    console.log('Type de pflegegrad:', typeof data.customer.pflegegrad);
                    
                    if (data.customer.pflegegrad) {
                        console.log('Pflegegrad reçu de la base de données:', data.customer.pflegegrad);
                        
                        // Extraire le numéro du pflegegrad (ex: "Pflegegrad3" -> "3" ou "3" -> "3")
                        let pflegegradValue = data.customer.pflegegrad.toString();
                        if (pflegegradValue.startsWith('Pflegegrad')) {
                            pflegegradValue = pflegegradValue.replace('Pflegegrad', '');
                        }
                        
                        console.log('Valeur Pflegegrad extraite:', pflegegradValue);
                        
                        // Vérifier tous les radio buttons pflegegrad disponibles
                            const allPflegegradRadios = document.querySelectorAll('input[name="pflegegrad"]');
                        console.log('Radio buttons pflegegrad trouvés:', allPflegegradRadios.length);
                        allPflegegradRadios.forEach((radio, index) => {
                            console.log(`Radio ${index}: name="${radio.name}", value="${radio.value}", id="${radio.id}"`);
                        });
                        
                        // Sélectionner le radio button correspondant
                        const pflegegradRadio = document.querySelector(`input[name="pflegegrad"][value="${pflegegradValue}"]`);
                        console.log('Radio button sélectionné:', pflegegradRadio);
                        
                        if (pflegegradRadio) {
                            pflegegradRadio.checked = true;
                            console.log(`✅ Radio Pflegegrad ${pflegegradValue} sélectionné`);
                            
                            // Déclencher l'événement change pour s'assurer que les fonctions associées sont exécutées
                            pflegegradRadio.dispatchEvent(new Event('change'));
                        } else {
                            console.log(`❌ Radio Pflegegrad ${pflegegradValue} non trouvé`);
                        }
                    } else {
                        console.log('Aucun Pflegegrad trouvé dans les données client (fonction 2)');
                    }
                    console.log('=== FIN DEBUG PFLEGEGRAD (FONCTION 2) ===');
        
        // Fonctions de test pour débogage
        function testSessionData() {
            fetch('/test-session')
                .then(response => response.json())
                .then(data => {
                    console.log('Session Data:', data);
                    alert('Session Data: ' + JSON.stringify(data, null, 2));
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error: ' + error);
                });
        }
        
        function reloadPage() {
            location.reload();
        }
        
        function setTestData() {
            window.location.href = '/test-set-session';
                    }
                    
                    // Effacer toutes les erreurs et bordures rouges
                    console.log('Effacement des erreurs après remplissage...');
                    clearAllFieldErrors();
                    
                    // Effacement manuel des champs spécifiques
                    const fieldsToClear = ['first_name', 'last_name', 'streetno', 'houseno', 'zip', 'city', 'Gaburtadatum', 'telno', 'email2', 'angehoriger_name', 'angehoriger_telefon', 'angehoriger_email', 'health-insurance', 'insurance-no', 'KrankenkasseNummer'];
                    fieldsToClear.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) {
                            field.classList.remove('error');
                            // Forcer le style normal avec !important
                            field.style.setProperty('border', '1px solid #ced4da', 'important');
                            field.style.setProperty('box-shadow', 'none', 'important');
                            console.log('Classe error supprimée de:', fieldId);
                        }
                    });
                    
                    // Debug spécifique pour first_name
                    const firstNameField = document.getElementById('first_name');
                    if (firstNameField) {
                        console.log('first_name trouvé:', firstNameField);
                        console.log('Classes avant:', firstNameField.className);
                        firstNameField.classList.remove('error');
                        console.log('Classes après:', firstNameField.className);
                        
                        // Forcer le style inline pour enlever la bordure rouge
                        firstNameField.style.setProperty('border', '1px solid #ced4da', 'important');
                        firstNameField.style.setProperty('box-shadow', 'none', 'important');
                        console.log('Style inline forcé pour first_name');
                    }
                    
                    // Masquer les champs de mot de passe
                    const passwordFields = document.querySelectorAll('.password-fields');
                    passwordFields.forEach(field => field.style.display = 'none');
                    
                    // Afficher le bouton de suppression
                    document.getElementById('clearBtn').style.display = 'inline-block';
                    
                    // Message de succès
                    const alertDiv = document.getElementById('alertMessage');
                    alertDiv.innerHTML = '<div class="alert alert-success mt-3">✅ Kunde gefunden! Die Formularfelder werden automatisch ausgefüllt.</div>';
                    
                    console.log('Customer data filled successfully');
                } else {
                    console.log('Customer not found');
                    
                    // Afficher le formulaire principal mais vide
                    const sectionsToShow = [
                        '.col-md-12.why-asking',
                        '#iAm',
                        '.row:has(#first_name)',
                        '.row:has(#last_name)',
                        '.row:has(#streetno)',
                        '.row:has(#houseno)',
                        '.row:has(#zip)',
                        '.row:has(#city)',
                        '.row:has(#Gaburtadatum)',
                        '.row:has(#telno)',
                        '.row:has(#email2)',
                        '.row:has(#health-insurance)',
                        '.row:has(#insurance-no)',
                        '.row:has(#KrankenkasseNummer)',
                        '.row:has(#angehoriger_name)',
                        '.row:has(#angehoriger_telefon)',
                        '.row:has(#angehoriger_email)',
                        '.row:has(#pflegegrad)',
                        '.row:has(#submitBtn)'
                    ];
                    
                    sectionsToShow.forEach(selector => {
                        const elements = document.querySelectorAll(selector);
                        elements.forEach(element => {
                            element.style.display = 'block';
                        });
                    });
                    
                    // Afficher les champs de mot de passe
                    const passwordFields = document.querySelectorAll('.password-fields');
                    passwordFields.forEach(field => field.style.display = 'block');
                    
                    // Masquer le bouton de suppression
                    document.getElementById('clearBtn').style.display = 'none';
                    
                    // Message d'information - email n'existe pas
                    showModernModal('ℹ️ E-Mail nicht gefunden. Sie können ein neues Konto erstellen, indem Sie das untenstehende Formular ausfüllen.', 'info');
                    emailExists = false; // Marquer que l'email n'existe pas
                }
            })
            .catch(error => {
                console.error('API-Fehler:', error);
                const alertDiv = document.getElementById('alertMessage');
                alertDiv.innerHTML = '<div class="alert alert-danger mt-3">❌ Fehler bei der Suche. Bitte versuchen Sie es erneut.</div>';
            })
            .finally(() => {
                // Restaurer le bouton
                searchButton.innerHTML = originalText;
                searchButton.disabled = false;
            });
        }

                    // Automatische Suche beim Laden
            document.addEventListener('DOMContentLoaded', function() {
                // Datumsfeld initialisieren
                const dateField = document.getElementById('Gaburtadatum');
                if (dateField) {
                    console.log('Champ de date HTML5 initialisé');
                }
                
                // Gestionnaire pour le bouton de modification d'adresse
                const editButton = document.getElementById('editDeliveryAddress');
                if (editButton) {
                    let isEditing = false;
                    
                    editButton.addEventListener('click', function() {
                        const addressFields = ['Drecipient_name', 'Dstreetno', 'Dhouseno', 'Dzip', 'Dcity'];
                        
                        if (!isEditing) {
                            // Mode édition - rendre les champs modifiables
                            addressFields.forEach(fieldId => {
                                const field = document.getElementById(fieldId);
                                if (field) {
                                    field.removeAttribute('readonly');
                                    field.classList.remove('form-control');
                                    field.classList.add('form-control');
                                    field.style.backgroundColor = 'white';
                                    field.style.color = '#212529';
                                    field.style.cursor = 'text';
                                }
                            });
                            
                            // Changer le bouton en mode sauvegarde
                            this.innerHTML = '<i class="fas fa-save"></i> Sauvegarder';
                            this.classList.remove('btn-outline-primary');
                            this.classList.add('btn-success');
                            isEditing = true;
                        } else {
                            // Mode sauvegarde - remettre en readonly
                            addressFields.forEach(fieldId => {
                                const field = document.getElementById(fieldId);
                                if (field) {
                                    field.setAttribute('readonly', 'readonly');
                                    field.style.backgroundColor = '#f8f9fa';
                                    field.style.color = '#6c757d';
                                    field.style.cursor = 'not-allowed';
                                }
                            });
                            
                            // Remettre le bouton en mode édition
                            this.innerHTML = '<i class="fas fa-edit"></i> Modifier l\'adresse';
                            this.classList.remove('btn-success');
                            this.classList.add('btn-outline-primary');
                            isEditing = false;
                        }
                    });
                }
                
                console.log('DOM loaded, checking for email');
                const emailField = document.getElementById('search_email');
                if (emailField && emailField.value) {
                    console.log('Email found, auto-searching...');
                    setTimeout(() => {
                        testSearchCustomer();
                    }, 1000);
                }
                
                // Effacer les erreurs quand l'utilisateur tape dans un champ
                const formFields = [
                    'first_name', 'last_name', 'streetno', 'houseno', 'zip', 'city', 
                    'Gaburtadatum', 'telno', 'email2', 'health-insurance', 'insurance-no', 'KrankenkasseNummer'
                ];
                
                formFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', function() {
                            if (this.value.trim() !== '') {
                                this.classList.remove('error');
                                
                                // Mapper les IDs vers les bonnes classes d'erreur
                                const errorClassMap = {
                                    'first_name': 'first_name_error_msg',
                                    'last_name': 'last_name_error_msg',
                                    'streetno': 'streetno_error_msg',
                                    'houseno': 'houseno_error_msg',
                                    'zip': 'zip_error_msg',
                                    'city': 'city_error_msg',
                                    'Gaburtadatum': 'gaburtadatum_error_msg',
                                    'telno': 'telno_error_msg',
                                    'email2': 'email2_error_msg',
                                    'password': 'password_error_msg',
                                    'confirm_password': 'password2_error_msg',
                                    'health-insurance': 'hinsurance_error_msg',
                                    'insurance-no': 'insuranceno_error_msg',
                                    'KrankenkasseNummer': 'krankenkasse_error_msg'
                                };
                                
                                const errorClassName = errorClassMap[fieldId] || fieldId + '_error_msg';
                                const errorMsg = document.querySelector('.' + errorClassName);
                                if (errorMsg) {
                                    errorMsg.textContent = '';
                                }
                            }
                        });
                    }
                });
                
                // Fonction simple pour fermer le modal (globale)
                window.closeModal = function() {
                    console.log('closeModal function called');
                    const modalElement = document.getElementById('validationErrorModal');
                    if (modalElement) {
                        console.log('Modal element found, closing...');
                        
                        // Fermeture manuelle simple
                        modalElement.style.display = 'none';
                        modalElement.classList.remove('show');
                        modalElement.classList.remove('fade');
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // Supprimer tous les backdrops
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => backdrop.remove());
                        
                        console.log('Modal closed successfully');
                    } else {
                        console.log('Modal element not found');
                    }
                }
                
                // Gestionnaire direct pour le bouton Schließen avec ID
                const closeBtn = document.getElementById('closeModalBtn');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Schließen-Button geklickt!');
                        closeModal();
                    });
                }
                
                // Gestionnaire de secours avec event delegation
                document.addEventListener('click', function(e) {
                    if (e.target.closest('#validationErrorModal .btn-secondary')) {
                        e.preventDefault();
                        console.log('Schließen-Button geklickt (delegation)!');
                        closeModal();
                    }
                });
                
                // Gestionnaire pour le bouton X
                document.addEventListener('click', function(e) {
                    if (e.target.closest('#validationErrorModal .btn-close')) {
                        e.preventDefault();
                        console.log('X-Button geklickt!');
                        closeModal();
                    }
                });
                
                // Fonction pour afficher le modal d'erreur des Bettschutzeinlagen
                window.showBedProtectionErrorModal = function() {
                    const modalElement = document.getElementById('bedProtectionErrorModal');
                    if (modalElement) {
                        console.log('Affichage du modal d\'erreur Bettschutzeinlagen...');
                        
                        // Créer le backdrop
                        const backdrop = document.createElement('div');
                        backdrop.className = 'modal-backdrop fade show';
                        backdrop.id = 'bedProtectionErrorBackdrop';
                        document.body.appendChild(backdrop);
                        
                        // Afficher le modal
                        modalElement.style.display = 'block';
                        modalElement.classList.add('show');
                        modalElement.classList.add('fade');
                        document.body.classList.add('modal-open');
                        document.body.style.overflow = 'hidden';
                        
                        // Ajouter le gestionnaire d'événement pour le bouton Verstanden
                        setTimeout(() => {
                            const closeBtn = modalElement.querySelector('.btn-danger');
                            if (closeBtn) {
                                closeBtn.onclick = function(e) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    console.log('Bouton Verstanden cliqué');
                                    closeBedProtectionErrorModal();
                                };
                            }
                            
                            // Gestionnaire pour fermer en cliquant sur le backdrop
                            const backdropElement = document.getElementById('bedProtectionErrorBackdrop');
                            if (backdropElement) {
                                backdropElement.onclick = function() {
                                    console.log('Backdrop geklickt!');
                                    closeBedProtectionErrorModal();
                                };
                            }
                        }, 100);
                    }
                };
                
                // Fonction pour fermer le modal d'erreur des Bettschutzeinlagen
                window.closeBedProtectionErrorModal = function() {
                    const modalElement = document.getElementById('bedProtectionErrorModal');
                    if (modalElement) {
                        console.log('Fermeture du modal d\'erreur Bettschutzeinlagen...');
                        
                        // Fermeture manuelle simple
                        modalElement.style.display = 'none';
                        modalElement.classList.remove('show');
                        modalElement.classList.remove('fade');
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // Supprimer le backdrop
                        const backdrop = document.getElementById('bedProtectionErrorBackdrop');
                        if (backdrop) {
                            backdrop.remove();
                        }
                        
                        console.log('Modal d\'erreur Bettschutzeinlagen fermé');
                    }
                };

                // Gestionnaire pour les boutons Fermer des modals Bettschutzeinlagen (globale)
                window.closeBedProtectorModal = function() {
                    // Fermer tous les modals Bettschutzeinlagen
                    const modals = document.querySelectorAll('[id*="bed_protector_modal"]');
                    modals.forEach(modal => {
                        modal.style.display = 'none';
                        modal.classList.remove('show');
                    });
                    
                    // Supprimer les backdrops
                    const backdrops = document.querySelectorAll('.modal-backdrop');
                    backdrops.forEach(backdrop => backdrop.remove());
                    
                    // Restaurer le body
                    document.body.classList.remove('modal-open');
                    document.body.style.overflow = '';
                    document.body.style.paddingRight = '';
                    
                    console.log('Modal Bettschutzeinlagen fermé');
                }
                
                // Ajouter les gestionnaires d'événements pour les boutons Schließen
                document.addEventListener('click', function(e) {
                    if (e.target.textContent.trim() === 'Schließen' && e.target.closest('.modal-footer')) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Bouton Schließen cliqué dans modal Bettschutzeinlagen');
                        closeBedProtectorModal();
                    }
                });
                
                // Gestionnaire de secours pour le bouton du modal d'erreur Bettschutzeinlagen
                document.addEventListener('click', function(e) {
                    if (e.target.textContent.trim() === 'Verstanden' && e.target.closest('#bedProtectionErrorModal')) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Bouton Verstanden cliqué (delegation)');
                        closeBedProtectionErrorModal();
                    }
                });
            });
    </script>
    <script>
        function base_url() {
            console.log('=== base_url() appelée ===');
            console.log('location.host:', location.host);
            console.log('location.origin:', location.origin);
            console.log('location.pathname:', location.pathname);
            
            var i = location.pathname.split("/");
            console.log('pathname split:', i);
            
            var a;
            if ("localhost" == location.host) {
                a = location.origin + "/" + i[1].trim("/") + "/";
                console.log('URL localhost construite:', a);
            } else {
                a = location.origin + '/';
                console.log('URL production construite:', a);
            }
            
            console.log('base_url() retourne:', a);
            return a;
        };

        function getProduct(i) {
            var url = base_url() + "getProductCart?type=add";
            
            $.ajax({
                headers: {
                    "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
                },
                type: "POST",
                url: url,
                data: "productId=" + i,
                success: function(a) {
                    if (parseInt($(".cartPriceValue").val()) + parseFloat(a.price) <= 42) {
                        if ($(".recProduct" + i).length < 1) {
                            $('#qty_pd_' + a.id).html('1');
                            $('#pd_' + a.id).html('&#10003;');
                            if ($(".receiver").append('<div data-id="' + a.id + '" class="content border-1 cartItem recProduct' + a.id + '" ><div class="product mb-3"><img src="<?= asset("storage") ?>/' + a.image + '"><div class="prod-info"><div class="prod-name">' + a.name + '</div><div class="prod-size">' + a.product_title + '</div></div><div class="prod-btn" onclick="less(' + a.id + ')" ><span class="qty quantity' + a.id + '">1</span><input type="hidden" id="qty_p_' + a.id + '" value="1"><input type="hidden" class="cartPrice" id="price_p_' + a.id + '" value="' + a.price + '"><i class="fas fa-minus-circle"></i></div></div>' + ("" != a.size_availability ? '<div class="glove-options"><div class="d-flex"><img src="{{asset("frontend/assets/images/icon-handschuh.svg")}}"><label>Welche Handschuhgr\xf6\xdfe haben Sie?</label></div></div>' : '') + '<div class="base-click-box size' + a.id + '" id="bx-' + a.id + '"></div></div>'), $(".cartPriceValue").attr("value", (parseFloat(a.price) + parseFloat($(".cartPriceValue").val())).toLocaleString("en-US", {
                                    maximumFractionDigits: 2,
                                    minimumFractionDigits: 2
                                })), "" != a.size_availability) {
                                $(".size" + a.id).prepend('<div class="productss" id="checkData-' + a.id + '"></div>');
                                var t = a.size_availability.split(",");
                                $.each(t, function(i) {
                                    $("#checkData-" + a.id).append('<div class="lengend-action-buttons lengend-action-buttons-first"><label class="prod-count bg-white" for="d3_graph_chart' + a.id + t[i] + '"><input onclick="fetchSize(' + a.id + ')" class="SIZE' + a.id + '" id="d3_graph_chart' + a.id + t[i] + '" name="size' + a.id + '" type="radio" value="' + t[i] + '"> <span><p><font style="vertical-align:inherit"><font style="vertical-align:inherit">' + t[i] + "</font></span></label></div>")
                                });

                            }
                            $(".progress-bar").css("width", 100 * parseFloat($(".cartPriceValue").val()) / 42 + "%"), cartItemBlur()
                        } else {
                            var e = parseFloat($("#qty_p_" + i).val()) + 1;
                            $('#qty_pd_' + a.id).html(e);
                            $("#qty_p_" + i).attr("value", e), $("#price_p_" + i).attr("value", (parseFloat(e) * parseInt(a.price)).toLocaleString("en-US", {
                                maximumFractionDigits: 2,
                                minimumFractionDigits: 2
                            })), $(".cartPriceValue").attr("value", (parseFloat(a.price) + parseFloat($(".cartPriceValue").val())).toLocaleString("en-US", {
                                maximumFractionDigits: 2,
                                minimumFractionDigits: 2
                            })), $(".quantity" + i).html(e), $(".progress-bar").css("width", 100 * parseFloat($(".cartPriceValue").val()) / 42 + "%"), cartItemBlur()
                        }
                    }
                }
            })
        };

        // Variable globale pour stocker les tailles sélectionnées
        window.selectedSizes = window.selectedSizes || {};
        console.log('Variable globale selectedSizes initialisée:', window.selectedSizes);
        
        // Debug: Afficher tous les inputs de taille au chargement
        $(document).ready(function() {
            console.log('=== SEITENLADUNG: Suche nach Größen-Eingaben ===');
            $('input[name^="size"]').each(function(index) {
                console.log('Input de taille ' + index + ':', {
                    name: $(this).attr('name'),
                    value: $(this).val(),
                    checked: $(this).is(':checked'),
                    id: $(this).attr('id'),
                    element: $(this)
                });
            });
            console.log('Gesamtanzahl gefundener Größen-Eingaben:', $('input[name^="size"]').length);
            console.log('=== SEITENLADUNG BEENDET ===');
            
            // Status des Angehöriger/Pflegeperson-Blocks initialisieren
            optperson();
            
            // Forcer les couleurs au chargement de la page
            forceStepColors();
            
            // FORCER AUSSI APRÈS UN DÉLAI POUR ÊTRE SÛR
            setTimeout(function() {
                forceStepColors();
                optperson(); // Vérifier à nouveau l'état du bloc
            }, 500);
            
            // FORCER ENCORE APRÈS UN AUTRE DÉLAI
            setTimeout(function() {
                forceStepColors();
                optperson(); // Vérifier à nouveau l'état du bloc
            }, 1000);
        });
        
        // Fonction pour forcer les couleurs des étapes - APPROCHE DIRECTE
        function forceStepColors() {
            console.log('=== FORCEMENT DES COULEURS - APPROCHE DIRECTE ===');
            
            // FORCER TOUTES LES ÉTAPES EN GRIS D'ABORD
            $('.step1 .step-text, .step2 .step-text, .step3 .step-text, .step4 .step-text, .step5 .step-text').css('color', 'var(--turquoise) !important');
            $('.step1 .step-number, .step2 .step-number, .step3 .step-number, .step4 .step-number, .step5 .step-number').css('background', 'var(--light-blue) !important');
            $('.step1 .step-divider, .step2 .step-divider, .step3 .step-divider, .step4 .step-divider, .step5 .step-divider').css('background', 'var(--light-blue) !important');
            
            console.log('Toutes les étapes forcées en gris');
            
            // PUIS FORCER SEULEMENT L'ÉTAPE ACTIVE EN TURQUOISE
            $('.step.active .step-text').css('color', 'var(--sky-blu) !important');
            $('.step.active .step-number').css('background', 'var(--blue-gradient) !important');
            $('.step.active .step-divider').css('background', 'var(--blue-gradient) !important');
            
            console.log('Étape active forcée en turquoise');
            console.log('=== FIN FORCEMENT DES COULEURS ===');
        }

        // Fonction pour gérer l'affichage du bloc Angehöriger/Pflegeperson
        function optperson() {
            console.log('=== optperson() appelée ===');
            
            // Vérifier quelle option est sélectionnée
            const selectedOption = $('input[name="insured"]:checked').val();
            console.log('Option sélectionnée:', selectedOption || 'Aucune option sélectionnée');
            
            // Récupérer le bloc Angehöriger/Pflegeperson
            const angehorigerBlock = $('#angehoriger-contact');
            console.log('Bloc trouvé:', angehorigerBlock.length > 0);
            console.log('Classes actuelles:', angehorigerBlock.attr('class'));
            
            if (selectedOption === 'Pflegeperson') {
                // Afficher le bloc si "Angehöriger / Pflegeperson" est sélectionné
                angehorigerBlock.removeClass('d-none');
                console.log('Bloc affiché - Classes après:', angehorigerBlock.attr('class'));
            } else {
                // Masquer le bloc si "Versicherter" est sélectionné
                angehorigerBlock.addClass('d-none');
                console.log('Bloc masqué - Classes après:', angehorigerBlock.attr('class'));
            }
            
            console.log('=== FIN optperson() ===');
        }
        
        // Fonction de test
        function testOptperson() {
            console.log('=== TEST optperson() ===');
            optperson();
        }
        
        // Fonction pour forcer l'affichage du bloc
        function forceShowBlock() {
            console.log('=== FORCER AFFICHAGE ===');
            const block = $('#angehoriger-contact');
            block.removeClass('d-none');
            block.css('display', 'block');
            block.css('background-color', 'lime');
            console.log('Bloc forcé visible');
        }

        // Debug: Écouter les clics sur les inputs de taille
        $(document).on('change', 'input[name^="size"]', function() {
            const productId = $(this).attr('name').replace('size', '');
            const selectedSize = $(this).val();
            console.log('=== ÉTAPE 1: Sélection de taille ===');
            console.log('Input de taille cliqué - Produit ID:', productId, 'Taille:', selectedSize);
            console.log('Élément cliqué:', $(this));
            console.log('Nom de l\'input:', $(this).attr('name'));
            console.log('Valeur de l\'input:', $(this).val());
            console.log('Input est checked:', $(this).is(':checked'));
            
            // Stocker directement dans la variable globale
            window.selectedSizes[productId] = selectedSize;
            console.log('Taille stockée dans window.selectedSizes:', window.selectedSizes);
            
            // Stocker aussi dans localStorage comme backup
            localStorage.setItem('selectedSizes', JSON.stringify(window.selectedSizes));
            console.log('Taille stockée dans localStorage:', localStorage.getItem('selectedSizes'));
            console.log('=== FIN ÉTAPE 1 ===');
        });

        function fetchSize(id) {
            console.log('=== fetchSize appelée ===');
            console.log('ID du produit:', id);
            
            const selectedSize = $('input[name="size' + id + '"]:checked').val();
            console.log('Taille trouvée avec fetchSize:', selectedSize);
            console.log('Sélecteur utilisé:', 'input[name="size' + id + '"]:checked');
            console.log('Nombre d\'inputs trouvés:', $('input[name="size' + id + '"]').length);
            console.log('Inputs checked:', $('input[name="size' + id + '"]:checked').length);
            
            $('#pd_size_' + id).html(" (" + selectedSize + ") ");
            console.log('Élément pd_size_' + id + ' mis à jour avec:', " (" + selectedSize + ") ");
            
            // Stocker la taille dans la variable globale
            window.selectedSizes[id] = selectedSize;
            console.log('Taille stockée dans fetchSize pour produit', id, ':', selectedSize);
            console.log('Variable globale mise à jour dans fetchSize:', window.selectedSizes);
            console.log('=== FIN fetchSize ===');
        }

        function less(i) {
            var url = base_url() + "getProductCart?type=remove";
            console.log('URL de la requête remove:', url);
            
            $.ajax({
                headers: {
                    "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
                },
                type: "POST",
                url: url,
                data: "productId=" + i,
                success: function(a) {

                    $('#qty_pd_' + a.id).html($("#qty_p_" + i).val() - 1);
                    parseInt($("#qty_p_" + i).val()) > 1 ? ($("#qty_p_" + i).attr("value", $("#qty_p_" + i).val() - 1), $(".quantity" + i).html($("#qty_p_" + i).val()), $(".cartPriceValue").attr("value", (parseInt($(".cartPriceValue").val()) - parseInt(a.price)).toLocaleString("en-US", {
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                    })), $(".progress-bar").css("width", 100 * parseFloat($(".cartPriceValue").val()) / 42 + "%"), cartItemBlur()) : ($(".cartPriceValue").attr("value", (parseInt($(".cartPriceValue").val()) - parseInt(a.price)).toLocaleString("en-US", {
                        maximumFractionDigits: 2,
                        minimumFractionDigits: 2
                    })), $(".recProduct" + i).remove(), $(".progress-bar").css("width", 100 * parseFloat($(".cartPriceValue").val()) / 42 + "%"), cartItemBlur(), $('#pd_' + a.id).empty(), $('#qty_pd_' + a.id).empty(), $('#pd_size_' + id).empty(), delete window.selectedSizes[i])
                }
            })
        };

        function signature() {
            console.log('=== Passage à l\'étape 5 - Résumé ===');
            
            // Remplir le résumé avec les données du formulaire
            fillSummaryData();
            
            $("#step4").css("display", "none");
            $("#step5").css("display", "block");
            $(".step4").removeClass("active");
            $(".step5").addClass("active");
            
            // Afficher le bloc de consentement secondaire à l'étape 5
            const consentSection3 = document.getElementById('consent-section-3');
            if (consentSection3) {
                consentSection3.style.setProperty('display', 'block', 'important');
                console.log('Bloc de consentement secondaire affiché à l\'étape 5');
            }
            
            // Forcer les couleurs après changement d'étape
            setTimeout(function() {
                forceStepColors();
                // Remplir à nouveau le résumé après un délai pour s'assurer que tout est chargé
                fillSummaryData();
            }, 100);
        }
        
        // Fonction pour remplir le résumé des données
        function fillSummaryData() {
            console.log('=== DEBUG: Remplissage du résumé des données ===');
            
            // Informations personnelles
            const firstName = $("#first_name").val() || '';
            const lastName = $("#last_name").val() || '';
            const fullName = firstName + ' ' + lastName;
            
            console.log('Prénom:', firstName);
            console.log('Nom:', lastName);
            console.log('Nom complet:', fullName);
            
            $("#summary_full_name").text(fullName);
            $("#summary_email").text($("#email2").val() || '');
            $("#summary_phone").text($("#telno").val() || '');
            $("#summary_birth_date").text($("#Gaburtadatum").val() || '');
            $("#summary_address").text($("#streetno").val() || '');
            $("#summary_zip").text($("#zip").val() || '');
            $("#summary_city").text($("#city").val() || '');
            
            // Pflegegrad
            const selectedPflegegrad = $('input[name="Pflegegrad"]:checked').val();
            console.log('Pflegegrad sélectionné:', selectedPflegegrad);
            $("#summary_pflegegrad").text(selectedPflegegrad || 'Nicht ausgewählt');
            
            // Versicherungstyp (Der Versicherte ist)
            let selectedInsuranceType = $('input[name="inlineRadioOptions5"]:checked').val();
            if (!selectedInsuranceType) {
                selectedInsuranceType = $('input[name="inlineRadioOptions5_2"]:checked').val();
            }
            console.log('Ausgewählter Versicherungstyp:', selectedInsuranceType);
            
            // Convertir les valeurs en texte lisible
            let insuranceTypeText = 'Nicht ausgewählt';
            if (selectedInsuranceType === 'option5') {
                insuranceTypeText = 'Gesetzlich versichert (Kostenübernahme durch die Pflegekasse)';
            } else if (selectedInsuranceType === 'option6') {
                insuranceTypeText = 'Privat versichert';
            }
            
            $("#summary_insurance_type").text(insuranceTypeText);
            
            // Statut de la personne (Ich bin)
            const selectedPersonStatus = $('input[name="insured"]:checked').val();
            console.log('Statut de la personne sélectionné:', selectedPersonStatus);
            
            // Convertir les valeurs en texte lisible
            let personStatusText = 'Nicht ausgewählt';
            if (selectedPersonStatus === 'Versicherter') {
                personStatusText = 'Versicherter';
            } else if (selectedPersonStatus === 'Pflegeperson') {
                personStatusText = 'Angehöriger / Pflegeperson';
            }
            
            // Ajouter cette information au résumé si elle n'existe pas déjà
            if ($("#summary_person_status").length === 0) {
                $("#summary_insurance_type").parent().before('<p><strong>Ich bin:</strong> <span id="summary_person_status"></span></p>');
            }
            $("#summary_person_status").text(personStatusText);
            
            // Versicherungsinformationen
            $("#summary_insurance_name").text($("#health-insurance").val() || '');
            $("#summary_insurance_number").text($("#insurance-no").val() || '');
            $("#summary_krankenkasse_number").text($("#KrankenkasseNummer").val() || '');
            
            // Adresse de livraison
            $("#summary_delivery_name").text($("#Drecipient_name").val() || '');
            $("#summary_delivery_street").text($("#Dstreetno").val() || '');
            $("#summary_delivery_number").text($("#Dhouseno").val() || '');
            $("#summary_delivery_zip").text($("#Dzip").val() || '');
            $("#summary_delivery_city").text($("#Dcity").val() || '');
            
            // Produits sélectionnés
            fillProductsSummary();
            
            // Signature
            const signatureSrc = $("#signatureImg").attr('src');
            if (signatureSrc && signatureSrc !== '') {
                $("#summary_signature").attr('src', signatureSrc);
                $("#summary_signature").show();
            } else {
                $("#summary_signature").hide();
            }
            
            console.log('=== ZUSAMMENFASSUNG AUSGEFÜLLT ===');
        }
        
        // Fonction pour remplir le résumé des produits
        function fillProductsSummary() {
            const productsList = $("#summary_products_list");
            let totalValue = 0;
            let productsCount = 0;
            let productsHtml = '';
            
            console.log('=== DEBUG: Remplissage du résumé des produits ===');
            console.log('Tailles stockées dans window.selectedSizes:', window.selectedSizes);
            console.log('Nombre d\'éléments .cartItem trouvés:', $('.cartItem').length);
            
            // Toujours afficher les tailles stockées
            console.log('Tailles disponibles:', window.selectedSizes);
            
            // Ajouter les tailles aux produits existants
            if (Object.keys(window.selectedSizes).length > 0) {
                console.log('Ajout des tailles aux produits existants');
                
                // Attendre un peu pour que les éléments soient créés
                setTimeout(function() {
                    Object.keys(window.selectedSizes).forEach(function(productId) {
                        const selectedSize = window.selectedSizes[productId];
                        console.log('Ajout de la taille pour produit', productId, ':', selectedSize);
                        
                        // Chercher le produit dans le résumé et ajouter la taille
                        const productElement = $(`#summary_products_list .product-summary-item`).filter(function() {
                            return $(this).text().includes('Einmalhandschuhe') || $(this).text().includes('Gants');
                        });
                        
                        if (productElement.length > 0) {
                            // Vérifier si la taille n'est pas déjà ajoutée
                            if (!productElement.find('.text-info').length) {
                                // Ajouter la taille au produit existant
                                const sizeInfo = `<br><small class="text-info"><i class="fas fa-hand-paper"></i> Taille: ${selectedSize}</small>`;
                                productElement.find('.col-md-8').append(sizeInfo);
                                console.log('Taille ajoutée au produit existant');
                            } else {
                                console.log('Taille déjà présente, pas d\'ajout');
                            }
                        } else {
                            console.log('Produit Einmalhandschuhe non trouvé dans le résumé');
                        }
                    });
                }, 100);
            }
            
            // Debug: Afficher tous les inputs de taille disponibles
            $('input[name^="size"]').each(function() {
                console.log('Input de taille trouvé:', $(this).attr('name'), 'checked:', $(this).is(':checked'), 'value:', $(this).val());
            });
            
            // Parcourir tous les éléments cartItem
            $(".cartItem").each(function() {
                const productId = $(this).attr('data-id');
                const productName = $(this).find('.prod-name').text();
                const productTitle = $(this).find('.prod-size').text();
                const quantity = $(this).find('.qty').text() || '1';
                const price = $(this).find('.cartPrice').val() || '0';
                
                if (productName && productName.trim() !== '') {
                    productsCount++;
                    totalValue += parseFloat(price) * parseInt(quantity);
                    
                    // Vérifier si c'est un produit avec des tailles (gants)
                    let sizeInfo = '';
                    console.log('Produit ID:', productId, 'Nom:', productName);
                    
                    // Récupérer la taille depuis la variable globale ou localStorage
                    let selectedSize = window.selectedSizes[productId];
                    if (!selectedSize) {
                        // Essayer de récupérer depuis localStorage
                        const storedSizes = localStorage.getItem('selectedSizes');
                        if (storedSizes) {
                            const parsedSizes = JSON.parse(storedSizes);
                            selectedSize = parsedSizes[productId];
                            console.log('Taille récupérée depuis localStorage:', selectedSize);
                        }
                    }
                    console.log('Endgültige Größe für Produkt', productId, ':', selectedSize);
                    
                    if (selectedSize) {
                        sizeInfo = `<br><small class="text-info"><i class="fas fa-hand-paper"></i> Taille: ${selectedSize}</small>`;
                        console.log('Taille trouvée:', selectedSize);
                    }
                    
                    productsHtml += `
                        <div class="product-summary-item mb-2 p-2 border rounded">
                            <div class="row">
                                <div class="col-md-8">
                                    <strong>${productName}</strong><br>
                                    <small class="text-muted">${productTitle}</small>
                                    ${sizeInfo}
                                </div>
                                <div class="col-md-4 text-right">
                                    <span class="badge badge-primary">Quantité: ${quantity}</span><br>
                                    <small class="text-success">${price}€</small>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Ajouter les protège-lits réutilisables si sélectionnés
            const bedProtectionCount = $('input[name="number_of_bed"]:checked').val();
            if (bedProtectionCount && bedProtectionCount > 0) {
                productsCount++;
                productsHtml += `
                    <div class="product-summary-item mb-2 p-2 border rounded bg-light">
                        <div class="row">
                            <div class="col-md-8">
                                <strong>Réutilisable Protège-lits</strong><br>
                                <small class="text-muted">Bettschutzeinlagen - Jusqu'à 250 lavages</small>
                            </div>
                            <div class="col-md-4 text-right">
                                <span class="badge badge-success">Quantité: ${bedProtectionCount}</span><br>
                                <small class="text-success">Gratuit</small>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Afficher les produits ou le message par défaut
            if (productsHtml) {
                productsList.html(productsHtml);
            } else {
                productsList.html('<p class="text-muted">Aucun produit sélectionné</p>');
            }
            
            // Mettre à jour les compteurs
            $("#summary_products_count").text(productsCount);
            $("#summary_total_value").text(totalValue.toFixed(2) + '€');
        }
    </script>
    <script>
        function checkout_btn() {

            //console.log('test demo2');
            if ($("#agreement").prop('checked') != true) {
                console.log('Agreement not checked - adding red border');
                $("#agreement").addClass('border-red-checkbox');
            } else {
                $("#agreement").removeClass('border-red-checkbox');
                var o = {};
                o.product = [];
                $(".cartItem").each(function() {
                    var productID = $(this).attr('data-id');
                    var productQty = $('#qty_p_' + productID).val();
                    var productPrice = $('#price_p_' + productID).val();
                    o.product.push({
                        productID: productID,
                        productQty: productQty,
                        productPrice: productPrice
                    });
                });

                var personalInformation = [];
                var userDetails = {};
                userDetails['surname'] = $('input[name="title_name"]:checked').val();
                var insuredTypeValue = $('input[name="insured"]:checked').val();
                // Transformer "Pflegeperson" en "Angehöriger / Pflegeperson"
                if (insuredTypeValue === 'Pflegeperson') {
                    insuredTypeValue = 'Angehöriger / Pflegeperson';
                }
                userDetails['insured_type'] = insuredTypeValue;
                const pflegegradValue = $('input[name="Pflegegrad"]:checked').val();
            userDetails['pflegegrad'] = pflegegradValue ? pflegegradValue.replace('Pflegegrad', '') : null;
                
                // Ajouter le type d'assurance (Der Versicherte ist)
                console.log('=== DEBUG INSURANCE TYPE ===');
                console.log('All inlineRadioOptions5 inputs:', $('input[name="inlineRadioOptions5"]').length);
                console.log('Checked inlineRadioOptions5:', $('input[name="inlineRadioOptions5"]:checked').length);
                console.log('All radio inputs:', $('input[type="radio"]').length);
                console.log('All checked radio inputs:', $('input[type="radio"]:checked').length);
                
                // Debug spécifique pour les radio buttons d'assurance
                console.log('=== DEBUG RADIO BUTTONS ===');
                console.log('inlineRadioOptions5 count:', $('input[name="inlineRadioOptions5"]').length);
                console.log('inlineRadioOptions5_2 count:', $('input[name="inlineRadioOptions5_2"]').length);
                
                $('input[name="inlineRadioOptions5"]').each(function(index) {
                    console.log('Radio button 1-' + index + ':', $(this).val(), 'checked:', $(this).is(':checked'));
                });
                
                $('input[name="inlineRadioOptions5_2"]').each(function(index) {
                    console.log('Radio button 2-' + index + ':', $(this).val(), 'checked:', $(this).is(':checked'));
                });
                console.log('=== END DEBUG RADIO BUTTONS ===');
                
                // Afficher la valeur sélectionnée dans l'interface
                let selectedValue = $('input[name="inlineRadioOptions5"]:checked').val();
                if (!selectedValue) {
                    selectedValue = $('input[name="inlineRadioOptions5_2"]:checked').val();
                }
                
                if (selectedValue) {
                    const displayText = selectedValue === 'option5' ? 'Gesetzlich versichert (Kostenübernahme durch die Pflegekasse)' : 'Privat versichert';
                    $('#insurance-type-value').text(displayText);
                    $('#insurance-type-display').show();
                } else {
                    $('#insurance-type-display').hide();
                }
                
                // Vérifier d'abord la première section, puis la deuxième
                let insuranceType = $('input[name="inlineRadioOptions5"]:checked').val();
                if (!insuranceType) {
                    insuranceType = $('input[name="inlineRadioOptions5_2"]:checked').val();
                }
                
                // Ne pas écraser si déjà défini
                if (!userDetails['insurance_type']) {
                    if (insuranceType === 'option5') {
                        userDetails['insurance_type'] = 'G';
                    } else if (insuranceType === 'option6') {
                        userDetails['insurance_type'] = 'P';
                    } else {
                    }
                } else {
                }
                
                
                userDetails['first_name'] = $('#first_name').val();
                userDetails['last_name'] = $('#last_name').val();
                userDetails['streetno'] = $('#streetno').val();
                userDetails['houseno'] = $('#houseno').val();
                userDetails['zip'] = $('#zip').val();
                userDetails['city'] = $('#city').val();
                userDetails['dob'] = $('#Gaburtadatum').val();
                userDetails['telno'] = $('#telno').val();
                userDetails['email'] = $('#email2').val();
                userDetails['password'] = $('#password').val();
                userDetails['angehoriger_name'] = $('#angehoriger_name').val();
                userDetails['angehoriger_telefon'] = $('#angehoriger_telefon').val();
                userDetails['angehoriger_email'] = $('#angehoriger_email').val();
                userDetails['health_insurance'] = $('#health-insurance').val();
                userDetails['insurance_no'] = $('#insurance-no').val();
                userDetails['KrankenkasseNummer'] = $('#KrankenkasseNummer').val();
                personalInformation.push(userDetails);


                var customerDeliveryAddress = [];
                var deliveryAddress = {};
                deliveryAddress['recipient_name'] = $('#Drecipient_name').val();
                deliveryAddress['street'] = $('#Dstreetno').val();
                deliveryAddress['houseno'] = $('#Dhouseno').val();
                deliveryAddress['zip'] = $('#Dzip').val();
                deliveryAddress['city'] = $('#Dcity').val();
                customerDeliveryAddress.push(deliveryAddress);

                // Debug: Afficher les données avant envoi
                console.log('Données userDetails avant envoi:', personalInformation);
                console.log('Pflegegrad dans userDetails:', personalInformation[0].pflegegrad);

                $.ajax({
                    headers: {
                        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
                    },
                    type: "POST",
                    url: "{{ route('product.checkout') }}",
                    data: "productDetails=" + JSON.stringify(o) + '&userDetails=' + JSON.stringify(personalInformation) + '&deliveryAddress=' + JSON.stringify(customerDeliveryAddress) + '&signature=' + $('#signatureImg').attr('src'),
                    success: function(a) {
                        if (a.status == '1') {
                            successtoastMessage(a.message)
                            ///alert('success1');
                           
                        } else {
                            errortoastMessage(a.message)
                            ///alert('failled1');
                        }
                        setTimeout(function() {

                            if (a.status == '1') {
                                window.location.href = '/order-success';
                            }
                            else
                            {
                                location.reload();
                            }
                           
                        }, 5000);
                    }
                });
            }
        };
    </script>
    <script>
        function checkout_btn_pkg() {
            
            if ($("#agreement").prop('checked') != true) {
                console.log('Agreement not checked - adding red border');
                $("#agreement").addClass('border-red-checkbox');
            } else {
                $("#agreement").removeClass('border-red-checkbox');

                ///alert(userDetails['houseno']);

                var personalInformation = [];
                var userDetails = {};
                userDetails['surname'] = $('input[name="title_name"]:checked').val();
                var insuredTypeValue = $('input[name="insured"]:checked').val();
                // Transformer "Pflegeperson" en "Angehöriger / Pflegeperson"
                if (insuredTypeValue === 'Pflegeperson') {
                    insuredTypeValue = 'Angehöriger / Pflegeperson';
                }
                userDetails['insured_type'] = insuredTypeValue;
                const pflegegradValue = $('input[name="Pflegegrad"]:checked').val();
            userDetails['pflegegrad'] = pflegegradValue ? pflegegradValue.replace('Pflegegrad', '') : null;
                
                // Ajouter le type d'assurance (Der Versicherte ist) - PACKAGE VERSION
                let selectedInsuranceType = $('input[name="inlineRadioOptions5"]:checked').val();
                if (!selectedInsuranceType) {
                    selectedInsuranceType = $('input[name="inlineRadioOptions5_2"]:checked').val();
                }
                
                if (selectedInsuranceType === 'option5') {
                    userDetails['insurance_type'] = 'G';
                } else if (selectedInsuranceType === 'option6') {
                    userDetails['insurance_type'] = 'P';
                } else {
                }
                
                userDetails['first_name'] = $('#first_name').val();
                userDetails['last_name'] = $('#last_name').val();
                userDetails['streetno'] = $('#streetno').val();
                userDetails['houseno'] = $('#houseno').val();
                userDetails['zip'] = $('#zip').val();
                userDetails['city'] = $('#city').val();
                userDetails['dob'] = $('#Gaburtadatum').val();
                userDetails['telno'] = $('#telno').val();
                userDetails['email'] = $('#email2').val();
                userDetails['angehoriger_name'] = $('#angehoriger_name').val();
                userDetails['angehoriger_telefon'] = $('#angehoriger_telefon').val();
                userDetails['angehoriger_email'] = $('#angehoriger_email').val();
                userDetails['health_insurance'] = $('#health-insurance').val();
                userDetails['insurance_no'] = $('#insurance-no').val();
                userDetails['KrankenkasseNummer'] = $('#KrankenkasseNummer').val();
                personalInformation.push(userDetails);


                var customerDeliveryAddress = [];
                var deliveryAddress = {};
                deliveryAddress['recipient_name'] = $('#Drecipient_name').val();
                deliveryAddress['street'] = $('#Dstreetno').val();
                deliveryAddress['houseno'] = $('#Dhouseno').val();
                deliveryAddress['zip'] = $('#Dzip').val();
                deliveryAddress['city'] = $('#Dcity').val();
                customerDeliveryAddress.push(deliveryAddress);

                // Récupérer les données du package de la session
                var packageId = '{{ isset($package_data) ? $package_data["packageId"] : (request()->id ?? "") }}';

                $.ajax({
                    headers: {
                        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
                    },
                    type: "POST",
                    url: "{{ route('product.checkout') }}",
                    data: 'packageDetails=' + packageId + '&userDetails=' + JSON.stringify(personalInformation) + '&deliveryAddress=' + JSON.stringify(customerDeliveryAddress) + '&signature=' + $('#signatureImg').attr('src'),
                    success: function(a) {
                        if (a.status == '1') {
                            //alert('success');
                            successtoastMessage(a.message)
                            ///alert('success2');
                        } else {
                            errortoastMessage(a.message)
                            ///alert('failed2');
                        }
                        setTimeout(function() {
                            if (a.status == '1') {
                                window.location.href = '/order-success';
                            }
                            else
                            {
                                location.reload();
                            }
                        }, 5000);
                    }
                });
            }
        };
    </script>
</div>
